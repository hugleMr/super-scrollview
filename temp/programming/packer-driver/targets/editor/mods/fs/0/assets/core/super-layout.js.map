{"version":3,"sources":["file:///Users/stevejobs/Documents/GitHub/super-scrollview/assets/core/super-layout.ts"],"names":["_decorator","Component","Node","ccenum","UITransform","SystemEventType","director","Vec3","EventHandler","instantiate","Prefab","Size","Vec2","size","SuperScrollview","ccclass","property","requireComponent","EPSILON","Type","VerticalAxisDirection","HorizontalAxisDirection","ScrollDirection","SuperLayout","type","tooltip","visible","autoCenter","NONE","vertical","layoutType","VERTICAL","horizontal","HORIZONTAL","transform","node","_uiProps","uiTransformComp","accommodWidth","view","width","paddingLeft","paddingRight","accommodHeight","height","paddingTop","paddingBottom","header","children","length","footer","headerIndex","footerIndex","viewStartPoint","pos","horizontalAxisDirection","LEFT_TO_RIGHT","x","verticalAxisDirection","TOP_TO_BOTTOM","y","viewHeaderBoundary","offset","viewFooterBoundary","headerBoundary","position","getItemYMax","getItemYMin","getItemXMin","getItemXMax","footerBoundary","centerHeaderBoundary","key","centerNode","centerFooterBoundary","isOfLeftBoundary","scrollDirection","HEADER","headerLoop","fixedItemWidth","itemTotal","isOfTopBoundary","fixedItemHeight","isOfRightBoundary","FOOTER","footerLoop","isOfButtomBoundary","Math","abs","contentSize","maxPrefabTotal","_maxPrefabTotal","_itemTotal","centerPosition","_centerPosition","worldPos","parent","convertToWorldSpaceAR","convertToNodeSpaceAR","onLoad","setContentSize","setPosition","ZERO","Object","defineProperty","configurable","get","onEnable","addEventListener","onDisable","removeEventListener","total","count","created","createItems","refreshItems","scrollView","release","scrollToCenter","soonFinish","scrollToHeader","timeInSecond","headerOrFooter","scrollToIndex","scrollToFooter","index","boundary","reverse","isNaN","stopAutoScroll","child","find","item","isDownOffset","start","groupItemTotal","i","pushToFooter","pushToHeader","notifyRefreshItem","itemPos","getPosition","clone","localPos","multiple","getCenterAnchor","multiply","add","scrollToAny","center","anchor","centerAnchor","origin","anchorY","anchorX","findedPos","map","newLocalPos","subtract","centerTime","getItemSize","spacing","spacingX","spacingY","getScaleHeight","getScaleWidth","getStartX","getEndX","getStartY","getEndY","isAccommodateByTop","relative","max","isAccommodateByBottom","min","isAccommodateByLeft","isAccommodateByRight","getRelativeByLeft","getRelativeByRight","getRelativeByTop","getRelativeByBottom","setItemPosition","getVerticalRelativePosition","getHorizontalRelativePosition","isAccommodate","startIndex","startAutoScroll","gener","return","removeItems","getGeneratorLength","prefab","addChild","getScale","on","EventType","SIZE_CHANGED","onChildSize","TRANSFORM_CHANGED","onChildScale","selfHorW","viewHorW","exeGenerator","off","destroy","removeChild","onPositionChanged","affectedByScale","TransformBit","SCALE","__scale","scale","console","warn","setScale","equals","resetChilds","__size","prevItem","getUsedScaleValue","value","trans","prevLocation","location","isOfBoundary","prevPos","force","pushToFooterHandler","pushToHeaderHandler","setSiblingIndex","accommodate","target","emitEvents","refreshItemEvents","callback","params","result","generator","duration","Promise","resolve","reject","gen","execute","startTime","Date","getTime","iter","next","done","setTimeout","getDeltaTime"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAQSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,e,OAAAA,e;AAAiBC,MAAAA,Q,OAAAA,Q;AAAUC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,Y,OAAAA,Y;AAAcC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;;AAClIC,MAAAA,e,oBAAAA,e;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA,QAAX;AAAqBC,QAAAA;AAArB,O,GAA0CjB,U;AAC1CkB,MAAAA,O,GAAU,I;;iBACXC,I;AAAAA,QAAAA,I,CAAAA,I;AAAAA,QAAAA,I,CAAAA,I;SAAAA,I,KAAAA,I;;AAILhB,MAAAA,MAAM,CAACgB,IAAD,CAAN;;iBACKC,qB;AAAAA,QAAAA,qB,CAAAA,qB;AAAAA,QAAAA,qB,CAAAA,qB;SAAAA,qB,KAAAA,qB;;AAILjB,MAAAA,MAAM,CAACiB,qBAAD,CAAN;;iBACKC,uB;AAAAA,QAAAA,uB,CAAAA,uB;AAAAA,QAAAA,uB,CAAAA,uB;SAAAA,uB,KAAAA,uB;;AAILlB,MAAAA,MAAM,CAACkB,uBAAD,CAAN;;iBACKC,e;AAAAA,QAAAA,e,CAAAA,e;AAAAA,QAAAA,e,CAAAA,e;AAAAA,QAAAA,e,CAAAA,e;SAAAA,e,KAAAA,e;;6BAOQC,W,WAFZR,OAAO,CAAC,aAAD,C,UACPE,gBAAgB,CAACb,WAAD,C,UAEZY,QAAQ;AAAA;AAAA,6C,UACRA,QAAQ,CAACZ,WAAD,C,UACRY,QAAQ,CAAC;AAAEQ,QAAAA,IAAI,EAAEL;AAAR,OAAD,C,UACRH,QAAQ,CAAC;AAAEQ,QAAAA,IAAI,EAAEJ;AAAR,OAAD,C,UACRJ,QAAQ,CAAC;AAAEQ,QAAAA,IAAI,EAAEH;AAAR,OAAD,C,UACRL,QAAQ,CAAC;AAAES,QAAAA,OAAO,EAAE;AAAX,OAAD,C,UACRT,QAAQ,CAAC;AAAES,QAAAA,OAAO,EAAE;AAAX,OAAD,C,WACRT,QAAQ,CAAC;AAAES,QAAAA,OAAO,EAAE;AAAX,OAAD,C,WACRT,QAAQ,CAAC;AAAES,QAAAA,OAAO,EAAE;AAAX,OAAD,C,WACRT,QAAQ,CAAC;AAAES,QAAAA,OAAO,EAAE;AAAX,OAAD,C,WACRT,QAAQ,CAAC;AAAES,QAAAA,OAAO,EAAE;AAAX,OAAD,C,WACRT,QAAQ,CAAC;AAAES,QAAAA,OAAO,EAAE;AAAX,OAAD,C,WACRT,QAAQ,CAAC;AAAES,QAAAA,OAAO,EAAE;AAAX,OAAD,C,WACRT,QAAQ,CAAC;AAAES,QAAAA,OAAO,EAAE;AAAX,OAAD,C,WACRT,QAAQ,CAAC;AAAES,QAAAA,OAAO,EAAE;AAAX,OAAD,C,WACRT,QAAQ,CAAC;AAAES,QAAAA,OAAO,EAAE;AAAX,OAAD,C,WACRT,QAAQ,CAACN,MAAD,C,WACRM,QAAQ,CAACR,YAAD,C,WACRQ,QAAQ,CAAC;AAAES,QAAAA,OAAO,EAAE;AAAX,OAAD,C,WACRT,QAAQ,CAAC;AACNS,QAAAA,OAAO,EAAE,WADH;AAENC,QAAAA,OAAO,EAAE,YAAY;AAAE,iBAAQ,IAAD,CAAcC,UAArB;AAAiC;AAFlD,OAAD,C,WAIRX,QAAQ,CAAC;AACNQ,QAAAA,IAAI,EAAEtB,IADA;AAENuB,QAAAA,OAAO,EAAE,4BAFH;AAGNC,QAAAA,OAAO,EAAE,YAAY;AAAE,iBAAQ,IAAD,CAAcC,UAArB;AAAiC;AAHlD,OAAD,C,WAKRX,QAAQ,CAAC;AACNQ,QAAAA,IAAI,EAAEZ,IADA;AAENa,QAAAA,OAAO,EAAE,iBAFH;AAGNC,QAAAA,OAAO,EAAE,YAAY;AAAE,iBAAQ,IAAD,CAAcC,UAArB;AAAiC;AAHlD,OAAD,C,mDA/Bb,MAEaJ,WAFb,SAEiCtB,SAFjC,CAE2C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,mDAmCIqB,eAAe,CAACM,IAnCpB;;AAAA,2CA8Vf,IAAIrB,IAAJ,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,CA9Ve;;AAAA,mDA+VL,CA/VK;;AAAA,8CAkWV,CAlWU;AAAA;;AAoCvC;AACY,YAARsB,QAAQ,GAAY;AAAE,iBAAO,KAAKC,UAAL,IAAmBX,IAAI,CAACY,QAA/B;AAAyC;AACnE;;;AACc,YAAVC,UAAU,GAAY;AAAE,iBAAO,KAAKF,UAAL,IAAmBX,IAAI,CAACc,UAA/B;AAA2C;;AAC1D,YAATC,SAAS,GAAuB;AAAE,iBAAO,KAAKC,IAAL,CAAUC,QAAV,CAAmBC,eAA1B;AAA2C;AACjF;;;AACiB,YAAbC,aAAa,GAAG;AAChB,iBAAO,KAAKC,IAAL,CAAUC,KAAV,GAAkB,KAAKC,WAAvB,GAAqC,KAAKC,YAAjD;AACH;AACD;;;AACkB,YAAdC,cAAc,GAAG;AACjB,iBAAO,KAAKJ,IAAL,CAAUK,MAAV,GAAmB,KAAKC,UAAxB,GAAqC,KAAKC,aAAjD;AACH;AACD;;;AACU,YAANC,MAAM,GAAuB;AAC7B,cAAI,KAAKZ,IAAL,CAAUa,QAAV,CAAmBC,MAAnB,IAA6B,CAAjC,EAAoC,OAAO,IAAP;AACpC,iBAAO,KAAKd,IAAL,CAAUa,QAAV,CAAmB,CAAnB,EAAsBZ,QAAtB,CAA+BC,eAAtC;AACH;AACD;;;AACU,YAANa,MAAM,GAAuB;AAC7B,cAAI,KAAKf,IAAL,CAAUa,QAAV,CAAmBC,MAAnB,IAA6B,CAAjC,EAAoC,OAAO,IAAP;AACpC,iBAAO,KAAKd,IAAL,CAAUa,QAAV,CAAmB,KAAKb,IAAL,CAAUa,QAAV,CAAmBC,MAAnB,GAA4B,CAA/C,EAAkDb,QAAlD,CAA2DC,eAAlE;AACH;AACD;;;AACe,YAAXc,WAAW,GAAW;AACtB,cAAI,CAAC,KAAKJ,MAAV,EAAkB,OAAO,CAAC,CAAR;AAClB,cAAIZ,IAAS,GAAG,KAAKY,MAAL,CAAYZ,IAA5B;AACA,iBAAOA,IAAI,CAAC,SAAD,CAAX;AACH;AACD;;;AACe,YAAXiB,WAAW,GAAW;AACtB,cAAI,CAAC,KAAKF,MAAV,EAAkB,OAAO,CAAC,CAAR;AAClB,cAAIf,IAAS,GAAG,KAAKe,MAAL,CAAYf,IAA5B;AACA,iBAAOA,IAAI,CAAC,SAAD,CAAX;AACH;AACD;;;AACkB,YAAdkB,cAAc,GAAS;AACvB,cAAIC,GAAG,GAAG,IAAI/C,IAAJ,EAAV;;AACA,cAAI,KAAKgD,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvEF,YAAAA,GAAG,CAACG,CAAJ,GAAQ,KAAKlB,IAAL,CAAUC,KAAV,GAAkB,CAAC,GAAnB,GAAyB,KAAKC,WAAtC;AACH,WAFD,MAEO;AACHa,YAAAA,GAAG,CAACG,CAAJ,GAAQ,KAAKlB,IAAL,CAAUC,KAAV,GAAkB,GAAlB,GAAwB,KAAKE,YAArC;AACH;;AACD,cAAI,KAAKgB,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnEL,YAAAA,GAAG,CAACM,CAAJ,GAAQ,KAAKrB,IAAL,CAAUK,MAAV,GAAmB,GAAnB,GAAyB,KAAKC,UAAtC;AACH,WAFD,MAEO;AACHS,YAAAA,GAAG,CAACM,CAAJ,GAAQ,KAAKrB,IAAL,CAAUK,MAAV,GAAmB,CAAC,GAApB,GAA0B,KAAKE,aAAvC;AACH;;AACD,iBAAOQ,GAAP;AACH;AACD;;;AACsB,YAAlBO,kBAAkB,GAAW;AAC7B,cAAIC,MAAM,GAAG,CAAb;;AACA,cAAI,KAAKjC,QAAT,EAAmB;AACfiC,YAAAA,MAAM,GAAG,KAAKvB,IAAL,CAAUK,MAAV,GAAmB,GAA5B;AACH,WAFD,MAEO;AACHkB,YAAAA,MAAM,GAAG,KAAKvB,IAAL,CAAUC,KAAV,GAAkB,CAAC,GAA5B;AACH;;AACD,iBAAOsB,MAAP;AACH;AACD;;;AACsB,YAAlBC,kBAAkB,GAAW;AAC7B,cAAID,MAAM,GAAG,CAAb;;AACA,cAAI,KAAKjC,QAAT,EAAmB;AACfiC,YAAAA,MAAM,GAAG,KAAKvB,IAAL,CAAUK,MAAV,GAAmB,CAAC,GAA7B;AACH,WAFD,MAEO;AACHkB,YAAAA,MAAM,GAAG,KAAKvB,IAAL,CAAUC,KAAV,GAAkB,GAA3B;AACH;;AACD,iBAAOsB,MAAP;AACH;AACD;;;AACkB,YAAdE,cAAc,GAAW;AACzB,cAAI,CAAC,KAAKjB,MAAV,EAAkB,OAAO,CAAP;;AAClB,cAAI,KAAKlB,QAAT,EAAmB;AACf,gBAAI,KAAK6B,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,qBAAO,KAAKxB,IAAL,CAAU8B,QAAV,CAAmBL,CAAnB,GAAuB,KAAKM,WAAL,CAAiB,KAAKnB,MAAtB,CAAvB,GAAuD,KAAKF,UAAnE;AACH,aAFD,MAEO;AACH,qBAAO,KAAKV,IAAL,CAAU8B,QAAV,CAAmBL,CAAnB,GAAuB,KAAKO,WAAL,CAAiB,KAAKpB,MAAtB,CAAvB,GAAuD,KAAKD,aAAnE;AACH;AACJ,WAND,MAMO;AACH,gBAAI,KAAKS,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,qBAAO,KAAKrB,IAAL,CAAU8B,QAAV,CAAmBR,CAAnB,GAAuB,KAAKW,WAAL,CAAiB,KAAKrB,MAAtB,CAAvB,GAAuD,KAAKN,WAAnE;AACH,aAFD,MAEO;AACH,qBAAO,KAAKN,IAAL,CAAU8B,QAAV,CAAmBR,CAAnB,GAAuB,KAAKY,WAAL,CAAiB,KAAKtB,MAAtB,CAAvB,GAAuD,KAAKL,YAAnE;AACH;AACJ;AACJ;AACD;;;AACkB,YAAd4B,cAAc,GAAW;AACzB,cAAI,CAAC,KAAKpB,MAAV,EAAkB,OAAO,CAAP;;AAClB,cAAI,KAAKrB,QAAT,EAAmB;AACf,gBAAI,KAAK6B,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,qBAAO,KAAKxB,IAAL,CAAU8B,QAAV,CAAmBL,CAAnB,GAAuB,KAAKO,WAAL,CAAiB,KAAKjB,MAAtB,CAAvB,GAAuD,KAAKJ,aAAnE;AACH,aAFD,MAEO;AACH,qBAAO,KAAKX,IAAL,CAAU8B,QAAV,CAAmBL,CAAnB,GAAuB,KAAKM,WAAL,CAAiB,KAAKhB,MAAtB,CAAvB,GAAuD,KAAKL,UAAnE;AACH;AACJ,WAND,MAMO;AACH,gBAAI,KAAKU,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,qBAAO,KAAKrB,IAAL,CAAU8B,QAAV,CAAmBR,CAAnB,GAAuB,KAAKY,WAAL,CAAiB,KAAKnB,MAAtB,CAAvB,GAAuD,KAAKR,YAAnE;AACH,aAFD,MAEO;AACH,qBAAO,KAAKP,IAAL,CAAU8B,QAAV,CAAmBR,CAAnB,GAAuB,KAAKW,WAAL,CAAiB,KAAKlB,MAAtB,CAAvB,GAAuD,KAAKT,WAAnE;AACH;AACJ;AACJ;AACD;;;AACwB,YAApB8B,oBAAoB,GAAG;AACvB,cAAIC,GAAG,GAAG,KAAK3C,QAAL,GAAgB,GAAhB,GAAsB,GAAhC;;AACA,cAAI,KAAK4C,UAAT,EAAqB;AACjB,gBAAI,KAAK5C,QAAT,EAAmB;AACf,kBAAI,KAAK6B,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,uBAAO,KAAKK,cAAL,IAAuB,KAAKH,kBAAL,GAA2B,KAAKY,UAAL,CAAgBR,QAAjB,CAAkCO,GAAlC,CAAjD,CAAP;AACH,eAFD,MAEO;AACH,uBAAO,KAAKF,cAAL,IAAuB,KAAKT,kBAAL,GAA2B,KAAKY,UAAL,CAAgBR,QAAjB,CAAkCO,GAAlC,CAAjD,CAAP;AACH;AACJ,aAND,MAMO;AACH,kBAAI,KAAKjB,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,uBAAO,KAAKQ,cAAL,IAAuB,KAAKH,kBAAL,GAA2B,KAAKY,UAAL,CAAgBR,QAAjB,CAAkCO,GAAlC,CAAjD,CAAP;AACH,eAFD,MAEO;AACH,uBAAO,KAAKF,cAAL,IAAuB,KAAKT,kBAAL,GAA2B,KAAKY,UAAL,CAAgBR,QAAjB,CAAkCO,GAAlC,CAAjD,CAAP;AACH;AACJ;AACJ,WAdD,MAcO;AACH,gBAAI,KAAKjB,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,qBAAO,KAAKQ,cAAL,IAAuB,KAAKH,kBAAL,GAA2B,KAAKtB,IAAL,CAAUJ,IAAV,CAAe8B,QAAhB,CAAiCO,GAAjC,CAAjD,CAAP;AACH,aAFD,MAEO;AACH,qBAAO,KAAKF,cAAL,IAAuB,KAAKT,kBAAL,GAA2B,KAAKtB,IAAL,CAAUJ,IAAV,CAAe8B,QAAhB,CAAiCO,GAAjC,CAAjD,CAAP;AACH;AACJ;AACJ;AACD;;;AACwB,YAApBE,oBAAoB,GAAG;AACvB,cAAIF,GAAG,GAAG,KAAK3C,QAAL,GAAgB,GAAhB,GAAsB,GAAhC;;AACA,cAAI,KAAK4C,UAAT,EAAqB;AACjB,gBAAI,KAAK5C,QAAT,EAAmB;AACf,kBAAI,KAAK6B,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,uBAAO,KAAKW,cAAL,IAAuB,KAAKP,kBAAL,GAA2B,KAAKU,UAAL,CAAgBR,QAAjB,CAAkCO,GAAlC,CAAjD,CAAP;AACH,eAFD,MAEO;AACH,uBAAO,KAAKR,cAAL,IAAuB,KAAKD,kBAAL,GAA2B,KAAKU,UAAL,CAAgBR,QAAjB,CAAkCO,GAAlC,CAAjD,CAAP;AACH;AACJ,aAND,MAMO;AACH,kBAAI,KAAKjB,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,uBAAO,KAAKc,cAAL,IAAuB,KAAKP,kBAAL,GAA2B,KAAKU,UAAL,CAAgBR,QAAjB,CAAkCO,GAAlC,CAAjD,CAAP;AACH,eAFD,MAEO;AACH,uBAAO,KAAKR,cAAL,IAAuB,KAAKD,kBAAL,GAA2B,KAAKU,UAAL,CAAgBR,QAAjB,CAAkCO,GAAlC,CAAjD,CAAP;AACH;AACJ;AACJ,WAdD,MAcO;AACH,gBAAI,KAAK3C,QAAT,EAAmB;AACf,kBAAI,KAAK6B,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,uBAAO,KAAKW,cAAL,IAAuB,KAAKP,kBAAL,GAA2B,KAAKxB,IAAL,CAAUJ,IAAV,CAAe8B,QAAhB,CAAiCO,GAAjC,CAAjD,CAAP;AACH,eAFD,MAEO;AACH,uBAAO,KAAKR,cAAL,IAAuB,KAAKD,kBAAL,GAA2B,KAAKxB,IAAL,CAAUJ,IAAV,CAAe8B,QAAhB,CAAiCO,GAAjC,CAAjD,CAAP;AACH;AACJ,aAND,MAMO;AACH,kBAAI,KAAKjB,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,uBAAO,KAAKc,cAAL,IAAuB,KAAKP,kBAAL,GAA2B,KAAKxB,IAAL,CAAUJ,IAAV,CAAe8B,QAAhB,CAAiCO,GAAjC,CAAjD,CAAP;AACH,eAFD,MAEO;AACH,uBAAO,KAAKR,cAAL,IAAuB,KAAKD,kBAAL,GAA2B,KAAKxB,IAAL,CAAUJ,IAAV,CAAe8B,QAAhB,CAAiCO,GAAjC,CAAjD,CAAP;AACH;AACJ;AACJ;AACJ;AACD;;;AACoB,YAAhBG,gBAAgB,GAAW;AAC3B,cAAI,KAAK9C,QAAT,EAAmB,OAAO,CAAP;;AACnB,cAAI,KAAKF,UAAT,EAAqB;AACjB,gBAAI,KAAKiD,eAAL,IAAwBtD,eAAe,CAACuD,MAA5C,EAAoD;AAChD,qBAAO,KAAKN,oBAAZ;AACH;;AACD,mBAAO,CAAP;AACH;;AACD,cAAI,KAAKO,UAAT,EAAqB;AACjB,gBAAI,KAAK/B,MAAT,EAAiB,OAAO,CAAP;AACjB,mBAAO,KAAKc,kBAAL,GAA0B,KAAK1B,IAAL,CAAU8B,QAAV,CAAmBR,CAApD;AACH;;AAED,cAAI,CAAC,KAAKV,MAAN,IAAgB,KAAKgC,cAAL,IAAuB,KAAKxC,IAAL,CAAUC,KAArD,EAA4D;AACxD,mBAAO,KAAKqB,kBAAL,GAA0B,KAAK1B,IAAL,CAAU8B,QAAV,CAAmBR,CAApD;AACH;;AACD,cAAI,KAAKF,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,gBAAI,KAAKL,WAAL,IAAoB,CAAxB,EAA2B;AACvB,qBAAO,KAAKa,cAAZ;AACH;AACJ,WAJD,MAIO;AACH,gBAAI,KAAKZ,WAAL,IAAoB,KAAK4B,SAAL,GAAiB,CAAzC,EAA4C;AACxC,qBAAO,MAAM,KAAKV,cAAlB;AACH;AACJ;;AACD,iBAAO,CAAP;AACH;AACD;;;AACmB,YAAfW,eAAe,GAAW;AAC1B,cAAI,CAAC,KAAKpD,QAAV,EAAoB,OAAO,CAAP;;AACpB,cAAI,KAAKF,UAAT,EAAqB;AACjB,gBAAI,KAAKiD,eAAL,IAAwBtD,eAAe,CAACuD,MAA5C,EAAoD;AAChD,qBAAO,KAAKN,oBAAZ;AACH;;AACD,mBAAO,CAAP;AACH;;AACD,cAAI,KAAKO,UAAT,EAAqB;AACjB,gBAAI,KAAK/B,MAAT,EAAiB,OAAO,CAAP;AACjB,mBAAO,KAAKc,kBAAL,GAA0B,KAAK1B,IAAL,CAAU8B,QAAV,CAAmBL,CAApD;AACH;;AACD,cAAI,CAAC,KAAKb,MAAN,IAAgB,KAAKmC,eAAL,IAAwB,KAAK3C,IAAL,CAAUK,MAAtD,EAA8D;AAC1D,mBAAO,KAAKiB,kBAAL,GAA0B,KAAK1B,IAAL,CAAU8B,QAAV,CAAmBL,CAApD;AACH;;AACD,cAAI,KAAKF,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,gBAAI,KAAKR,WAAL,IAAoB,CAAxB,EAA2B;AACvB,qBAAO,KAAKa,cAAZ;AACH;AACJ,WAJD,MAIO;AACH,gBAAI,KAAKZ,WAAL,IAAoB,KAAK4B,SAAL,GAAiB,CAAzC,EAA4C;AACxC,qBAAO,KAAKV,cAAZ;AACH;AACJ;;AACD,iBAAO,CAAP;AACH;AACD;;;AACqB,YAAjBa,iBAAiB,GAAW;AAC5B,cAAI,KAAKtD,QAAT,EAAmB,OAAO,CAAP;;AACnB,cAAI,KAAKF,UAAT,EAAqB;AACjB,gBAAI,KAAKiD,eAAL,IAAwBtD,eAAe,CAAC8D,MAA5C,EAAoD;AAChD,qBAAO,KAAKV,oBAAZ;AACH;;AACD,mBAAO,CAAP;AACH;;AACD,cAAI,KAAKW,UAAT,EAAqB;AACjB,gBAAI,KAAKnC,MAAT,EAAiB,OAAO,CAAP;AACjB,mBAAO,KAAKa,kBAAL,GAA0B,KAAK5B,IAAL,CAAU8B,QAAV,CAAmBR,CAApD;AACH;;AACD,cAAI,CAAC,KAAKP,MAAN,IAAgB,KAAK6B,cAAL,IAAuB,KAAKxC,IAAL,CAAUC,KAArD,EAA4D;AACxD,mBAAO,KAAKuB,kBAAL,GAA0B,KAAK5B,IAAL,CAAU8B,QAAV,CAAmBR,CAApD;AACH;;AACD,cAAI,KAAKF,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,gBAAI,KAAKJ,WAAL,IAAoB,KAAK4B,SAAL,GAAiB,CAAzC,EAA4C;AACxC,qBAAO,MAAM,KAAKV,cAAlB;AACH;AACJ,WAJD,MAIO;AACH,gBAAI,KAAKnB,WAAL,IAAoB,CAAxB,EAA2B;AACvB,qBAAO,KAAKa,cAAZ;AACH;AACJ;;AACD,iBAAO,CAAP;AACH;AACD;;;AACsB,YAAlBsB,kBAAkB,GAAW;AAC7B,cAAI,CAAC,KAAKzD,QAAV,EAAoB,OAAO,CAAP;;AACpB,cAAI,KAAKF,UAAT,EAAqB;AACjB,gBAAI,KAAKiD,eAAL,IAAwBtD,eAAe,CAAC8D,MAA5C,EAAoD;AAChD,qBAAO,KAAKV,oBAAZ;AACH;;AACD,mBAAO,CAAP;AACH;;AACD,cAAI,KAAKW,UAAT,EAAqB;AACjB,gBAAI,KAAKnC,MAAT,EAAiB,OAAO,CAAP;AACjB,mBAAO,KAAKa,kBAAL,GAA0B,KAAK5B,IAAL,CAAU8B,QAAV,CAAmBL,CAApD;AACH;;AACD,cAAI,CAAC,KAAKV,MAAN,IAAgB,KAAKgC,eAAL,IAAwB,KAAK3C,IAAL,CAAUK,MAAtD,EAA8D;AAC1D,mBAAO,KAAKmB,kBAAL,GAA0B,KAAK5B,IAAL,CAAU8B,QAAV,CAAmBL,CAApD;AACH;;AACD,cAAI,KAAKF,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,gBAAI,KAAKP,WAAL,IAAoB,KAAK4B,SAAL,GAAiB,CAAzC,EAA4C;AACxC,qBAAO,KAAKV,cAAZ;AACH;AACJ,WAJD,MAIO;AACH,gBAAI,KAAKnB,WAAL,IAAoB,CAAxB,EAA2B;AACvB,qBAAO,KAAKa,cAAZ;AACH;AACJ;;AACD,iBAAO,CAAP;AACH;AACD;;;AACmB,YAAfkB,eAAe,GAAW;AAC1B,cAAI,CAAC,KAAKnC,MAAV,EAAkB,OAAO,CAAP;;AAClB,cAAI,KAAKW,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,mBAAO4B,IAAI,CAACC,GAAL,CAAS,KAAKtB,WAAL,CAAiB,KAAKnB,MAAtB,CAAT,IAA0CwC,IAAI,CAACC,GAAL,CAAS,KAAKrB,WAAL,CAAiB,KAAKjB,MAAtB,CAAT,CAAjD;AACH,WAFD,MAEO;AACH,mBAAOqC,IAAI,CAACC,GAAL,CAAS,KAAKrB,WAAL,CAAiB,KAAKpB,MAAtB,CAAT,IAA0CwC,IAAI,CAACC,GAAL,CAAS,KAAKtB,WAAL,CAAiB,KAAKhB,MAAtB,CAAT,CAAjD;AACH;AACJ;AACD;;;AACkB,YAAd6B,cAAc,GAAW;AACzB,cAAI,CAAC,KAAKhC,MAAV,EAAkB,OAAO,CAAP;;AAClB,cAAI,KAAKQ,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,mBAAO+B,IAAI,CAACC,GAAL,CAAS,KAAKpB,WAAL,CAAiB,KAAKrB,MAAtB,CAAT,IAA0CwC,IAAI,CAACC,GAAL,CAAS,KAAKnB,WAAL,CAAiB,KAAKnB,MAAtB,CAAT,CAAjD;AACH,WAFD,MAEO;AACH,mBAAOqC,IAAI,CAACC,GAAL,CAAS,KAAKnB,WAAL,CAAiB,KAAKtB,MAAtB,CAAT,IAA0CwC,IAAI,CAACC,GAAL,CAAS,KAAKpB,WAAL,CAAiB,KAAKlB,MAAtB,CAAT,CAAjD;AACH;AACJ;AACD;;;AACe,YAAXuC,WAAW,GAAS;AACpB,cAAI,KAAKtD,IAAL,CAAUa,QAAV,CAAmBC,MAAnB,IAA6B,CAAjC,EAAoC,OAAO,KAAKV,IAAL,CAAUkD,WAAjB;AACpC,cAAI5E,IAAI,GAAG,IAAIF,IAAJ,CAAS,KAAK4B,IAAL,CAAUkD,WAAV,CAAsBjD,KAA/B,EAAsC,KAAKD,IAAL,CAAUkD,WAAV,CAAsB7C,MAA5D,CAAX;;AACA,cAAI,KAAKf,QAAT,EAAmB;AACf,gBAAI,KAAK6B,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE9C,cAAAA,IAAI,CAAC+B,MAAL,GAAc,KAAKoB,cAAL,GAAsB,CAAC,KAAKM,cAA5B,GAA6C,KAAKzB,UAAlD,GAA+D,KAAKC,aAAlF;AACH,aAFD,MAEO;AACHjC,cAAAA,IAAI,CAAC+B,MAAL,GAAc,KAAK0B,cAAL,GAAsB,CAAC,KAAKN,cAA5B,GAA6C,KAAKnB,UAAlD,GAA+D,KAAKC,aAAlF;AACH;AACJ,WAND,MAMO;AACH,gBAAI,KAAKS,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE3C,cAAAA,IAAI,CAAC2B,KAAL,GAAa,KAAK8B,cAAL,GAAsB,CAAC,KAAKN,cAA5B,GAA6C,KAAKvB,WAAlD,GAAgE,KAAKC,YAAlF;AACH,aAFD,MAEO;AACH7B,cAAAA,IAAI,CAAC2B,KAAL,GAAa,KAAKwB,cAAL,GAAsB,CAAC,KAAKM,cAA5B,GAA6C,KAAK7B,WAAlD,GAAgE,KAAKC,YAAlF;AACH;AACJ;;AACD,cAAI7B,IAAI,CAAC2B,KAAL,GAAa,KAAKD,IAAL,CAAUkD,WAAV,CAAsBjD,KAAvC,EAA8C;AAC1C3B,YAAAA,IAAI,CAAC2B,KAAL,GAAa,KAAKD,IAAL,CAAUkD,WAAV,CAAsBjD,KAAnC;AACH;;AACD,cAAI3B,IAAI,CAAC+B,MAAL,GAAc,KAAKL,IAAL,CAAUkD,WAAV,CAAsB7C,MAAxC,EAAgD;AAC5C/B,YAAAA,IAAI,CAAC+B,MAAL,GAAc,KAAKL,IAAL,CAAUkD,WAAV,CAAsB7C,MAApC;AACH;;AACD,iBAAO/B,IAAP;AACH;;AAGD;AACkB,YAAd6E,cAAc,GAAW;AAAE,iBAAO,KAAKC,eAAZ;AAA6B;;AAE5D;AACa,YAATX,SAAS,GAAW;AAAE,iBAAO,KAAKY,UAAZ;AAAwB;;AAGlD;AACkB,YAAdC,cAAc,GAAS;AACvB,cAAI,CAAC,KAAKC,eAAV,EAA2B;AACvB,iBAAKA,eAAL,GAAuB,IAAIvF,IAAJ,EAAvB;;AACA,gBAAI,KAAKoB,UAAT,EAAqB;AACjB,kBAAI,KAAK8C,UAAT,EAAqB;AAAA;;AACjB,oBAAIsB,QAAQ,4BAAG,KAAKtB,UAAL,CAAgBuB,MAAnB,oFAAG,sBAAwB5D,QAAxB,CAAiCC,eAApC,2DAAG,uBAAkD4D,qBAAlD,CAAwE,KAAKxB,UAAL,CAAgBR,QAAxF,CAAf;AACA,qBAAK6B,eAAL,GAAuB,KAAKvD,IAAL,CAAU2D,oBAAV,CAA+BH,QAA/B,CAAvB;AACH;AACJ,aALD,MAKO;AACH,kBAAI,KAAKlE,QAAT,EAAmB;AACf,oBAAI,KAAK6B,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,uBAAKmC,eAAL,CAAqBlC,CAArB,GAAyB,KAAKC,kBAA9B;AACH,iBAFD,MAEO;AACH,uBAAKiC,eAAL,CAAqBlC,CAArB,GAAyB,KAAKG,kBAA9B;AACH;AACJ,eAND,MAMO;AACH,oBAAI,KAAKR,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,uBAAKsC,eAAL,CAAqBrC,CAArB,GAAyB,KAAKI,kBAA9B;AACH,iBAFD,MAEO;AACH,uBAAKiC,eAAL,CAAqBrC,CAArB,GAAyB,KAAKM,kBAA9B;AACH;AACJ;AACJ;AACJ;;AACD,iBAAO,KAAK+B,eAAZ;AACH;;AACDK,QAAAA,MAAM,GAAG;AAAA;;AACL,kCAAKjE,SAAL,oEAAgBkE,cAAhB,CAA+B,KAAK7D,IAAL,CAAUkD,WAAzC;AACA,eAAKtD,IAAL,CAAUkE,WAAV,CAAsB9F,IAAI,CAAC+F,IAA3B;AACAC,UAAAA,MAAM,CAACC,cAAP,CAAsB,KAAKtE,SAA3B,EAAsC,aAAtC,EAAqD;AACjDuE,YAAAA,YAAY,EAAE,IADmC;AAEjDC,YAAAA,GAAG,EAAE,MAAM,KAAKjB;AAFiC,WAArD;AAIH;;AACDkB,QAAAA,QAAQ,GAAG;AACP,eAAKC,gBAAL;AACH;;AACDC,QAAAA,SAAS,GAAG;AACR,eAAKC,mBAAL;AACH;AACD;;;AACW,cAALC,KAAK,CAACC,KAAD,EAAgB;AACvB,cAAIC,OAAO,GAAG,MAAM,KAAKC,WAAL,CAAiBF,KAAjB,CAApB;AACA,cAAIlD,MAAM,GAAGkD,KAAK,GAAG,KAAKhC,SAA1B;AACA,eAAKY,UAAL,GAAkBoB,KAAlB;;AACA,cAAI,CAACC,OAAL,EAAc;AACV,iBAAKE,YAAL,CAAkBrD,MAAlB;AACH;;AACD,eAAKsD,UAAL,CAAgBC,OAAhB;AACH;AACD;;;AACAC,QAAAA,cAAc,GAAG;AACb,eAAKC,UAAL;AACH;AACD;;;AACAC,QAAAA,cAAc,CAACC,YAAD,EAAwB;AAClC,cAAIC,cAAc,GAAG,CAArB;;AACA,cAAI,KAAK7F,QAAT,EAAmB;AACf,gBAAI,KAAK6B,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE+D,cAAAA,cAAc,GAAG,KAAK7D,kBAAtB;AACH,aAFD,MAEO;AACH6D,cAAAA,cAAc,GAAG,KAAK3D,kBAAtB;AACH;AACJ,WAND,MAMO;AACH,gBAAI,KAAKR,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvEkE,cAAAA,cAAc,GAAG,KAAK7D,kBAAtB;AACH,aAFD,MAEO;AACH6D,cAAAA,cAAc,GAAG,KAAK3D,kBAAtB;AACH;AACJ;;AACD,eAAK4D,aAAL,CAAmB,CAAnB,EAAsBF,YAAtB,EAAoC,IAAIlH,IAAJ,CAASmH,cAAT,EAAyBA,cAAzB,CAApC;AACH;AACD;;;AACAE,QAAAA,cAAc,CAACH,YAAD,EAAwB;AAClC,cAAIC,cAAc,GAAG,CAArB;;AACA,cAAI,KAAK7F,QAAT,EAAmB;AACf,gBAAI,KAAKqD,eAAL,GAAuB,KAAK3C,IAAL,CAAUK,MAArC,EAA6C;;AAC7C,gBAAI,KAAKc,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE+D,cAAAA,cAAc,GAAG,KAAK3D,kBAAtB;AACH,aAFD,MAEO;AACH2D,cAAAA,cAAc,GAAG,KAAK7D,kBAAtB;AACH;AACJ,WAPD,MAOO;AACH,gBAAI,KAAKkB,cAAL,GAAsB,KAAKxC,IAAL,CAAUC,KAApC,EAA2C;;AAC3C,gBAAI,KAAKe,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvEkE,cAAAA,cAAc,GAAG,KAAK3D,kBAAtB;AACH,aAFD,MAEO;AACH2D,cAAAA,cAAc,GAAG,KAAK7D,kBAAtB;AACH;AACJ;;AACD,eAAK8D,aAAL,CAAmB,KAAK3C,SAAL,GAAiB,CAApC,EAAuCyC,YAAvC,EAAqD,IAAIlH,IAAJ,CAASmH,cAAT,EAAyBA,cAAzB,CAArD,EAA+F,IAA/F;AACH;AACD;;;AACAC,QAAAA,aAAa,CAACE,KAAD,EAAgBJ,YAAhB,EAAuCK,QAAvC,EAAwDC,OAAgB,GAAG,KAA3E,EAAkF;AAAA;;AAC3F,cAAIC,KAAK,CAACH,KAAD,CAAL,IAAgBA,KAAK,GAAG,CAAxB,IAA6BA,KAAK,GAAG,KAAK7C,SAAL,GAAiB,CAA1D,EAA6D;AAC7D,eAAKoC,UAAL,CAAgBa,cAAhB;AACA,cAAInE,MAAM,GAAG,CAAb;AACA,cAAIoE,KAAK,GAAG,KAAK/F,IAAL,CAAUa,QAAV,CAAmBmF,IAAnB,CAAyBC,IAAD,IAAeA,IAAI,CAAC,SAAD,CAAJ,IAAmBP,KAA1D,CAAZ;;AACA,cAAI,CAACK,KAAL,EAAY;AACR,gBAAIG,YAAY,GAAG,KAAnB;;AACA,gBAAIR,KAAK,GAAG,KAAKzE,WAAb,IAA4ByE,KAAK,GAAG,KAAK1E,WAA7C,EAA0D;AACtD,kBAAIoC,IAAI,CAACC,GAAL,CAASqC,KAAK,GAAG,KAAK1E,WAAtB,IAAqCoC,IAAI,CAACC,GAAL,CAASqC,KAAK,GAAG,KAAKzE,WAAtB,CAAzC,EAA6E;AACzEiF,gBAAAA,YAAY,GAAG,KAAf;AACH,eAFD,MAEO;AACHA,gBAAAA,YAAY,GAAG,IAAf;AACH;AACJ,aAND,MAMO,IAAIR,KAAK,GAAG,KAAKzE,WAAjB,EAA8B;AACjCiF,cAAAA,YAAY,GAAG,IAAf;AACH,aAFM,MAEA,IAAIR,KAAK,GAAG,KAAK1E,WAAjB,EAA8B;AACjCkF,cAAAA,YAAY,GAAG,KAAf;AACH;;AACD,gBAAIC,KAAK,GAAG,CAAZ;;AACA,gBAAID,YAAJ,EAAkB;AACdvE,cAAAA,MAAM,GAAG+D,KAAK,GAAG,KAAKU,cAAb,GAA8B,KAAKnF,WAAL,GAAmB,KAAKmF,cAA/D;AACAzE,cAAAA,MAAM,GAAGyB,IAAI,CAACC,GAAL,CAAS1B,MAAT,CAAT;AACH,aAHD,MAGO;AACHA,cAAAA,MAAM,GAAG,KAAKX,WAAL,GAAmB,KAAKoF,cAAjC;AACAzE,cAAAA,MAAM,GAAGyB,IAAI,CAACC,GAAL,CAAS1B,MAAT,CAAT;AACH;;AACD,iBAAK,IAAI0E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG1E,MAApB,EAA4B0E,CAAC,EAA7B,EAAiC;AAC7B,kBAAI,KAAK3G,QAAT,EAAmB;AACf,oBAAI,KAAK6B,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,sBAAI0E,YAAJ,EAAkB;AACd,yBAAKI,YAAL,CAAkB,IAAlB;AACH,mBAFD,MAEO;AACH,yBAAKC,YAAL,CAAkB,IAAlB;AACH;AACJ,iBAND,MAMO;AACH,sBAAIL,YAAJ,EAAkB;AACd,yBAAKK,YAAL,CAAkB,IAAlB;AACH,mBAFD,MAEO;AACH,yBAAKD,YAAL,CAAkB,IAAlB;AACH;AACJ;AACJ,eAdD,MAcO;AACH,oBAAI,KAAKlF,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,sBAAI6E,YAAJ,EAAkB;AACd,yBAAKI,YAAL,CAAkB,IAAlB;AACH,mBAFD,MAEO;AACH,yBAAKC,YAAL,CAAkB,IAAlB;AACH;AACJ,iBAND,MAMO;AACH,sBAAIL,YAAJ,EAAkB;AACd,yBAAKK,YAAL,CAAkB,IAAlB;AACH,mBAFD,MAEO;AACH,yBAAKD,YAAL,CAAkB,IAAlB;AACH;AACJ;AACJ;AACJ;;AACD,gBAAIJ,YAAJ,EAAkB;AACdC,cAAAA,KAAK,GAAG/C,IAAI,CAACC,GAAL,CAASqC,KAAK,GAAG,KAAKnC,cAAtB,IAAwC,CAAhD;AACH,aAFD,MAEO;AACH4C,cAAAA,KAAK,GAAGT,KAAK,GAAG,KAAKU,cAAb,GAA8B,CAA9B,GAAkCV,KAA1C;AACH;;AACD,iBAAK,IAAIW,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKrG,IAAL,CAAUa,QAAV,CAAmBC,MAAvC,EAA+CuF,CAAC,EAAhD,EAAoD;AAChD,oBAAMN,KAAU,GAAG,KAAK/F,IAAL,CAAUa,QAAV,CAAmBwF,CAAnB,CAAnB;;AACA,kBAAI,KAAK1D,UAAL,IAAmB,KAAKO,UAA5B,EAAwC;AACpC,oBAAIiD,KAAK,GAAG,KAAKtD,SAAL,GAAiB,CAA7B,EAAgC;AAC5BsD,kBAAAA,KAAK,GAAG,CAAR;AACH;AACJ;;AACDJ,cAAAA,KAAK,CAAC,SAAD,CAAL,GAAmBI,KAAnB;AACA,mBAAKK,iBAAL,CAAuBT,KAAvB;AACAI,cAAAA,KAAK;AACR;;AACDJ,YAAAA,KAAK,GAAG,KAAK/F,IAAL,CAAUa,QAAV,CAAmBmF,IAAnB,CAAyBC,IAAD,IAAeA,IAAI,CAAC,SAAD,CAAJ,IAAmBP,KAA1D,CAAR;AACH;;AACD,cAAI,CAACK,KAAL,EAAY;AACZ,cAAIU,OAAO,GAAGV,KAAK,CAACW,WAAN,GAAoBC,KAApB,EAAd;;AACA,cAAI,CAAC,KAAKnH,UAAV,EAAsB;AAClB,gBAAI,KAAKE,QAAT,EAAmB;AACf,kBAAI,KAAK6B,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,oBAAI,CAACoE,OAAL,EAAc;AACVa,kBAAAA,OAAO,CAAChF,CAAR,GAAY,KAAKM,WAAL,CAAiBgE,KAAK,CAAC9F,QAAN,CAAeC,eAAhC,IAAoD,KAAKQ,UAArE;AACH,iBAFD,MAEO;AACH+F,kBAAAA,OAAO,CAAChF,CAAR,GAAY,KAAKO,WAAL,CAAiB+D,KAAK,CAAC9F,QAAN,CAAeC,eAAhC,IAAoD,KAAKS,aAArE;AACH;AACJ,eAND,MAMO;AACH,oBAAI,CAACiF,OAAL,EAAc;AACVa,kBAAAA,OAAO,CAAChF,CAAR,GAAY,KAAKO,WAAL,CAAiB+D,KAAK,CAAC9F,QAAN,CAAeC,eAAhC,IAAoD,KAAKS,aAArE;AACH,iBAFD,MAEO;AACH8F,kBAAAA,OAAO,CAAChF,CAAR,GAAY,KAAKM,WAAL,CAAiBgE,KAAK,CAAC9F,QAAN,CAAeC,eAAhC,IAAoD,KAAKQ,UAArE;AACH;AACJ;AACJ,aAdD,MAcO;AACH,kBAAI,KAAKU,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,oBAAI,CAACuE,OAAL,EAAc;AACVa,kBAAAA,OAAO,CAACnF,CAAR,GAAY,KAAKW,WAAL,CAAiB8D,KAAK,CAAC9F,QAAN,CAAeC,eAAhC,IAAoD,KAAKI,WAArE;AACH,iBAFD,MAEO;AACHmG,kBAAAA,OAAO,CAACnF,CAAR,GAAY,KAAKY,WAAL,CAAiB6D,KAAK,CAAC9F,QAAN,CAAeC,eAAhC,IAAoD,KAAKK,YAArE;AACH;AACJ,eAND,MAMO;AACH,oBAAI,CAACqF,OAAL,EAAc;AACVa,kBAAAA,OAAO,CAACnF,CAAR,GAAY,KAAKY,WAAL,CAAiB6D,KAAK,CAAC9F,QAAN,CAAeC,eAAhC,IAAoD,KAAKK,YAArE;AACH,iBAFD,MAEO;AACHkG,kBAAAA,OAAO,CAACnF,CAAR,GAAY,KAAKW,WAAL,CAAiB8D,KAAK,CAAC9F,QAAN,CAAeC,eAAhC,IAAoD,KAAKI,WAArE;AACH;AACJ;AACJ;AACJ;;AACD,cAAIsD,QAAQ,uBAAG,KAAK7D,SAAR,qDAAG,iBAAgB+D,qBAAhB,CAAsC2C,OAAtC,CAAf;AACA,cAAIG,QAAQ,GAAG,KAAKxG,IAAL,CAAU2D,oBAAV,CAA+BH,QAA/B,CAAf;AACA,cAAIiD,QAAJ;;AACA,cAAI,CAAC,KAAKrH,UAAN,IAAoBmG,QAAxB,EAAkC;AAC9BkB,YAAAA,QAAQ,GAAGlB,QAAX;AACH,WAFD,MAEO;AACHkB,YAAAA,QAAQ,GAAG,KAAKC,eAAL,CAAqBf,KAAK,CAAC9F,QAAN,CAAeC,eAApC,EAAsD,KAAKwD,cAA3D,CAAX;AACH;;AACDkD,UAAAA,QAAQ,CAACG,QAAT,CAAkB,IAAI3I,IAAJ,CAAS,CAAC,CAAV,EAAa,CAAC,CAAd,EAAiB,CAAjB,CAAlB,EAAuC4I,GAAvC,CAA2CH,QAA3C;AACA,eAAK5B,UAAL,CAAgBgC,WAAhB,CAA4BL,QAA5B,EAAsCtB,YAAtC;AACH;AACD;;;AACUwB,QAAAA,eAAe,CAACb,IAAD,EAAoBiB,MAApB,EAAkC;AACvD,cAAI/F,GAAG,GAAG+F,MAAM,CAACP,KAAP,EAAV;;AACA,cAAI,KAAKjH,QAAT,EAAmB;AACf,gBAAIyH,MAAM,GAAGlB,IAAI,CAACxF,MAAL,GAAe,KAAK2G,YAAL,CAAkB3F,CAA9C;AACA,gBAAI4F,MAAM,GAAGpB,IAAI,CAACxF,MAAL,GAAewF,IAAI,CAACqB,OAAjC;AACAnG,YAAAA,GAAG,CAACM,CAAJ,IAAS0F,MAAM,GAAGE,MAAlB;AACH,WAJD,MAIO;AACH,gBAAIF,MAAM,GAAGlB,IAAI,CAAC5F,KAAL,GAAc,KAAK+G,YAAL,CAAkB9F,CAA7C;AACA,gBAAI+F,MAAM,GAAGpB,IAAI,CAAC5F,KAAL,GAAc4F,IAAI,CAACsB,OAAhC;AACApG,YAAAA,GAAG,CAACG,CAAJ,IAAS6F,MAAM,GAAGE,MAAlB;AACH;;AACD,iBAAOlG,GAAP;AACH;AACD;;;AACUiE,QAAAA,UAAU,GAAG;AACnB,cAAI,CAAC,KAAK5F,UAAV,EAAsB;AACtB,eAAKyF,UAAL,CAAgBa,cAAhB;AACA,cAAI0B,SAAS,GAAG,IAAIpJ,IAAJ,CAAS,MAAT,EAAiB,MAAjB,CAAhB;;AACA,eAAK,IAAIiI,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKrG,IAAL,CAAUa,QAAV,CAAmBC,MAAvC,EAA+CuF,CAAC,EAAhD,EAAoD;AAAA;;AAChD,kBAAMN,KAAK,GAAG,KAAK/F,IAAL,CAAUa,QAAV,CAAmBwF,CAAnB,CAAd;AACA,gBAAIzC,QAAQ,uBAAG,KAAK7D,SAAR,qDAAG,iBAAgB+D,qBAAhB,CAAsCiC,KAAK,CAACjE,QAA5C,CAAf;AACA,gBAAI8E,QAAQ,GAAG,KAAKxG,IAAL,CAAU2D,oBAAV,CAA+BH,QAA/B,CAAf;AACA,gBAAI6D,GAAG,GAAG;AAAEpH,cAAAA,KAAK,EAAE,KAAT;AAAgBI,cAAAA,MAAM,EAAE;AAAxB,aAAV;AAEA,gBAAIoG,QAAQ,GAAG,KAAKC,eAAL,CAAqBf,KAAK,CAAC9F,QAAN,CAAeC,eAApC,EAAsD,KAAKwD,cAA3D,CAAf;AAEA,gBAAIgE,WAAW,GAAGd,QAAQ,CAACe,QAAT,CAAkBd,QAAlB,CAAlB;AACAY,YAAAA,GAAG,CAACpH,KAAJ,GAAY+C,IAAI,CAACC,GAAL,CAASqE,WAAW,CAACpG,CAArB,IAA0B8B,IAAI,CAACC,GAAL,CAASmE,SAAS,CAAClG,CAAnB,CAAtC;AACAmG,YAAAA,GAAG,CAAChH,MAAJ,GAAa2C,IAAI,CAACC,GAAL,CAASqE,WAAW,CAACjG,CAArB,IAA0B2B,IAAI,CAACC,GAAL,CAASmE,SAAS,CAAC/F,CAAnB,CAAvC;;AACA,gBAAI,KAAK/B,QAAL,IAAiB+H,GAAG,CAAChH,MAAzB,EAAiC;AAC7B+G,cAAAA,SAAS,GAAGE,WAAZ;AACH,aAFD,MAEO,IAAI,CAAC,KAAKhI,QAAN,IAAkB+H,GAAG,CAACpH,KAA1B,EAAiC;AACpCmH,cAAAA,SAAS,GAAGE,WAAZ;AACH;AACJ;;AACDF,UAAAA,SAAS,CAACT,QAAV,CAAmB,IAAI3I,IAAJ,CAAS,CAAC,CAAV,EAAa,CAAC,CAAd,EAAiB,CAAjB,CAAnB;AACA,eAAK6G,UAAL,CAAgBgC,WAAhB,CAA4BO,SAA5B,EAAuC,KAAKI,UAA5C;AACH;AACD;;;AACUC,QAAAA,WAAW,CAAC5B,IAAD,EAA0B;AAC3C,cAAIvH,IAAI,GAAG,IAAIF,IAAJ,EAAX;;AACA,cAAI,KAAKkB,QAAT,EAAmB;AACf,gBAAIoI,OAAO,GAAG,KAAKC,QAAL,IAAiB,KAAK3B,cAAL,GAAsB,CAAvC,CAAd;AACA1H,YAAAA,IAAI,CAAC2B,KAAL,GAAa,CAAC,KAAKF,aAAL,GAAqB2H,OAAtB,IAAiC,KAAK1B,cAAnD;AACA1H,YAAAA,IAAI,CAAC+B,MAAL,GAAcwF,IAAI,CAACxF,MAAnB;AACH,WAJD,MAIO;AACH,gBAAIqH,OAAO,GAAG,KAAKE,QAAL,IAAiB,KAAK5B,cAAL,GAAsB,CAAvC,CAAd;AACA1H,YAAAA,IAAI,CAAC+B,MAAL,GAAc,CAAC,KAAKD,cAAL,GAAsBsH,OAAvB,IAAkC,KAAK1B,cAArD;AACA1H,YAAAA,IAAI,CAAC2B,KAAL,GAAa4F,IAAI,CAAC5F,KAAlB;AACH;;AACD,iBAAO3B,IAAP;AACH;AACD;;;AACUqD,QAAAA,WAAW,CAACkE,IAAD,EAAmC;AACpD,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAIxF,MAAM,GAAG,KAAKwH,cAAL,CAAoBhC,IAApB,KAA6B,IAAIA,IAAI,CAACqB,OAAtC,CAAb;AACA,iBAAOrB,IAAI,CAACjG,IAAL,CAAU8B,QAAV,CAAmBL,CAAnB,GAAuBhB,MAA9B;AACH;AACD;;;AACUuB,QAAAA,WAAW,CAACiE,IAAD,EAAmC;AACpD,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAIxF,MAAM,GAAG,KAAKwH,cAAL,CAAoBhC,IAApB,IAA4BA,IAAI,CAACqB,OAA9C;AACA,iBAAOrB,IAAI,CAACjG,IAAL,CAAU8B,QAAV,CAAmBL,CAAnB,GAAuBhB,MAA9B;AACH;AACD;;;AACUyB,QAAAA,WAAW,CAAC+D,IAAD,EAAmC;AACpD,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAI5F,KAAK,GAAG,KAAK6H,aAAL,CAAmBjC,IAAnB,KAA4B,IAAIA,IAAI,CAACsB,OAArC,CAAZ;AACA,iBAAOtB,IAAI,CAACjG,IAAL,CAAU8B,QAAV,CAAmBR,CAAnB,GAAuBjB,KAA9B;AACH;AACD;;;AACU4B,QAAAA,WAAW,CAACgE,IAAD,EAAmC;AACpD,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAI5F,KAAK,GAAG,KAAK6H,aAAL,CAAmBjC,IAAnB,IAA2BA,IAAI,CAACsB,OAA5C;AACA,iBAAOtB,IAAI,CAACjG,IAAL,CAAU8B,QAAV,CAAmBR,CAAnB,GAAuBjB,KAA9B;AACH;AACD;;;AACU8H,QAAAA,SAAS,CAAClC,IAAD,EAAmC;AAClD,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAI3E,CAAC,GAAG,CAAR;;AACA,cAAI,KAAKF,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,gBAAIhB,KAAK,GAAG,KAAK6H,aAAL,CAAmBjC,IAAnB,IAA2BA,IAAI,CAACsB,OAA5C;AACAjG,YAAAA,CAAC,GAAG,KAAKJ,cAAL,CAAoBI,CAApB,GAAwBjB,KAA5B;AACH,WAHD,MAGO;AACH,gBAAIA,KAAK,GAAG,KAAK6H,aAAL,CAAmBjC,IAAnB,KAA4B,IAAIA,IAAI,CAACsB,OAArC,CAAZ;AACAjG,YAAAA,CAAC,GAAG,KAAKJ,cAAL,CAAoBI,CAApB,GAAwBjB,KAA5B;AACH;;AACD,iBAAOiB,CAAP;AACH;AACD;;;AACU8G,QAAAA,OAAO,CAACnC,IAAD,EAAmC;AAChD,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAI3E,CAAC,GAAG,CAAR;;AACA,cAAI,KAAKF,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,gBAAIhB,KAAK,GAAG,KAAK6H,aAAL,CAAmBjC,IAAnB,KAA4B,IAAIA,IAAI,CAACsB,OAArC,CAAZ;AACAjG,YAAAA,CAAC,GAAG,CAAC,KAAKJ,cAAL,CAAoBI,CAArB,GAAyBjB,KAAzB,GAAiC,KAAKE,YAAtC,GAAqD,KAAKD,WAA9D;AACH,WAHD,MAGO;AACH,gBAAID,KAAK,GAAG,KAAK6H,aAAL,CAAmBjC,IAAnB,IAA2BA,IAAI,CAACsB,OAA5C;AACAjG,YAAAA,CAAC,GAAG,CAAC,KAAKJ,cAAL,CAAoBI,CAArB,GAAyBjB,KAAzB,GAAiC,KAAKC,WAAtC,GAAoD,KAAKC,YAA7D;AACH;;AACD,iBAAOe,CAAP;AACH;AACD;;;AACU+G,QAAAA,SAAS,CAACpC,IAAD,EAAmC;AAClD,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAIxE,CAAC,GAAG,CAAR;;AACA,cAAI,KAAKF,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,gBAAIf,MAAM,GAAG,KAAKwH,cAAL,CAAoBhC,IAApB,KAA6B,IAAIA,IAAI,CAACqB,OAAtC,CAAb;AACA7F,YAAAA,CAAC,GAAG,KAAKP,cAAL,CAAoBO,CAApB,GAAwBhB,MAA5B;AACH,WAHD,MAGO;AACH,gBAAIA,MAAM,GAAG,KAAKwH,cAAL,CAAoBhC,IAApB,IAA4BA,IAAI,CAACqB,OAA9C;AACA7F,YAAAA,CAAC,GAAG,KAAKP,cAAL,CAAoBO,CAApB,GAAwBhB,MAA5B;AACH;;AACD,iBAAOgB,CAAP;AACH;AACD;;;AACU6G,QAAAA,OAAO,CAACrC,IAAD,EAAmC;AAChD,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAIxE,CAAC,GAAG,CAAR;;AACA,cAAI,KAAKF,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,gBAAIf,MAAM,GAAG,KAAKwH,cAAL,CAAoBhC,IAApB,IAA4BA,IAAI,CAACqB,OAA9C;AACA7F,YAAAA,CAAC,GAAG,CAAC,KAAKP,cAAL,CAAoBO,CAArB,GAAyBhB,MAAzB,GAAkC,KAAKE,aAAvC,GAAuD,KAAKD,UAAhE;AACH,WAHD,MAGO;AACH,gBAAID,MAAM,GAAG,KAAKwH,cAAL,CAAoBhC,IAApB,KAA6B,IAAIA,IAAI,CAACqB,OAAtC,CAAb;AACA7F,YAAAA,CAAC,GAAG,CAAC,KAAKP,cAAL,CAAoBO,CAArB,GAAyBhB,MAAzB,GAAkC,KAAKC,UAAvC,GAAoD,KAAKC,aAA7D;AACH;;AACD,iBAAOc,CAAP;AACH;AACD;;;AACU8G,QAAAA,kBAAkB,CAACC,QAAD,EAAwB;AAChD,cAAIC,GAAG,GAAG,KAAK1G,WAAL,CAAiByG,QAAjB,CAAV;AACA,iBAAOC,GAAG,GAAG,KAAK/H,UAAX,GAAwB,KAAKF,cAAL,GAAsB,GAArD;AACH;AACD;;;AACUkI,QAAAA,qBAAqB,CAACF,QAAD,EAAwB;AACnD,cAAIG,GAAG,GAAG,KAAK3G,WAAL,CAAiBwG,QAAjB,CAAV;AACA,iBAAOG,GAAG,GAAG,KAAKhI,aAAX,GAA2B,KAAKH,cAAL,GAAsB,CAAC,GAAzD;AACH;AACD;;;AACUoI,QAAAA,mBAAmB,CAACJ,QAAD,EAAwB;AACjD,cAAIG,GAAG,GAAG,KAAK1G,WAAL,CAAiBuG,QAAjB,CAAV;AACA,iBAAOG,GAAG,GAAG,KAAKrI,WAAX,GAAyB,KAAKH,aAAL,GAAqB,CAAC,GAAtD;AACH;AACD;;;AACU0I,QAAAA,oBAAoB,CAACL,QAAD,EAAwB;AAClD,cAAIC,GAAG,GAAG,KAAKvG,WAAL,CAAiBsG,QAAjB,CAAV;AACA,iBAAOC,GAAG,GAAG,KAAKlI,YAAX,GAA0B,KAAKJ,aAAL,GAAqB,GAAtD;AACH;AACD;;;AACU2I,QAAAA,iBAAiB,CAAC7C,IAAD,EAAoBuC,QAApB,EAAmD;AAC1E,cAAIG,GAAG,GAAG,KAAK1G,WAAL,CAAiBuG,QAAjB,CAAV;AACA,iBAAOG,GAAG,GAAG,KAAKZ,QAAX,GAAsB,KAAKG,aAAL,CAAmBjC,IAAnB,KAA4B,IAAIA,IAAI,CAACsB,OAArC,CAA7B;AACH;AACD;;;AACUwB,QAAAA,kBAAkB,CAAC9C,IAAD,EAAoBuC,QAApB,EAAmD;AAC3E,cAAIC,GAAG,GAAG,KAAKvG,WAAL,CAAiBsG,QAAjB,CAAV;AACA,iBAAOC,GAAG,GAAG,KAAKV,QAAX,GAAsB,KAAKG,aAAL,CAAmBjC,IAAnB,IAA2BA,IAAI,CAACsB,OAA7D;AACH;AACD;;;AACUyB,QAAAA,gBAAgB,CAAC/C,IAAD,EAAoBuC,QAApB,EAAmD;AACzE,cAAIC,GAAG,GAAG,KAAK1G,WAAL,CAAiByG,QAAjB,CAAV;AACA,iBAAOC,GAAG,GAAG,KAAKT,QAAX,GAAsB,KAAKC,cAAL,CAAoBhC,IAApB,KAA6B,IAAIA,IAAI,CAACqB,OAAtC,CAA7B;AACH;AACD;;;AACU2B,QAAAA,mBAAmB,CAAChD,IAAD,EAAoBuC,QAApB,EAAmD;AAC5E,cAAIG,GAAG,GAAG,KAAK3G,WAAL,CAAiBwG,QAAjB,CAAV;AACA,iBAAOG,GAAG,GAAG,KAAKX,QAAX,GAAsB,KAAKC,cAAL,CAAoBhC,IAApB,IAA4BA,IAAI,CAACqB,OAA9D;AACH;AACD;;;AACU4B,QAAAA,eAAe,CAACjD,IAAD,EAAoBuC,QAApB,EAA2C5C,OAAgB,GAAG,KAA9D,EAAqE;AAC1F,cAAIzE,GAAG,GAAG,IAAI/C,IAAJ,EAAV;;AACA,cAAI,CAAC,KAAKwC,MAAV,EAAkB;AACdO,YAAAA,GAAG,CAACG,CAAJ,GAAQ,KAAK6G,SAAL,CAAelC,IAAf,CAAR;AACA9E,YAAAA,GAAG,CAACM,CAAJ,GAAQ,KAAK4G,SAAL,CAAepC,IAAf,CAAR;AACH,WAHD,MAGO;AACH,gBAAI,KAAKvG,QAAT,EAAmB;AACfyB,cAAAA,GAAG,GAAG,KAAKgI,2BAAL,CAAiClD,IAAjC,EAAuCuC,QAAvC,EAAiD5C,OAAjD,CAAN;AACH,aAFD,MAEO;AACHzE,cAAAA,GAAG,GAAG,KAAKiI,6BAAL,CAAmCnD,IAAnC,EAAyCuC,QAAzC,EAAmD5C,OAAnD,CAAN;AACH;AACJ;;AACDK,UAAAA,IAAI,CAACjG,IAAL,CAAUkE,WAAV,CAAsB/C,GAAtB;AACH;AACD;;;AACUgI,QAAAA,2BAA2B,CAAClD,IAAD,EAAoBuC,QAApB,EAA2C5C,OAA3C,EAA6D;AAC9F,cAAIzE,GAAG,GAAG,IAAI/C,IAAJ,EAAV;AACA,cAAIiL,aAAa,GAAG,KAApB;;AACA,cAAI,KAAKjI,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvEgI,YAAAA,aAAa,GAAG,CAACzD,OAAD,GAAW,KAAKiD,oBAAL,CAA0BL,QAA1B,CAAX,GAAiD,KAAKI,mBAAL,CAAyBJ,QAAzB,CAAjE;AACH,WAFD,MAEO;AACHa,YAAAA,aAAa,GAAG,CAACzD,OAAD,GAAW,KAAKgD,mBAAL,CAAyBJ,QAAzB,CAAX,GAAgD,KAAKK,oBAAL,CAA0BL,QAA1B,CAAhE;AACH,WAP6F,CAQ9F;;;AACA,cAAI,KAAKpH,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,gBAAI,CAACuE,OAAL,EAAc;AACVzE,cAAAA,GAAG,CAACG,CAAJ,GAAQ+H,aAAa,GAAG,KAAKN,kBAAL,CAAwB9C,IAAxB,EAA8BuC,QAA9B,CAAH,GAA6C,KAAKL,SAAL,CAAelC,IAAf,CAAlE;AACH,aAFD,MAEO;AACH9E,cAAAA,GAAG,CAACG,CAAJ,GAAQ+H,aAAa,GAAG,KAAKP,iBAAL,CAAuB7C,IAAvB,EAA6BuC,QAA7B,CAAH,GAA4C,KAAKJ,OAAL,CAAanC,IAAb,CAAjE;AACH;AACJ,WAND,MAMO;AACH,gBAAI,CAACL,OAAL,EAAc;AACVzE,cAAAA,GAAG,CAACG,CAAJ,GAAQ+H,aAAa,GAAG,KAAKP,iBAAL,CAAuB7C,IAAvB,EAA6BuC,QAA7B,CAAH,GAA4C,KAAKL,SAAL,CAAelC,IAAf,CAAjE;AACH,aAFD,MAEO;AACH9E,cAAAA,GAAG,CAACG,CAAJ,GAAQ+H,aAAa,GAAG,KAAKN,kBAAL,CAAwB9C,IAAxB,EAA8BuC,QAA9B,CAAH,GAA6C,KAAKJ,OAAL,CAAanC,IAAb,CAAlE;AACH;AACJ,WArB6F,CAsB9F;;;AACA,cAAI,KAAK1E,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,gBAAI,CAACoE,OAAL,EAAc;AACVzE,cAAAA,GAAG,CAACM,CAAJ,GAAQ4H,aAAa,GAAGb,QAAQ,CAACxI,IAAT,CAAc8B,QAAd,CAAuBL,CAA1B,GAA8B,KAAKwH,mBAAL,CAAyBhD,IAAzB,EAA+BuC,QAA/B,CAAnD;AACH,aAFD,MAEO;AACHrH,cAAAA,GAAG,CAACM,CAAJ,GAAQ4H,aAAa,GAAGb,QAAQ,CAACxI,IAAT,CAAc8B,QAAd,CAAuBL,CAA1B,GAA8B,KAAKuH,gBAAL,CAAsB/C,IAAtB,EAA4BuC,QAA5B,CAAnD;AACH;AACJ,WAND,MAMO;AACH,gBAAI,CAAC5C,OAAL,EAAc;AACVzE,cAAAA,GAAG,CAACM,CAAJ,GAAQ4H,aAAa,GAAGb,QAAQ,CAACxI,IAAT,CAAc8B,QAAd,CAAuBL,CAA1B,GAA8B,KAAKuH,gBAAL,CAAsB/C,IAAtB,EAA4BuC,QAA5B,CAAnD;AACH,aAFD,MAEO;AACHrH,cAAAA,GAAG,CAACM,CAAJ,GAAQ4H,aAAa,GAAGb,QAAQ,CAACxI,IAAT,CAAc8B,QAAd,CAAuBL,CAA1B,GAA8B,KAAKwH,mBAAL,CAAyBhD,IAAzB,EAA+BuC,QAA/B,CAAnD;AACH;AACJ;;AACD,iBAAOrH,GAAP;AACH;AACD;;;AACUiI,QAAAA,6BAA6B,CAACnD,IAAD,EAAoBuC,QAApB,EAA2C5C,OAA3C,EAA6D;AAChG,cAAIzE,GAAG,GAAG,IAAI/C,IAAJ,EAAV;AACA,cAAIiL,aAAa,GAAG,KAApB;;AACA,cAAI,KAAK9H,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE6H,YAAAA,aAAa,GAAG,CAACzD,OAAD,GAAW,KAAK8C,qBAAL,CAA2BF,QAA3B,CAAX,GAAkD,KAAKD,kBAAL,CAAwBC,QAAxB,CAAlE;AACH,WAFD,MAEO;AACHa,YAAAA,aAAa,GAAG,CAACzD,OAAD,GAAW,KAAK2C,kBAAL,CAAwBC,QAAxB,CAAX,GAA+C,KAAKE,qBAAL,CAA2BF,QAA3B,CAA/D;AACH,WAP+F,CAQhG;;;AACA,cAAI,KAAKjH,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,gBAAI,CAACoE,OAAL,EAAc;AACVzE,cAAAA,GAAG,CAACM,CAAJ,GAAQ4H,aAAa,GAAG,KAAKJ,mBAAL,CAAyBhD,IAAzB,EAA+BuC,QAA/B,CAAH,GAA8C,KAAKH,SAAL,CAAepC,IAAf,CAAnE;AACH,aAFD,MAEO;AACH9E,cAAAA,GAAG,CAACM,CAAJ,GAAQ4H,aAAa,GAAG,KAAKL,gBAAL,CAAsB/C,IAAtB,EAA4BuC,QAA5B,CAAH,GAA2C,KAAKF,OAAL,CAAarC,IAAb,CAAhE;AACH;AACJ,WAND,MAMO;AACH,gBAAI,CAACL,OAAL,EAAc;AACVzE,cAAAA,GAAG,CAACM,CAAJ,GAAQ4H,aAAa,GAAG,KAAKL,gBAAL,CAAsB/C,IAAtB,EAA4BuC,QAA5B,CAAH,GAA2C,KAAKH,SAAL,CAAepC,IAAf,CAAhE;AACH,aAFD,MAEO;AACH9E,cAAAA,GAAG,CAACM,CAAJ,GAAQ4H,aAAa,GAAG,KAAKJ,mBAAL,CAAyBhD,IAAzB,EAA+BuC,QAA/B,CAAH,GAA8C,KAAKF,OAAL,CAAarC,IAAb,CAAnE;AACH;AACJ,WArB+F,CAsBhG;;;AACA,cAAI,KAAK7E,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,gBAAI,CAACuE,OAAL,EAAc;AACVzE,cAAAA,GAAG,CAACG,CAAJ,GAAQ+H,aAAa,GAAGb,QAAQ,CAACxI,IAAT,CAAc8B,QAAd,CAAuBR,CAA1B,GAA8B,KAAKyH,kBAAL,CAAwB9C,IAAxB,EAA8BuC,QAA9B,CAAnD;AACH,aAFD,MAEO;AACHrH,cAAAA,GAAG,CAACG,CAAJ,GAAQ+H,aAAa,GAAGb,QAAQ,CAACxI,IAAT,CAAc8B,QAAd,CAAuBR,CAA1B,GAA8B,KAAKwH,iBAAL,CAAuB7C,IAAvB,EAA6BuC,QAA7B,CAAnD;AACH;AACJ,WAND,MAMO;AACH,gBAAI,CAAC5C,OAAL,EAAc;AACVzE,cAAAA,GAAG,CAACG,CAAJ,GAAQ+H,aAAa,GAAGb,QAAQ,CAACxI,IAAT,CAAc8B,QAAd,CAAuBR,CAA1B,GAA8B,KAAKwH,iBAAL,CAAuB7C,IAAvB,EAA6BuC,QAA7B,CAAnD;AACH,aAFD,MAEO;AACHrH,cAAAA,GAAG,CAACG,CAAJ,GAAQ+H,aAAa,GAAGb,QAAQ,CAACxI,IAAT,CAAc8B,QAAd,CAAuBR,CAA1B,GAA8B,KAAKyH,kBAAL,CAAwB9C,IAAxB,EAA8BuC,QAA9B,CAAnD;AACH;AACJ;;AACD,iBAAOrH,GAAP;AACH;AACD;;;AACU6D,QAAAA,YAAY,CAACrD,MAAD,EAAiB;AACnC,cAAIA,MAAM,GAAG,CAAb,EAAgB;AACZ,iBAAK,IAAI0E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAAC1E,MAArB,EAA6B0E,CAAC,EAA9B,EAAkC;AAC9B,kBAAI,KAAK1D,UAAT,EAAqB;AACjB,qBAAK4D,YAAL;AACH,eAFD,MAEO,IAAI,KAAKrD,UAAT,EAAqB;AACxB,qBAAKqD,YAAL;AACH,eAFM,MAEA;AACH,qBAAKA,YAAL,CAAkB,IAAlB;AACH;AACJ;;AACD,gBAAI+C,UAAU,GAAG,KAAKtI,WAAL,GAAmB,CAAnB,GAAuB,KAAKA,WAA5B,GAA0C,CAA3D;;AACA,iBAAK,IAAIqF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKrG,IAAL,CAAUa,QAAV,CAAmBC,MAAvC,EAA+CuF,CAAC,EAAhD,EAAoD;AAChD,oBAAMN,KAAU,GAAG,KAAK/F,IAAL,CAAUa,QAAV,CAAmBwF,CAAnB,CAAnB;;AACA,kBAAI,KAAK1D,UAAL,IAAmB,KAAKO,UAA5B,EAAwC;AACpC,oBAAIoG,UAAU,GAAG,KAAKzG,SAAL,GAAiB,CAAlC,EAAqC;AACjCyG,kBAAAA,UAAU,GAAG,CAAb;AACH;AACJ;;AACDvD,cAAAA,KAAK,CAAC,SAAD,CAAL,GAAmBuD,UAAnB;AACA,mBAAK9C,iBAAL,CAAuBT,KAAvB;AACAuD,cAAAA,UAAU;AACb;;AACD,iBAAKrE,UAAL,CAAgBsE,eAAhB;AACH,WAvBD,MAuBO;AACH,iBAAK,IAAIlD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKrG,IAAL,CAAUa,QAAV,CAAmBC,MAAvC,EAA+CuF,CAAC,EAAhD,EAAoD;AAChD,kBAAI,KAAK3G,QAAT,EAAmB;AACf,oBAAI,KAAK6B,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AACnE,uBAAK8E,YAAL;AACH,iBAFD,MAEO;AACH,uBAAKC,YAAL;AACH;AACJ,eAND,MAMO;AACH,oBAAI,KAAKnF,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,uBAAKiF,YAAL;AACH,iBAFD,MAEO;AACH,uBAAKC,YAAL;AACH;AACJ;AACJ;AACJ;AACJ;AACD;;;AAC2B,cAAXxB,WAAW,CAACF,KAAD,EAAgB;AAAA;;AACvC,8BAAK2E,KAAL,4DAAYC,MAAZ,CAAmB,EAAnB,EADuC,CAEvC;;AACA,cAAI,KAAKzJ,IAAL,CAAUa,QAAV,CAAmBC,MAAnB,GAA4B+D,KAAhC,EAAuC;AACnC,iBAAK6E,WAAL,CAAiB7E,KAAjB;AACA,mBAAO,KAAP;AACH,WANsC,CAOvC;;;AACA,cAAI,KAAKrB,eAAL,GAAuB,CAAvB,IAA4B,KAAKA,eAAL,IAAwB,KAAKxD,IAAL,CAAUa,QAAV,CAAmBC,MAA3E,EAAmF;AAC/E,mBAAO,KAAP;AACH,WAVsC,CAYvC;;;AACA,cAAI8D,KAAK,GAAGC,KAAK,GAAG,KAAK7E,IAAL,CAAUa,QAAV,CAAmBC,MAAvC,CAbuC,CAaO;;AAC9C,eAAK0I,KAAL,GAAa,KAAKG,kBAAL,CAAwB/E,KAAxB,EAA+B,MAAM;AAC9C,gBAAImB,KAAU,GAAGzH,WAAW,CAAC,KAAKsL,MAAN,CAA5B;AACA7D,YAAAA,KAAK,CAAC,SAAD,CAAL,GAAmB,KAAK/F,IAAL,CAAUa,QAAV,CAAmBC,MAAtC;AACA,kBAAMf,SAAS,GAAGgG,KAAK,CAAC9F,QAAN,CAAeC,eAAjC;AACAH,YAAAA,SAAS,CAACkE,cAAV,CAAyB,KAAK4D,WAAL,CAAiB9H,SAAjB,CAAzB;AACA,iBAAKmJ,eAAL,CAAqBnD,KAAK,CAAC9F,QAAN,CAAeC,eAApC,EAAqD,KAAKa,MAA1D;AACA,iBAAKf,IAAL,CAAU6J,QAAV,CAAmB9D,KAAnB;AACA,iBAAKS,iBAAL,CAAuBT,KAAvB;AACAA,YAAAA,KAAK,CAAC,QAAD,CAAL,GAAkBhG,SAAS,CAACuD,WAAV,CAAsBqD,KAAtB,EAAlB;AACAZ,YAAAA,KAAK,CAAC,SAAD,CAAL,GAAmBA,KAAK,CAAC+D,QAAN,GAAiBnD,KAAjB,EAAnB;AACAZ,YAAAA,KAAK,CAACgE,EAAN,CAAShM,IAAI,CAACiM,SAAL,CAAeC,YAAxB,EAAsC,KAAKC,WAA3C,EAAwD,IAAxD;AACAnE,YAAAA,KAAK,CAACgE,EAAN,CAAShM,IAAI,CAACiM,SAAL,CAAeG,iBAAxB,EAA2C,KAAKC,YAAhD,EAA8D,IAA9D;AACA,gBAAIC,QAAJ,EAAcC,QAAd;;AACA,gBAAI,KAAK5K,QAAT,EAAmB;AACf2K,cAAAA,QAAQ,GAAG,KAAK/G,WAAL,CAAiB7C,MAA5B;AACA6J,cAAAA,QAAQ,GAAG,KAAKlK,IAAL,CAAUK,MAArB;AACH,aAHD,MAGO;AACH4J,cAAAA,QAAQ,GAAG,KAAK/G,WAAL,CAAiBjD,KAA5B;AACAiK,cAAAA,QAAQ,GAAG,KAAKlK,IAAL,CAAUC,KAArB;AACH;AACD;AACZ;AACA;AACA;AACA;AACA;;;AACY,gBAAIgK,QAAQ,IAAIC,QAAQ,GAAG,KAAKzD,QAAhC,EAA0C;AACtC,mBAAKrD,eAAL,GAAuB,KAAKxD,IAAL,CAAUa,QAAV,CAAmBC,MAA1C;AACA,qBAAO,KAAP;AACH;;AACD,mBAAO,IAAP;AACH,WA/BY,CAAb;AAgCA,gBAAM,KAAKyJ,YAAL,CAAkB,KAAKf,KAAvB,EAA8B,EAA9B,CAAN,CA9CuC,CA8CC;;AACxC,iBAAO,IAAP;AACH;AACD;;;AACUE,QAAAA,WAAW,CAAC7E,KAAD,EAAgB;AACjC;AACA,cAAI/D,MAAM,GAAG,KAAKd,IAAL,CAAUa,QAAV,CAAmBC,MAAnB,GAA4B+D,KAAzC,CAFiC,CAGjC;;AACA,eAAK,IAAIwB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGvF,MAApB,EAA4BuF,CAAC,EAA7B,EAAiC;AAC7B,gBAAIN,KAAK,GAAG,KAAK/F,IAAL,CAAUa,QAAV,CAAmB,KAAKb,IAAL,CAAUa,QAAV,CAAmBC,MAAnB,GAA4B,CAA/C,CAAZ;AACAiF,YAAAA,KAAK,CAACyE,GAAN,CAAUzM,IAAI,CAACiM,SAAL,CAAeC,YAAzB,EAAuC,KAAKC,WAA5C,EAAyD,IAAzD;AACAnE,YAAAA,KAAK,CAACyE,GAAN,CAAUzM,IAAI,CAACiM,SAAL,CAAeG,iBAAzB,EAA4C,KAAKC,YAAjD,EAA+D,IAA/D;AACArE,YAAAA,KAAK,CAAC0E,OAAN;AACA,iBAAKzK,IAAL,CAAU0K,WAAV,CAAsB3E,KAAtB;AACH;AACJ;;AACStB,QAAAA,gBAAgB,GAAG;AACzB,eAAKzE,IAAL,CAAU+J,EAAV,CAAa7L,eAAe,CAACiM,iBAA7B,EAAgD,KAAKQ,iBAArD,EAAwE,IAAxE;AACH;;AACShG,QAAAA,mBAAmB,GAAG;AAC5B,eAAK3E,IAAL,CAAUwK,GAAV,CAActM,eAAe,CAACiM,iBAA9B,EAAiD,KAAKQ,iBAAtD,EAAyE,IAAzE;AACH;AACD;;;AACUP,QAAAA,YAAY,CAAC/K,IAAD,EAAY;AAC9B,cAAI,CAAC,KAAKuL,eAAV,EAA2B;;AAC3B,cAAIvL,IAAI,IAAItB,IAAI,CAAC8M,YAAL,CAAkBC,KAA9B,EAAqC;AACjC,iBAAK,IAAIzE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKrG,IAAL,CAAUa,QAAV,CAAmBC,MAAvC,EAA+CuF,CAAC,EAAhD,EAAoD;AAChD,oBAAMN,KAAU,GAAG,KAAK/F,IAAL,CAAUa,QAAV,CAAmBwF,CAAnB,CAAnB;AACA,oBAAM0E,OAAO,GAAGhF,KAAK,CAAC,SAAD,CAArB;;AACA,kBAAI,KAAKK,cAAL,IAAuB,CAA3B,EAA8B;AAC1B,oBAAI,KAAK1G,QAAT,EAAmB;AACf,sBAAIqG,KAAK,CAACiF,KAAN,CAAY1J,CAAZ,IAAiByJ,OAAO,CAACzJ,CAA7B,EAAgC;AAC5B2J,oBAAAA,OAAO,CAACC,IAAR,CAAa,cAAb;AACAnF,oBAAAA,KAAK,CAACoF,QAAN,CAAe,IAAI/M,IAAJ,CAAS2M,OAAO,CAACzJ,CAAjB,EAAoByE,KAAK,CAACiF,KAAN,CAAYvJ,CAAhC,CAAf;AACA;AACH;AACJ,iBAND,MAMO;AACH,sBAAIsE,KAAK,CAACiF,KAAN,CAAYvJ,CAAZ,IAAiBsJ,OAAO,CAACtJ,CAA7B,EAAgC;AAC5BwJ,oBAAAA,OAAO,CAACC,IAAR,CAAa,cAAb;AACAnF,oBAAAA,KAAK,CAACoF,QAAN,CAAe,IAAI/M,IAAJ,CAAS2H,KAAK,CAACiF,KAAN,CAAYvJ,CAArB,EAAwBsJ,OAAO,CAACtJ,CAAhC,CAAf;AACA;AACH;AACJ;AACJ,eAdD,MAcO,IAAI,KAAK2E,cAAL,GAAsB,CAA1B,EAA6B;AAChC,oBAAI,CAACL,KAAK,CAACiF,KAAN,CAAYI,MAAZ,CAAmBL,OAAnB,CAAL,EAAkC;AAC9BE,kBAAAA,OAAO,CAACC,IAAR,CAAa,mBAAb;AACAnF,kBAAAA,KAAK,CAACoF,QAAN,CAAeJ,OAAf;AACA;AACH;AACJ;AACJ;;AACD,gBAAI,KAAK3E,cAAL,GAAsB,CAA1B,EAA6B;AAC7B,iBAAKiF,WAAL;AACH;AACJ;AACD;;;AACUnB,QAAAA,WAAW,GAAG;AACpB,eAAK,IAAI7D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKrG,IAAL,CAAUa,QAAV,CAAmBC,MAAvC,EAA+CuF,CAAC,EAAhD,EAAoD;AAChD,kBAAMN,KAAU,GAAG,KAAK/F,IAAL,CAAUa,QAAV,CAAmBwF,CAAnB,CAAnB;AACA,kBAAMiF,MAAM,GAAGvF,KAAK,CAAC,QAAD,CAApB;AACA,kBAAMhG,SAAS,GAAGgG,KAAK,CAAC9F,QAAN,CAAeC,eAAjC;;AACA,gBAAI,KAAKkG,cAAL,IAAuB,CAA3B,EAA8B;AAC1B,kBAAI,KAAK1G,QAAT,EAAmB;AACf,oBAAI,CAAAK,SAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAEM,KAAX,KAAoBiL,MAAM,CAACjL,KAA/B,EAAsC;AAClC4K,kBAAAA,OAAO,CAACC,IAAR,CAAa,aAAb;AACAnL,kBAAAA,SAAS,CAACkE,cAAV,CAAyBvF,IAAI,CAAC4M,MAAM,CAACjL,KAAR,EAAeN,SAAS,CAACU,MAAzB,CAA7B;AACA;AACH;AACJ,eAND,MAMO;AACH,oBAAI,CAAAV,SAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAEU,MAAX,KAAqB6K,MAAM,CAAC7K,MAAhC,EAAwC;AACpCwK,kBAAAA,OAAO,CAACC,IAAR,CAAa,aAAb;AACAnL,kBAAAA,SAAS,CAACkE,cAAV,CAAyBvF,IAAI,CAACqB,SAAS,CAACM,KAAX,EAAkBiL,MAAM,CAAC7K,MAAzB,CAA7B;AACA;AACH;AACJ;AACJ,aAdD,MAcO,IAAI,KAAK2F,cAAL,GAAsB,CAA1B,EAA6B;AAChC,kBAAI,CAACrG,SAAS,CAACuD,WAAV,CAAsB8H,MAAtB,CAA6BE,MAA7B,CAAL,EAA2C;AACvCL,gBAAAA,OAAO,CAACC,IAAR,CAAa,mBAAb;AACAnL,gBAAAA,SAAS,CAACkE,cAAV,CAAyBqH,MAAzB;AACA;AACH;AACJ;AACJ;;AACD,cAAI,KAAKlF,cAAL,GAAsB,CAA1B,EAA6B;AAC7B,eAAKiF,WAAL;AACH;AACD;;;AACUA,QAAAA,WAAW,CAAClF,KAAc,GAAG,KAAlB,EAAyB;AAC1C,cAAIoF,QAAa,GAAG,KAAK3K,MAAzB;;AACA,cAAI,KAAKlB,QAAL,IAAiB,KAAKqD,eAAL,IAAwB,KAAK3C,IAAL,CAAUK,MAAnD,IAA6D,CAAC,KAAKf,QAAN,IAAkB,KAAKkD,cAAL,IAAuB,KAAKxC,IAAL,CAAUC,KAApH,EAA2H;AAAA;;AACvH,gBAAIiB,CAAC,GAAG,KAAK6G,SAAL,CAAe,KAAKvH,MAApB,CAAR;AACA,gBAAIa,CAAC,GAAG,KAAK4G,SAAL,CAAe,KAAKzH,MAApB,CAAR;AACA,iCAAKA,MAAL,8DAAaZ,IAAb,CAAkBkE,WAAlB,CAA8B,IAAI9F,IAAJ,CAASkD,CAAT,EAAYG,CAAZ,CAA9B;AACH;;AACD,cAAI0E,KAAJ,EAAW;AACP,gBAAI,KAAKzG,QAAT,EAAmB;AAAA;;AACf,kBAAI4B,CAAC,GAAG,KAAK6G,SAAL,CAAe,KAAKvH,MAApB,CAAR;AACA,oCAAKA,MAAL,gEAAaZ,IAAb,CAAkBkE,WAAlB,CAA8B,IAAI9F,IAAJ,CAASkD,CAAT,EAAY,KAAKV,MAAL,CAAYZ,IAAZ,CAAiB8B,QAAjB,CAA0BL,CAAtC,CAA9B;AACH,aAHD,MAGO;AAAA;;AACH,kBAAIA,CAAC,GAAG,KAAK4G,SAAL,CAAe,KAAKzH,MAApB,CAAR;AACA,oCAAKA,MAAL,gEAAaZ,IAAb,CAAkBkE,WAAlB,CAA8B,IAAI9F,IAAJ,CAAS,KAAKwC,MAAL,CAAYZ,IAAZ,CAAiB8B,QAAjB,CAA0BR,CAAnC,EAAsCG,CAAtC,CAA9B;AACH;AACJ;;AACD,eAAK,IAAI4E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKrG,IAAL,CAAUa,QAAV,CAAmBC,MAAvC,EAA+CuF,CAAC,EAAhD,EAAoD;AAChD,kBAAMN,KAAK,GAAG,KAAK/F,IAAL,CAAUa,QAAV,CAAmBwF,CAAnB,CAAd;AACA,kBAAMtG,SAAS,GAAGgG,KAAK,CAAC9F,QAAN,CAAeC,eAAjC;AACA,gBAAIsI,QAAQ,GAAG,CAAC+C,QAAD,GAAY,KAAK3K,MAAjB,GAA0B2K,QAAzC;AACA,iBAAKrC,eAAL,CAAqBnJ,SAArB,EAAgCyI,QAAhC;AACA+C,YAAAA,QAAQ,GAAGxL,SAAX;AACH;;AACD,eAAKkF,UAAL,CAAgBsE,eAAhB;AACH;;AACSiC,QAAAA,iBAAiB,CAACC,KAAD,EAAgB;AACvC,iBAAO,KAAKb,eAAL,GAAuBxH,IAAI,CAACC,GAAL,CAASoI,KAAT,CAAvB,GAAyC,CAAhD;AACH;;AACSvD,QAAAA,aAAa,CAACwD,KAAD,EAAoC;AACvD,cAAI,CAACA,KAAL,EAAY,OAAO,CAAP;AACZ,iBAAOA,KAAK,CAACrL,KAAN,GAAc,KAAKmL,iBAAL,CAAuBE,KAAK,CAAC1L,IAAN,CAAWgL,KAAX,CAAiB1J,CAAxC,CAArB;AACH;;AACS2G,QAAAA,cAAc,CAACyD,KAAD,EAAoC;AACxD,cAAI,CAACA,KAAL,EAAY,OAAO,CAAP;AACZ,iBAAOA,KAAK,CAACjL,MAAN,GAAe,KAAK+K,iBAAL,CAAuBE,KAAK,CAAC1L,IAAN,CAAWgL,KAAX,CAAiBvJ,CAAxC,CAAtB;AACH;;AACSkJ,QAAAA,iBAAiB,GAAG;AAC1B,cAAI,KAAKjL,QAAT,EAAmB;AACf,gBAAI,KAAKuF,UAAL,CAAgB0G,YAAhB,CAA6BlK,CAA7B,GAAiC,KAAKwD,UAAL,CAAgB2G,QAAhB,CAAyBnK,CAA9D,EAAiE;AAC7D,mBAAKgB,eAAL,GAAuBtD,eAAe,CAAC8D,MAAvC;AACH,aAFD,MAEO,IAAI,KAAKgC,UAAL,CAAgB0G,YAAhB,CAA6BlK,CAA7B,GAAiC,KAAKwD,UAAL,CAAgB2G,QAAhB,CAAyBnK,CAA9D,EAAiE;AACpE,mBAAKgB,eAAL,GAAuBtD,eAAe,CAACuD,MAAvC;AACH,aAFM,MAEA;AACH,mBAAKD,eAAL,GAAuBtD,eAAe,CAACM,IAAvC;AACH;AACJ,WARD,MAQO;AACH,gBAAI,KAAKwF,UAAL,CAAgB0G,YAAhB,CAA6BrK,CAA7B,GAAiC,KAAK2D,UAAL,CAAgB2G,QAAhB,CAAyBtK,CAA9D,EAAiE;AAC7D,mBAAKmB,eAAL,GAAuBtD,eAAe,CAAC8D,MAAvC;AACH,aAFD,MAEO,IAAI,KAAKgC,UAAL,CAAgB0G,YAAhB,CAA6BrK,CAA7B,GAAiC,KAAK2D,UAAL,CAAgB2G,QAAhB,CAAyBtK,CAA9D,EAAiE;AACpE,mBAAKmB,eAAL,GAAuBtD,eAAe,CAACuD,MAAvC;AACH,aAFM,MAEA;AACH,mBAAKD,eAAL,GAAuBtD,eAAe,CAACM,IAAvC;AACH;AACJ;;AAED,cAAI,KAAKC,QAAT,EAAmB;AACf,iBAAK,IAAI2G,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKrG,IAAL,CAAUa,QAAV,CAAmBC,MAAvC,EAA+CuF,CAAC,EAAhD,EAAoD;AAChD,kBAAIwF,YAAY,GAAGzI,IAAI,CAACC,GAAL,CAAS,KAAKyI,OAAL,CAAarK,CAAb,GAAiB,KAAKzB,IAAL,CAAU8B,QAAV,CAAmBL,CAA7C,IAAkD1C,OAArE;AACA,kBAAI,CAAC8M,YAAL,EAAmB;;AACnB,kBAAI,KAAKC,OAAL,CAAarK,CAAb,GAAiB,KAAKzB,IAAL,CAAU8B,QAAV,CAAmBL,CAAxC,EAA2C;AACvC,qBAAK6E,YAAL;AACH,eAFD,MAEO,IAAI,KAAKwF,OAAL,CAAarK,CAAb,GAAiB,KAAKzB,IAAL,CAAU8B,QAAV,CAAmBL,CAAxC,EAA2C;AAC9C,qBAAK8E,YAAL;AACH;AACJ;AACJ,WAVD,MAUO;AACH,iBAAK,IAAIF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKrG,IAAL,CAAUa,QAAV,CAAmBC,MAAvC,EAA+CuF,CAAC,EAAhD,EAAoD;AAChD,kBAAIwF,YAAY,GAAGzI,IAAI,CAACC,GAAL,CAAS,KAAKyI,OAAL,CAAaxK,CAAb,GAAiB,KAAKtB,IAAL,CAAU8B,QAAV,CAAmBR,CAA7C,IAAkDvC,OAArE;AACA,kBAAI,CAAC8M,YAAL,EAAmB;;AACnB,kBAAI,KAAKC,OAAL,CAAaxK,CAAb,GAAiB,KAAKtB,IAAL,CAAU8B,QAAV,CAAmBR,CAAxC,EAA2C;AACvC,qBAAKgF,YAAL;AACH,eAFD,MAEO,IAAI,KAAKwF,OAAL,CAAaxK,CAAb,GAAiB,KAAKtB,IAAL,CAAU8B,QAAV,CAAmBR,CAAxC,EAA2C;AAC9C,qBAAKiF,YAAL;AACH;AACJ;AACJ;;AACD,eAAKuF,OAAL,GAAe,KAAK9L,IAAL,CAAU8B,QAAV,CAAmB6E,KAAnB,EAAf;AACH;AACD;;;AACUL,QAAAA,YAAY,CAACyF,KAAc,GAAG,KAAlB,EAAyB;AAC3C,cAAI,KAAKrM,QAAT,EAAmB;AACf,gBAAI,KAAK6B,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AAAA;;AACnE,kBAAIuK,KAAK,IAAI,KAAKlK,cAAL,GAAsB,KAAKnB,UAA3B,GAAwC,KAAKgB,kBAAL,qBAA0B,KAAKd,MAA/B,kDAA0B,cAAaH,MAAvC,CAArD,EAAqG;AACjG,qBAAKuL,mBAAL;AACH;AACJ,aAJD,MAIO;AAAA;;AACH,kBAAID,KAAK,IAAI,KAAK5J,cAAL,GAAsB,KAAKzB,UAA3B,GAAwC,KAAKgB,kBAAL,qBAA0B,KAAKd,MAA/B,kDAA0B,cAAaH,MAAvC,CAArD,EAAqG;AACjG,qBAAKwL,mBAAL;AACH;AACJ;AACJ,WAVD,MAUO;AACH,gBAAI,KAAK7K,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AAAA;;AACvE,kBAAI0K,KAAK,IAAI,KAAKlK,cAAL,GAAsB,KAAKvB,WAA3B,GAAyC,KAAKoB,kBAAL,qBAA0B,KAAKd,MAA/B,kDAA0B,cAAaP,KAAvC,CAAtD,EAAqG;AACjG,qBAAK2L,mBAAL;AACH;AACJ,aAJD,MAIO;AAAA;;AACH,kBAAID,KAAK,IAAI,KAAK5J,cAAL,GAAsB,KAAK7B,WAA3B,GAAyC,KAAKoB,kBAAL,qBAA0B,KAAKd,MAA/B,kDAA0B,cAAaP,KAAvC,CAAtD,EAAqG;AACjG,qBAAK4L,mBAAL;AACH;AACJ;AACJ;AACJ;AACD;;;AACU1F,QAAAA,YAAY,CAACwF,KAAc,GAAG,KAAlB,EAAyB;AAC3C,cAAI,KAAKrM,QAAT,EAAmB;AACf,gBAAI,KAAK6B,qBAAL,IAA8BtC,qBAAqB,CAACuC,aAAxD,EAAuE;AAAA;;AACnE,kBAAIuK,KAAK,IAAI,KAAK5J,cAAL,GAAsB,KAAKxB,aAA3B,GAA2C,KAAKiB,kBAAL,oBAA0B,KAAKb,MAA/B,iDAA0B,aAAaN,MAAvC,CAAxD,EAAwG;AACpG,qBAAKwL,mBAAL;AACH;AACJ,aAJD,MAIO;AAAA;;AACH,kBAAIF,KAAK,IAAI,KAAKlK,cAAL,GAAsB,KAAKlB,aAA3B,GAA2C,KAAKiB,kBAAL,qBAA0B,KAAKb,MAA/B,kDAA0B,cAAaN,MAAvC,CAAxD,EAAwG;AACpG,qBAAKuL,mBAAL;AACH;AACJ;AACJ,WAVD,MAUO;AACH,gBAAI,KAAK5K,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AAAA;;AACvE,kBAAI0K,KAAK,IAAI,KAAK5J,cAAL,GAAsB,KAAK5B,YAA3B,GAA0C,KAAKqB,kBAAL,qBAA0B,KAAKb,MAA/B,kDAA0B,cAAaV,KAAvC,CAAvD,EAAsG;AAClG,qBAAK4L,mBAAL;AACH;AACJ,aAJD,MAIO;AAAA;;AACH,kBAAIF,KAAK,IAAI,KAAKlK,cAAL,GAAsB,KAAKtB,YAA3B,GAA0C,KAAKqB,kBAAL,qBAA0B,KAAKb,MAA/B,kDAA0B,cAAaV,KAAvC,CAAvD,EAAsG;AAClG,qBAAK2L,mBAAL;AACH;AACJ;AACJ;AACJ;;AACSA,QAAAA,mBAAmB,GAAG;AAAA;;AAC5B,cAAIhM,IAAS,oBAAG,KAAKY,MAAR,kDAAG,cAAaZ,IAA7B;;AACA,cAAI,KAAKkD,UAAT,EAAqB;AACjB,gBAAI,KAAKjC,WAAL,IAAoB,KAAK4B,SAAL,GAAiB,CAAzC,EAA4C;AACxC7C,cAAAA,IAAI,CAAC,SAAD,CAAJ,GAAkB,CAAlB;AACH,aAFD,MAEO;AACHA,cAAAA,IAAI,CAAC,SAAD,CAAJ,GAAkB,KAAKiB,WAAL,GAAmB,CAArC;AACH;AACJ,WAND,MAMO;AACH,gBAAI,CAAC,KAAKF,MAAN,IAAgB,KAAKE,WAAL,IAAoB,KAAK4B,SAAL,GAAiB,CAAzD,EAA4D;AAC5D7C,YAAAA,IAAI,CAAC,SAAD,CAAJ,GAAkB,KAAKiB,WAAL,GAAmB,CAArC;AACH;;AACD,eAAKuF,iBAAL,CAAuBxG,IAAvB;AACA,eAAKkJ,eAAL,CAAqB,KAAKtI,MAA1B,EAAmC,KAAKG,MAAxC;AACA,gCAAKH,MAAL,gEAAaZ,IAAb,CAAkBkM,eAAlB,CAAkC,KAAKlM,IAAL,CAAUa,QAAV,CAAmBC,MAArD;AACH;;AACSmL,QAAAA,mBAAmB,GAAG;AAAA;;AAC5B,cAAIjM,IAAS,oBAAG,KAAKe,MAAR,kDAAG,cAAaf,IAA7B;;AACA,cAAI,KAAK2C,UAAT,EAAqB;AACjB,gBAAI,KAAK3B,WAAL,IAAoB,CAAxB,EAA2B;AACvBhB,cAAAA,IAAI,CAAC,SAAD,CAAJ,GAAkB,KAAK6C,SAAL,GAAiB,CAAnC;AACH,aAFD,MAEO;AACH7C,cAAAA,IAAI,CAAC,SAAD,CAAJ,GAAkB,KAAKgB,WAAL,GAAmB,CAArC;AACH;AACJ,WAND,MAMO;AACH,gBAAI,CAAC,KAAKJ,MAAN,IAAgB,KAAKI,WAAL,IAAoB,CAAxC,EAA2C;AAC3ChB,YAAAA,IAAI,CAAC,SAAD,CAAJ,GAAkB,KAAKgB,WAAL,GAAmB,CAArC;AACH;;AACD,eAAKwF,iBAAL,CAAuBxG,IAAvB;AACA,eAAKkJ,eAAL,CAAqB,KAAKnI,MAA1B,EAAmC,KAAKH,MAAxC,EAAiD,IAAjD;AACA,gCAAKG,MAAL,gEAAaf,IAAb,CAAkBkM,eAAlB,CAAkC,CAAlC,EAd4B,CAe5B;;AACA,cAAI,CAAC,KAAKvJ,UAAN,IAAoB,KAAK3B,WAAL,IAAoB,CAA5C,EAA+C;AAC3C;AACA,gBAAImL,WAAW,GAAG,KAAKvD,mBAAL,CAAyB,KAAKhI,MAA9B,CAAlB;;AACA,gBAAIuL,WAAJ,EAAiB;AACb,mBAAKd,WAAL,CAAiB,IAAjB;AACH;AACJ;AACJ;AACD;;;AACU7E,QAAAA,iBAAiB,CAAC4F,MAAD,EAAe;AACtC/N,UAAAA,YAAY,CAACgO,UAAb,CAAwB,KAAKC,iBAA7B,EAAgDF,MAAhD,EAAyDA,MAAD,CAAgB,SAAhB,CAAxD;AACH;AACD;;;AAC8B,SAAlBzC,kBAAkB,CAAC7I,MAAD,EAAiByL,QAAjB,EAAqC,GAAGC,MAAxC,EAAgE;AAC1F,eAAK,IAAInG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGvF,MAApB,EAA4BuF,CAAC,EAA7B,EAAiC;AAC7B,gBAAIoG,MAAM,GAAGF,QAAQ,CAAClG,CAAD,EAAI,GAAGmG,MAAP,CAArB;;AACA,gBAAIC,MAAJ,EAAY;AACR;AACH,aAFD,MAEO;AACH;AACH;AACJ;AACJ;AACD;;;AACUlC,QAAAA,YAAY,CAACmC,SAAD,EAAuBC,QAAvB,EAAyC;AAC3D,iBAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC,gBAAIC,GAAG,GAAGL,SAAV;;AACA,gBAAIM,OAAO,GAAG,MAAM;AAChB,kBAAIC,SAAS,GAAG,IAAIC,IAAJ,GAAWC,OAAX,EAAhB;;AACA,mBAAK,IAAIC,IAAI,GAAGL,GAAG,CAACM,IAAJ,EAAhB,GAA8BD,IAAI,GAAGL,GAAG,CAACM,IAAJ,EAArC,EAAiD;AAC7C,oBAAID,IAAI,IAAI,IAAR,IAAgBA,IAAI,CAACE,IAAzB,EAA+B;AAC3BT,kBAAAA,OAAO,CAAC,IAAD,CAAP;AACA;AACH;;AACD,oBAAI,IAAIK,IAAJ,GAAWC,OAAX,KAAuBF,SAAvB,GAAmCN,QAAvC,EAAiD;AAC7CY,kBAAAA,UAAU,CAAC,MAAMP,OAAO,EAAd,EAAkB7O,QAAQ,CAACqP,YAAT,EAAlB,CAAV;AACA;AACH;AACJ;AACJ,aAZD;;AAaAR,YAAAA,OAAO;AACV,WAhBM,CAAP;AAiBH;;AA3rCsC,O;;;;;;;;;;;;;;;iBAGMhO,IAAI,CAACY,Q;;;;;;;iBACiBX,qBAAqB,CAACuC,a;;;;;;;iBAClBtC,uBAAuB,CAACmC,a;;;;;;;iBAC1B,C;;;;;;;iBACR,C;;;;;;;iBACT,C;;;;;;;iBACG,C;;;;;;;iBACF,C;;;;;;;iBACC,C;;;;;;;iBACJ,C;;;;;;;iBACA,C;;;;;;;iBACY,K;;;;;;;iBACL,K;;;;;;;iBACA,K;;;;;;;;;;;;iBAEG,E;;;;;;;iBACL,K;;;;;;;iBAI/B,C;;;;;;;;;;;;iBAUA,IAAI5C,IAAJ,CAAS,EAAT,EAAa,EAAb,C","sourcesContent":["/*\n * @Author: steveJobs\n * @Email: icipiqkm@gmail.com\n * @Date: 2021-8-1 01:15:04\n * @Last Modified by: steveJobs\n * @Last Modified time: 2021-8-1 14:35:43\n * @Description: 微信 icipiqkm\n */\nimport { _decorator, Component, Node, ccenum, UITransform, SystemEventType, director, Vec3, EventHandler, instantiate, Prefab, Size, Vec2, size } from 'cc';\nimport { SuperScrollview } from './super-scrollview';\nconst { ccclass, property, requireComponent } = _decorator;\nconst EPSILON = 1e-4\nenum Type {\n    HORIZONTAL = 0,\n    VERTICAL = 1,\n}\nccenum(Type)\nenum VerticalAxisDirection {\n    TOP_TO_BOTTOM = 0,\n    BOTTOM_TO_TOP = 1\n}\nccenum(VerticalAxisDirection)\nenum HorizontalAxisDirection {\n    LEFT_TO_RIGHT = 0,\n    RIGHT_TO_LEFT = 1\n}\nccenum(HorizontalAxisDirection)\nenum ScrollDirection {\n    NONE = 0,\n    HEADER = 1,\n    FOOTER = 2,\n}\n@ccclass('SuperLayout')\n@requireComponent(UITransform)\nexport class SuperLayout extends Component {\n    @property(SuperScrollview) scrollView!: SuperScrollview\n    @property(UITransform) view!: UITransform\n    @property({ type: Type }) layoutType: Type = Type.VERTICAL\n    @property({ type: VerticalAxisDirection }) verticalAxisDirection = VerticalAxisDirection.TOP_TO_BOTTOM\n    @property({ type: HorizontalAxisDirection }) horizontalAxisDirection = HorizontalAxisDirection.LEFT_TO_RIGHT\n    @property({ tooltip: \"最小值=1，大于1就是Grid模式\" }) groupItemTotal: number = 1\n    @property({ tooltip: \"决定最多创建Prefab的数量\" }) multiple: number = 2\n    @property({ tooltip: \"顶部填充\" }) paddingTop: number = 0\n    @property({ tooltip: \"底部填充\" }) paddingBottom: number = 0\n    @property({ tooltip: \"左侧填充\" }) paddingLeft: number = 0\n    @property({ tooltip: \"右侧填充\" }) paddingRight: number = 0\n    @property({ tooltip: \"横轴间距\" }) spacingX: number = 0\n    @property({ tooltip: \"纵轴间距\" }) spacingY: number = 0\n    @property({ tooltip: \"计算缩放后的尺寸\" }) affectedByScale: boolean = false\n    @property({ tooltip: \"上/左 无限循环\" }) headerLoop: boolean = false\n    @property({ tooltip: \"下/右 无限循环\" }) footerLoop: boolean = false\n    @property(Prefab) prefab!: Prefab\n    @property(EventHandler) refreshItemEvents: EventHandler[] = []\n    @property({ tooltip: \"开启自动居中\" }) autoCenter: boolean = false\n    @property({\n        tooltip: \"自动居中的滚动时间\",\n        visible: function () { return (this as any).autoCenter }\n    }) centerTime: number = 1\n    @property({\n        type: Node,\n        tooltip: \"自动居中的参考节点，如果为空、则默认选择View中心\",\n        visible: function () { return (this as any).autoCenter }\n    }) centerNode!: Node\n    @property({\n        type: Vec2,\n        tooltip: \"自动居中时、Item的居中锚点\",\n        visible: function () { return (this as any).autoCenter }\n    }) centerAnchor: Vec2 = new Vec2(.5, .5)\n    /** 当前滚动方向 */\n    private scrollDirection: ScrollDirection = ScrollDirection.NONE\n    /** 是否垂直滚动 */\n    get vertical(): boolean { return this.layoutType == Type.VERTICAL }\n    /** 是否水平滚动 */\n    get horizontal(): boolean { return this.layoutType == Type.HORIZONTAL }\n    get transform(): UITransform | null { return this.node._uiProps.uiTransformComp }\n    /** View 可容纳的宽度 */\n    get accommodWidth() {\n        return this.view.width - this.paddingLeft - this.paddingRight\n    }\n    /** View 可容纳的高度 */\n    get accommodHeight() {\n        return this.view.height - this.paddingTop - this.paddingBottom\n    }\n    /** 头部的节点 */\n    get header(): UITransform | null {\n        if (this.node.children.length == 0) return null\n        return this.node.children[0]._uiProps.uiTransformComp\n    }\n    /** 底部的节点 */\n    get footer(): UITransform | null {\n        if (this.node.children.length == 0) return null\n        return this.node.children[this.node.children.length - 1]._uiProps.uiTransformComp\n    }\n    /** 头部索引 */\n    get headerIndex(): number {\n        if (!this.header) return -1\n        let node: any = this.header.node\n        return node[\"__index\"]\n    }\n    /** 底部索引 */\n    get footerIndex(): number {\n        if (!this.footer) return -1\n        let node: any = this.footer.node\n        return node[\"__index\"]\n    }\n    /** Item起始位置 */\n    get viewStartPoint(): Vec3 {\n        let pos = new Vec3()\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            pos.x = this.view.width * -0.5 + this.paddingLeft\n        } else {\n            pos.x = this.view.width * 0.5 - this.paddingRight\n        }\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            pos.y = this.view.height * 0.5 - this.paddingTop\n        } else {\n            pos.y = this.view.height * -0.5 + this.paddingBottom\n        }\n        return pos\n    }\n    /** View 头部边界 */\n    get viewHeaderBoundary(): number {\n        var offset = 0\n        if (this.vertical) {\n            offset = this.view.height * 0.5\n        } else {\n            offset = this.view.width * -0.5\n        }\n        return offset\n    }\n    /** View 底部边界 */\n    get viewFooterBoundary(): number {\n        var offset = 0\n        if (this.vertical) {\n            offset = this.view.height * -0.5\n        } else {\n            offset = this.view.width * 0.5\n        }\n        return offset\n    }\n    /** 头部节点边界 */\n    get headerBoundary(): number {\n        if (!this.header) return 0\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                return this.node.position.y + this.getItemYMax(this.header) + this.paddingTop\n            } else {\n                return this.node.position.y + this.getItemYMin(this.header) - this.paddingBottom\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                return this.node.position.x + this.getItemXMin(this.header) - this.paddingLeft\n            } else {\n                return this.node.position.x + this.getItemXMax(this.header) + this.paddingRight\n            }\n        }\n    }\n    /** 底部节点边界 */\n    get footerBoundary(): number {\n        if (!this.footer) return 0\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                return this.node.position.y + this.getItemYMin(this.footer) - this.paddingBottom\n            } else {\n                return this.node.position.y + this.getItemYMax(this.footer) + this.paddingTop\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                return this.node.position.x + this.getItemXMax(this.footer) + this.paddingRight\n            } else {\n                return this.node.position.x + this.getItemXMin(this.footer) - this.paddingLeft\n            }\n        }\n    }\n    /** 自动居中节点头部边界 */\n    get centerHeaderBoundary() {\n        let key = this.vertical ? \"y\" : \"x\"\n        if (this.centerNode) {\n            if (this.vertical) {\n                if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                    return this.headerBoundary + (this.viewHeaderBoundary - (this.centerNode.position as any)[key])\n                } else {\n                    return this.footerBoundary + (this.viewHeaderBoundary - (this.centerNode.position as any)[key])\n                }\n            } else {\n                if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                    return this.headerBoundary + (this.viewHeaderBoundary - (this.centerNode.position as any)[key])\n                } else {\n                    return this.footerBoundary + (this.viewHeaderBoundary - (this.centerNode.position as any)[key])\n                }\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                return this.headerBoundary + (this.viewHeaderBoundary - (this.view.node.position as any)[key])\n            } else {\n                return this.footerBoundary + (this.viewHeaderBoundary - (this.view.node.position as any)[key])\n            }\n        }\n    }\n    /** 自动居中节点底部边界 */\n    get centerFooterBoundary() {\n        let key = this.vertical ? \"y\" : \"x\"\n        if (this.centerNode) {\n            if (this.vertical) {\n                if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                    return this.footerBoundary + (this.viewFooterBoundary - (this.centerNode.position as any)[key])\n                } else {\n                    return this.headerBoundary + (this.viewFooterBoundary - (this.centerNode.position as any)[key])\n                }\n            } else {\n                if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                    return this.footerBoundary + (this.viewFooterBoundary - (this.centerNode.position as any)[key])\n                } else {\n                    return this.headerBoundary + (this.viewFooterBoundary - (this.centerNode.position as any)[key])\n                }\n            }\n        } else {\n            if (this.vertical) {\n                if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                    return this.footerBoundary + (this.viewFooterBoundary - (this.view.node.position as any)[key])\n                } else {\n                    return this.headerBoundary + (this.viewFooterBoundary - (this.view.node.position as any)[key])\n                }\n            } else {\n                if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                    return this.footerBoundary + (this.viewFooterBoundary - (this.view.node.position as any)[key])\n                } else {\n                    return this.headerBoundary + (this.viewFooterBoundary - (this.view.node.position as any)[key])\n                }\n            }\n        }\n    }\n    /** 是否超出左侧边界 */\n    get isOfLeftBoundary(): number {\n        if (this.vertical) return 0\n        if (this.autoCenter) {\n            if (this.scrollDirection == ScrollDirection.HEADER) {\n                return this.centerHeaderBoundary\n            }\n            return 0\n        }\n        if (this.headerLoop) {\n            if (this.header) return 0\n            return this.viewHeaderBoundary + this.node.position.x\n        }\n\n        if (!this.header || this.fixedItemWidth <= this.view.width) {\n            return this.viewHeaderBoundary + this.node.position.x\n        }\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            if (this.headerIndex == 0) {\n                return this.headerBoundary\n            }\n        } else {\n            if (this.footerIndex == this.itemTotal - 1) {\n                return this, this.footerBoundary\n            }\n        }\n        return 0\n    }\n    /** 是否超出顶部边界 */\n    get isOfTopBoundary(): number {\n        if (!this.vertical) return 0\n        if (this.autoCenter) {\n            if (this.scrollDirection == ScrollDirection.HEADER) {\n                return this.centerHeaderBoundary\n            }\n            return 0\n        }\n        if (this.headerLoop) {\n            if (this.header) return 0\n            return this.viewHeaderBoundary + this.node.position.y\n        }\n        if (!this.header || this.fixedItemHeight <= this.view.height) {\n            return this.viewHeaderBoundary + this.node.position.y\n        }\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            if (this.headerIndex == 0) {\n                return this.headerBoundary\n            }\n        } else {\n            if (this.footerIndex == this.itemTotal - 1) {\n                return this.footerBoundary\n            }\n        }\n        return 0\n    }\n    /** 是否超出右侧边界 */\n    get isOfRightBoundary(): number {\n        if (this.vertical) return 0\n        if (this.autoCenter) {\n            if (this.scrollDirection == ScrollDirection.FOOTER) {\n                return this.centerFooterBoundary\n            }\n            return 0\n        }\n        if (this.footerLoop) {\n            if (this.footer) return 0\n            return this.viewFooterBoundary + this.node.position.x\n        }\n        if (!this.footer || this.fixedItemWidth <= this.view.width) {\n            return this.viewFooterBoundary + this.node.position.x\n        }\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            if (this.footerIndex == this.itemTotal - 1) {\n                return this, this.footerBoundary\n            }\n        } else {\n            if (this.headerIndex == 0) {\n                return this.headerBoundary\n            }\n        }\n        return 0\n    }\n    /** 是否超出底部边界 */\n    get isOfButtomBoundary(): number {\n        if (!this.vertical) return 0\n        if (this.autoCenter) {\n            if (this.scrollDirection == ScrollDirection.FOOTER) {\n                return this.centerFooterBoundary\n            }\n            return 0\n        }\n        if (this.footerLoop) {\n            if (this.footer) return 0\n            return this.viewFooterBoundary + this.node.position.y\n        }\n        if (!this.footer || this.fixedItemHeight <= this.view.height) {\n            return this.viewFooterBoundary + this.node.position.y\n        }\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            if (this.footerIndex == this.itemTotal - 1) {\n                return this.footerBoundary\n            }\n        } else {\n            if (this.headerIndex == 0) {\n                return this.headerBoundary\n            }\n        }\n        return 0\n    }\n    /** 从头部到底部的所有Item高度总和 */\n    get fixedItemHeight(): number {\n        if (!this.header) return 0\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            return Math.abs(this.getItemYMax(this.header)) + Math.abs(this.getItemYMin(this.footer))\n        } else {\n            return Math.abs(this.getItemYMin(this.header)) + Math.abs(this.getItemYMax(this.footer))\n        }\n    }\n    /** 从头部到底部的所有Item宽度总和 */\n    get fixedItemWidth(): number {\n        if (!this.header) return 0\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            return Math.abs(this.getItemXMin(this.header)) + Math.abs(this.getItemXMax(this.footer))\n        } else {\n            return Math.abs(this.getItemXMax(this.header)) + Math.abs(this.getItemXMin(this.footer))\n        }\n    }\n    /** 返回 header到 footer 之间的整体尺寸 如果Item数量不足以撑开View 则返回View尺寸 最小值是View尺寸 */\n    get contentSize(): Size {\n        if (this.node.children.length == 0) return this.view.contentSize\n        let size = new Size(this.view.contentSize.width, this.view.contentSize.height)\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                size.height = this.headerBoundary + -this.footerBoundary + this.paddingTop + this.paddingBottom\n            } else {\n                size.height = this.footerBoundary + -this.headerBoundary + this.paddingTop + this.paddingBottom\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                size.width = this.footerBoundary + -this.headerBoundary + this.paddingLeft + this.paddingRight\n            } else {\n                size.width = this.headerBoundary + -this.footerBoundary + this.paddingLeft + this.paddingRight\n            }\n        }\n        if (size.width < this.view.contentSize.width) {\n            size.width = this.view.contentSize.width\n        }\n        if (size.height < this.view.contentSize.height) {\n            size.height = this.view.contentSize.height\n        }\n        return size\n    }\n    private prevPos: Vec3 = new Vec3(0, 0, 0)\n    private _maxPrefabTotal: number = 0\n    /** 已被创建的Item数量 */\n    get maxPrefabTotal(): number { return this._maxPrefabTotal }\n    private _itemTotal: number = 0\n    /** 数据长度 */\n    get itemTotal(): number { return this._itemTotal }\n    private gener!: Generator\n    private _centerPosition!: Vec3\n    /** 自动居中的参考位置 */\n    get centerPosition(): Vec3 {\n        if (!this._centerPosition) {\n            this._centerPosition = new Vec3()\n            if (this.autoCenter) {\n                if (this.centerNode) {\n                    let worldPos = this.centerNode.parent?._uiProps.uiTransformComp?.convertToWorldSpaceAR(this.centerNode.position)!\n                    this._centerPosition = this.view.convertToNodeSpaceAR(worldPos)\n                }\n            } else {\n                if (this.vertical) {\n                    if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                        this._centerPosition.y = this.viewHeaderBoundary\n                    } else {\n                        this._centerPosition.y = this.viewFooterBoundary\n                    }\n                } else {\n                    if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                        this._centerPosition.x = this.viewHeaderBoundary\n                    } else {\n                        this._centerPosition.x = this.viewFooterBoundary\n                    }\n                }\n            }\n        }\n        return this._centerPosition\n    }\n    onLoad() {\n        this.transform?.setContentSize(this.view.contentSize)\n        this.node.setPosition(Vec3.ZERO)\n        Object.defineProperty(this.transform, \"contentSize\", {\n            configurable: true,\n            get: () => this.contentSize,\n        })\n    }\n    onEnable() {\n        this.addEventListener()\n    }\n    onDisable() {\n        this.removeEventListener()\n    }\n    /** 更新item数量 */\n    async total(count: number) {\n        let created = await this.createItems(count)\n        let offset = count - this.itemTotal\n        this._itemTotal = count\n        if (!created) {\n            this.refreshItems(offset)\n        }\n        this.scrollView.release()\n    }\n    /** 自动居中到最近Item */\n    scrollToCenter() {\n        this.soonFinish()\n    }\n    /** 滚动到头部 */\n    scrollToHeader(timeInSecond?: number) {\n        var headerOrFooter = 0\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                headerOrFooter = this.viewHeaderBoundary\n            } else {\n                headerOrFooter = this.viewFooterBoundary\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                headerOrFooter = this.viewHeaderBoundary\n            } else {\n                headerOrFooter = this.viewFooterBoundary\n            }\n        }\n        this.scrollToIndex(0, timeInSecond, new Vec3(headerOrFooter, headerOrFooter))\n    }\n    /** 滚动到尾部 */\n    scrollToFooter(timeInSecond?: number) {\n        var headerOrFooter = 0\n        if (this.vertical) {\n            if (this.fixedItemHeight < this.view.height) return\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                headerOrFooter = this.viewFooterBoundary\n            } else {\n                headerOrFooter = this.viewHeaderBoundary\n            }\n        } else {\n            if (this.fixedItemWidth < this.view.width) return\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                headerOrFooter = this.viewFooterBoundary\n            } else {\n                headerOrFooter = this.viewHeaderBoundary\n            }\n        }\n        this.scrollToIndex(this.itemTotal - 1, timeInSecond, new Vec3(headerOrFooter, headerOrFooter), true)\n    }\n    /** 跳转到指定索引位置 */\n    scrollToIndex(index: number, timeInSecond?: number, boundary?: Vec3, reverse: boolean = false) {\n        if (isNaN(index) || index < 0 || index > this.itemTotal - 1) return\n        this.scrollView.stopAutoScroll()\n        var offset = 0\n        var child = this.node.children.find((item: any) => item[\"__index\"] == index)\n        if (!child) {\n            var isDownOffset = false\n            if (index > this.footerIndex && index < this.headerIndex) {\n                if (Math.abs(index - this.headerIndex) < Math.abs(index - this.footerIndex)) {\n                    isDownOffset = false\n                } else {\n                    isDownOffset = true\n                }\n            } else if (index > this.footerIndex) {\n                isDownOffset = true\n            } else if (index < this.headerIndex) {\n                isDownOffset = false\n            }\n            var start = 0\n            if (isDownOffset) {\n                offset = index % this.groupItemTotal - this.footerIndex % this.groupItemTotal\n                offset = Math.abs(offset)\n            } else {\n                offset = this.headerIndex % this.groupItemTotal\n                offset = Math.abs(offset)\n            }\n            for (let i = 0; i < offset; i++) {\n                if (this.vertical) {\n                    if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                        if (isDownOffset) {\n                            this.pushToFooter(true)\n                        } else {\n                            this.pushToHeader(true)\n                        }\n                    } else {\n                        if (isDownOffset) {\n                            this.pushToHeader(true)\n                        } else {\n                            this.pushToFooter(true)\n                        }\n                    }\n                } else {\n                    if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                        if (isDownOffset) {\n                            this.pushToFooter(true)\n                        } else {\n                            this.pushToHeader(true)\n                        }\n                    } else {\n                        if (isDownOffset) {\n                            this.pushToHeader(true)\n                        } else {\n                            this.pushToFooter(true)\n                        }\n                    }\n                }\n            }\n            if (isDownOffset) {\n                start = Math.abs(index - this.maxPrefabTotal) + 1\n            } else {\n                start = index < this.groupItemTotal ? 0 : index\n            }\n            for (let i = 0; i < this.node.children.length; i++) {\n                const child: any = this.node.children[i];\n                if (this.headerLoop || this.footerLoop) {\n                    if (start > this.itemTotal - 1) {\n                        start = 0\n                    }\n                }\n                child[\"__index\"] = start\n                this.notifyRefreshItem(child)\n                start++\n            }\n            child = this.node.children.find((item: any) => item[\"__index\"] == index)\n        }\n        if (!child) return\n        let itemPos = child.getPosition().clone()\n        if (!this.autoCenter) {\n            if (this.vertical) {\n                if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                    if (!reverse) {\n                        itemPos.y = this.getItemYMax(child._uiProps.uiTransformComp!) + this.paddingTop\n                    } else {\n                        itemPos.y = this.getItemYMin(child._uiProps.uiTransformComp!) - this.paddingBottom\n                    }\n                } else {\n                    if (!reverse) {\n                        itemPos.y = this.getItemYMin(child._uiProps.uiTransformComp!) - this.paddingBottom\n                    } else {\n                        itemPos.y = this.getItemYMax(child._uiProps.uiTransformComp!) + this.paddingTop\n                    }\n                }\n            } else {\n                if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                    if (!reverse) {\n                        itemPos.x = this.getItemXMin(child._uiProps.uiTransformComp!) - this.paddingLeft\n                    } else {\n                        itemPos.x = this.getItemXMax(child._uiProps.uiTransformComp!) + this.paddingRight\n                    }\n                } else {\n                    if (!reverse) {\n                        itemPos.x = this.getItemXMax(child._uiProps.uiTransformComp!) + this.paddingRight\n                    } else {\n                        itemPos.x = this.getItemXMin(child._uiProps.uiTransformComp!) - this.paddingLeft\n                    }\n                }\n            }\n        }\n        let worldPos = this.transform?.convertToWorldSpaceAR(itemPos)!\n        let localPos = this.view.convertToNodeSpaceAR(worldPos)\n        let multiple\n        if (!this.autoCenter && boundary) {\n            multiple = boundary\n        } else {\n            multiple = this.getCenterAnchor(child._uiProps.uiTransformComp!, this.centerPosition)\n        }\n        localPos.multiply(new Vec3(-1, -1, 1)).add(multiple)\n        this.scrollView.scrollToAny(localPos, timeInSecond)\n    }\n    /** 根据centerAnchor计算自动居中的真实位置 */\n    protected getCenterAnchor(item: UITransform, center: Vec3) {\n        var pos = center.clone()\n        if (this.vertical) {\n            let anchor = item.height! * this.centerAnchor.y\n            let origin = item.height! * item.anchorY!\n            pos.y -= anchor - origin\n        } else {\n            let anchor = item.width! * this.centerAnchor.x\n            let origin = item.width! * item.anchorX!\n            pos.x += anchor - origin\n        }\n        return pos\n    }\n    /** 滚动即将结束时 跑自动居中的逻辑 */\n    protected soonFinish() {\n        if (!this.autoCenter) return\n        this.scrollView.stopAutoScroll()\n        var findedPos = new Vec3(999999, 999999)\n        for (let i = 0; i < this.node.children.length; i++) {\n            const child = this.node.children[i];\n            let worldPos = this.transform?.convertToWorldSpaceAR(child.position)!\n            let localPos = this.view.convertToNodeSpaceAR(worldPos)\n            let map = { width: false, height: false }\n\n            var multiple = this.getCenterAnchor(child._uiProps.uiTransformComp!, this.centerPosition)\n\n            let newLocalPos = localPos.subtract(multiple)\n            map.width = Math.abs(newLocalPos.x) < Math.abs(findedPos.x)\n            map.height = Math.abs(newLocalPos.y) < Math.abs(findedPos.y)\n            if (this.vertical && map.height) {\n                findedPos = newLocalPos\n            } else if (!this.vertical && map.width) {\n                findedPos = newLocalPos\n            }\n        }\n        findedPos.multiply(new Vec3(-1, -1, 1))\n        this.scrollView.scrollToAny(findedPos, this.centerTime)\n    }\n    /** 根据groupItemTotal和View可容纳的尺寸 来平均分配Item该有的尺寸 */\n    protected getItemSize(item: UITransform): Size {\n        let size = new Size()\n        if (this.vertical) {\n            let spacing = this.spacingX * (this.groupItemTotal - 1)\n            size.width = (this.accommodWidth - spacing) / this.groupItemTotal\n            size.height = item.height\n        } else {\n            let spacing = this.spacingY * (this.groupItemTotal - 1)\n            size.height = (this.accommodHeight - spacing) / this.groupItemTotal\n            size.width = item.width\n        }\n        return size\n    }\n    /** 获取Item的YMax */\n    protected getItemYMax(item: UITransform | null): number {\n        if (!item) return 0\n        let height = this.getScaleHeight(item) * (1 - item.anchorY)\n        return item.node.position.y + height\n    }\n    /** 获取Item的YMin */\n    protected getItemYMin(item: UITransform | null): number {\n        if (!item) return 0\n        let height = this.getScaleHeight(item) * item.anchorY\n        return item.node.position.y - height\n    }\n    /** 获取Item的XMax */\n    protected getItemXMax(item: UITransform | null): number {\n        if (!item) return 0\n        let width = this.getScaleWidth(item) * (1 - item.anchorX)\n        return item.node.position.x + width\n    }\n    /** 获取Item的XMin */\n    protected getItemXMin(item: UITransform | null): number {\n        if (!item) return 0\n        let width = this.getScaleWidth(item) * item.anchorX\n        return item.node.position.x - width\n    }\n    /** 获取一组Item中起始位置X */\n    protected getStartX(item: UITransform | null): number {\n        if (!item) return 0\n        var x = 0\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            let width = this.getScaleWidth(item) * item.anchorX\n            x = this.viewStartPoint.x + width\n        } else {\n            let width = this.getScaleWidth(item) * (1 - item.anchorX)\n            x = this.viewStartPoint.x - width\n        }\n        return x\n    }\n    /** 获取一组Item中结束位置X */\n    protected getEndX(item: UITransform | null): number {\n        if (!item) return 0\n        var x = 0\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            let width = this.getScaleWidth(item) * (1 - item.anchorX)\n            x = -this.viewStartPoint.x - width - this.paddingRight + this.paddingLeft\n        } else {\n            let width = this.getScaleWidth(item) * item.anchorX\n            x = -this.viewStartPoint.x + width + this.paddingLeft - this.paddingRight\n        }\n        return x\n    }\n    /** 获取一组Item中起始位置Y */\n    protected getStartY(item: UITransform | null): number {\n        if (!item) return 0\n        var y = 0\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            let height = this.getScaleHeight(item) * (1 - item.anchorY)\n            y = this.viewStartPoint.y - height\n        } else {\n            let height = this.getScaleHeight(item) * item.anchorY\n            y = this.viewStartPoint.y + height\n        }\n        return y\n    }\n    /** 获取一组Item中结束位置Y */\n    protected getEndY(item: UITransform | null): number {\n        if (!item) return 0\n        var y = 0\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            let height = this.getScaleHeight(item) * item.anchorY\n            y = -this.viewStartPoint.y + height + this.paddingBottom - this.paddingTop\n        } else {\n            let height = this.getScaleHeight(item) * (1 - item.anchorY)\n            y = -this.viewStartPoint.y - height - this.paddingTop + this.paddingBottom\n        }\n        return y\n    }\n    /** relative的顶部是否有也容纳空间 */\n    protected isAccommodateByTop(relative: UITransform) {\n        var max = this.getItemYMax(relative)\n        return max + this.paddingTop < this.accommodHeight * 0.5\n    }\n    /** relative的底部是否有也容纳空间 */\n    protected isAccommodateByBottom(relative: UITransform) {\n        var min = this.getItemYMin(relative)\n        return min - this.paddingBottom > this.accommodHeight * -0.5\n    }\n    /** relative的左侧是否有也容纳空间 */\n    protected isAccommodateByLeft(relative: UITransform) {\n        var min = this.getItemXMin(relative)\n        return min - this.paddingLeft > this.accommodWidth * -0.5\n    }\n    /** relative的右侧是否有也容纳空间 */\n    protected isAccommodateByRight(relative: UITransform) {\n        var max = this.getItemXMax(relative)\n        return max + this.paddingRight < this.accommodWidth * 0.5\n    }\n    /** relative的左侧位置 */\n    protected getRelativeByLeft(item: UITransform, relative: UITransform): number {\n        var min = this.getItemXMin(relative)\n        return min - this.spacingX - this.getScaleWidth(item) * (1 - item.anchorX)\n    }\n    /** relative的右侧位置 */\n    protected getRelativeByRight(item: UITransform, relative: UITransform): number {\n        var max = this.getItemXMax(relative)\n        return max + this.spacingX + this.getScaleWidth(item) * item.anchorX\n    }\n    /** relative的顶部位置 */\n    protected getRelativeByTop(item: UITransform, relative: UITransform): number {\n        var max = this.getItemYMax(relative)\n        return max + this.spacingY + this.getScaleHeight(item) * (1 - item.anchorY)\n    }\n    /** relative的底部位置 */\n    protected getRelativeByBottom(item: UITransform, relative: UITransform): number {\n        var min = this.getItemYMin(relative)\n        return min - this.spacingY - this.getScaleHeight(item) * item.anchorY\n    }\n    /** 设置Item的坐标位置 */\n    protected setItemPosition(item: UITransform, relative: UITransform, reverse: boolean = false) {\n        var pos = new Vec3()\n        if (!this.header) {\n            pos.x = this.getStartX(item)\n            pos.y = this.getStartY(item)\n        } else {\n            if (this.vertical) {\n                pos = this.getVerticalRelativePosition(item, relative, reverse)\n            } else {\n                pos = this.getHorizontalRelativePosition(item, relative, reverse)\n            }\n        }\n        item.node.setPosition(pos)\n    }\n    /** 计算垂直模式的Item应该的位置 */\n    protected getVerticalRelativePosition(item: UITransform, relative: UITransform, reverse: boolean) {\n        var pos = new Vec3()\n        var isAccommodate = false\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            isAccommodate = !reverse ? this.isAccommodateByRight(relative) : this.isAccommodateByLeft(relative)\n        } else {\n            isAccommodate = !reverse ? this.isAccommodateByLeft(relative) : this.isAccommodateByRight(relative)\n        }\n        // 横轴\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            if (!reverse) {\n                pos.x = isAccommodate ? this.getRelativeByRight(item, relative) : this.getStartX(item)\n            } else {\n                pos.x = isAccommodate ? this.getRelativeByLeft(item, relative) : this.getEndX(item)\n            }\n        } else {\n            if (!reverse) {\n                pos.x = isAccommodate ? this.getRelativeByLeft(item, relative) : this.getStartX(item)\n            } else {\n                pos.x = isAccommodate ? this.getRelativeByRight(item, relative) : this.getEndX(item)\n            }\n        }\n        // 纵轴\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            if (!reverse) {\n                pos.y = isAccommodate ? relative.node.position.y : this.getRelativeByBottom(item, relative)\n            } else {\n                pos.y = isAccommodate ? relative.node.position.y : this.getRelativeByTop(item, relative)\n            }\n        } else {\n            if (!reverse) {\n                pos.y = isAccommodate ? relative.node.position.y : this.getRelativeByTop(item, relative)\n            } else {\n                pos.y = isAccommodate ? relative.node.position.y : this.getRelativeByBottom(item, relative)\n            }\n        }\n        return pos\n    }\n    /** 计算水平模式的Item应该的位置 */\n    protected getHorizontalRelativePosition(item: UITransform, relative: UITransform, reverse: boolean) {\n        var pos = new Vec3()\n        var isAccommodate = false\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            isAccommodate = !reverse ? this.isAccommodateByBottom(relative) : this.isAccommodateByTop(relative)\n        } else {\n            isAccommodate = !reverse ? this.isAccommodateByTop(relative) : this.isAccommodateByBottom(relative)\n        }\n        // 纵轴\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            if (!reverse) {\n                pos.y = isAccommodate ? this.getRelativeByBottom(item, relative) : this.getStartY(item)\n            } else {\n                pos.y = isAccommodate ? this.getRelativeByTop(item, relative) : this.getEndY(item)\n            }\n        } else {\n            if (!reverse) {\n                pos.y = isAccommodate ? this.getRelativeByTop(item, relative) : this.getStartY(item)\n            } else {\n                pos.y = isAccommodate ? this.getRelativeByBottom(item, relative) : this.getEndY(item)\n            }\n        }\n        // 横轴\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            if (!reverse) {\n                pos.x = isAccommodate ? relative.node.position.x : this.getRelativeByRight(item, relative)\n            } else {\n                pos.x = isAccommodate ? relative.node.position.x : this.getRelativeByLeft(item, relative)\n            }\n        } else {\n            if (!reverse) {\n                pos.x = isAccommodate ? relative.node.position.x : this.getRelativeByLeft(item, relative)\n            } else {\n                pos.x = isAccommodate ? relative.node.position.x : this.getRelativeByRight(item, relative)\n            }\n        }\n        return pos\n    }\n    /** 当数据长度发生变化时 计算item应该怎么排列 */\n    protected refreshItems(offset: number) {\n        if (offset < 0) {\n            for (let i = 0; i < -offset; i++) {\n                if (this.headerLoop) {\n                    this.pushToHeader()\n                } else if (this.footerLoop) {\n                    this.pushToHeader()\n                } else {\n                    this.pushToHeader(true)\n                }\n            }\n            let startIndex = this.headerIndex > 0 ? this.headerIndex : 0\n            for (let i = 0; i < this.node.children.length; i++) {\n                const child: any = this.node.children[i];\n                if (this.headerLoop || this.footerLoop) {\n                    if (startIndex > this.itemTotal - 1) {\n                        startIndex = 0\n                    }\n                }\n                child[\"__index\"] = startIndex\n                this.notifyRefreshItem(child)\n                startIndex++\n            }\n            this.scrollView.startAutoScroll()\n        } else {\n            for (let i = 0; i < this.node.children.length; i++) {\n                if (this.vertical) {\n                    if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                        this.pushToFooter()\n                    } else {\n                        this.pushToHeader()\n                    }\n                } else {\n                    if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                        this.pushToFooter()\n                    } else {\n                        this.pushToHeader()\n                    }\n                }\n            }\n        }\n    }\n    /** 创建Item */\n    protected async createItems(count: number) {\n        this.gener?.return(\"\")\n        // 有多余的item 需要删除 不处理\n        if (this.node.children.length > count) {\n            this.removeItems(count)\n            return false\n        }\n        // 已经固定item总数 不处理\n        if (this._maxPrefabTotal > 0 && this._maxPrefabTotal == this.node.children.length) {\n            return false\n        }\n\n        // 开始分帧创建item\n        let total = count - this.node.children.length //计算当前应该创建的总数\n        this.gener = this.getGeneratorLength(total, () => {\n            let child: any = instantiate(this.prefab)\n            child[\"__index\"] = this.node.children.length\n            const transform = child._uiProps.uiTransformComp\n            transform.setContentSize(this.getItemSize(transform))\n            this.setItemPosition(child._uiProps.uiTransformComp, this.footer!)\n            this.node.addChild(child)\n            this.notifyRefreshItem(child)\n            child[\"__size\"] = transform.contentSize.clone()\n            child[\"__scale\"] = child.getScale().clone()\n            child.on(Node.EventType.SIZE_CHANGED, this.onChildSize, this)\n            child.on(Node.EventType.TRANSFORM_CHANGED, this.onChildScale, this)\n            let selfHorW, viewHorW\n            if (this.vertical) {\n                selfHorW = this.contentSize.height\n                viewHorW = this.view.height\n            } else {\n                selfHorW = this.contentSize.width\n                viewHorW = this.view.width\n            }\n            /**\n             * 根据排列方向 来判断对比宽度还是高度\n             * 这里使用参数this.multiple来判断是否需要继续创建 默认为2倍 比如view可视尺寸为800 2倍就是1600\n             * 根据之前所创建的所有item的尺寸计算是否满足这个尺寸 如果满足则不再继续创建 \n             * 由于是分帧加载 所以下一次创建会等这一次的返回结果 返回false 则终止分帧任务\n             */\n            if (selfHorW >= viewHorW * this.multiple) {\n                this._maxPrefabTotal = this.node.children.length\n                return false\n            }\n            return true\n        })\n        await this.exeGenerator(this.gener, 20) //执行分帧任务 1帧创建10个\n        return true\n    }\n    /** 删除多余的item */\n    protected removeItems(count: number) {\n        // 有多余的item 需要删除\n        let length = this.node.children.length - count\n        // 删除掉多余的item\n        for (let i = 0; i < length; i++) {\n            var child = this.node.children[this.node.children.length - 1]\n            child.off(Node.EventType.SIZE_CHANGED, this.onChildSize, this);\n            child.off(Node.EventType.TRANSFORM_CHANGED, this.onChildScale, this);\n            child.destroy()\n            this.node.removeChild(child)\n        }\n    }\n    protected addEventListener() {\n        this.node.on(SystemEventType.TRANSFORM_CHANGED, this.onPositionChanged, this)\n    }\n    protected removeEventListener() {\n        this.node.off(SystemEventType.TRANSFORM_CHANGED, this.onPositionChanged, this)\n    }\n    /** 当Item缩放改变时 限制并改回该有的缩放 */\n    protected onChildScale(type: any) {\n        if (!this.affectedByScale) return\n        if (type == Node.TransformBit.SCALE) {\n            for (let i = 0; i < this.node.children.length; i++) {\n                const child: any = this.node.children[i];\n                const __scale = child[\"__scale\"]\n                if (this.groupItemTotal == 1) {\n                    if (this.vertical) {\n                        if (child.scale.x != __scale.x) {\n                            console.warn(\"不允许修改Item缩放X\")\n                            child.setScale(new Vec3(__scale.x, child.scale.y))\n                            return\n                        }\n                    } else {\n                        if (child.scale.y != __scale.y) {\n                            console.warn(\"不允许修改Item缩放Y\")\n                            child.setScale(new Vec3(child.scale.y, __scale.y))\n                            return\n                        }\n                    }\n                } else if (this.groupItemTotal > 1) {\n                    if (!child.scale.equals(__scale)) {\n                        console.warn(\"Grid模式不允许修改Item缩放\")\n                        child.setScale(__scale)\n                        return\n                    }\n                }\n            }\n            if (this.groupItemTotal > 1) return\n            this.resetChilds()\n        }\n    }\n    /** 当Item尺寸改变时 限制并改回该有的尺寸 */\n    protected onChildSize() {\n        for (let i = 0; i < this.node.children.length; i++) {\n            const child: any = this.node.children[i];\n            const __size = child[\"__size\"]\n            const transform = child._uiProps.uiTransformComp!\n            if (this.groupItemTotal == 1) {\n                if (this.vertical) {\n                    if (transform?.width != __size.width) {\n                        console.warn(\"不允许修改Item宽度\")\n                        transform.setContentSize(size(__size.width, transform.height))\n                        return\n                    }\n                } else {\n                    if (transform?.height != __size.height) {\n                        console.warn(\"不允许修改Item高度\")\n                        transform.setContentSize(size(transform.width, __size.height))\n                        return\n                    }\n                }\n            } else if (this.groupItemTotal > 1) {\n                if (!transform.contentSize.equals(__size)) {\n                    console.warn(\"Grid模式不允许修改Item尺寸\")\n                    transform.setContentSize(__size)\n                    return\n                }\n            }\n        }\n        if (this.groupItemTotal > 1) return\n        this.resetChilds()\n    }\n    /** 重新计算当前所有Item的位置 */\n    protected resetChilds(start: boolean = false) {\n        var prevItem: any = this.header\n        if (this.vertical && this.fixedItemHeight <= this.view.height || !this.vertical && this.fixedItemWidth <= this.view.width) {\n            let x = this.getStartX(this.header)\n            let y = this.getStartY(this.header)\n            this.header?.node.setPosition(new Vec3(x, y))\n        }\n        if (start) {\n            if (this.vertical) {\n                let x = this.getStartX(this.header)\n                this.header?.node.setPosition(new Vec3(x, this.header.node.position.y))\n            } else {\n                let y = this.getStartY(this.header)\n                this.header?.node.setPosition(new Vec3(this.header.node.position.x, y))\n            }\n        }\n        for (let i = 1; i < this.node.children.length; i++) {\n            const child = this.node.children[i];\n            const transform = child._uiProps.uiTransformComp!\n            let relative = !prevItem ? this.header : prevItem\n            this.setItemPosition(transform, relative)\n            prevItem = transform\n        }\n        this.scrollView.startAutoScroll()\n    }\n    protected getUsedScaleValue(value: number) {\n        return this.affectedByScale ? Math.abs(value) : 1;\n    }\n    protected getScaleWidth(trans: UITransform | null): number {\n        if (!trans) return 0\n        return trans.width * this.getUsedScaleValue(trans.node.scale.x)\n    }\n    protected getScaleHeight(trans: UITransform | null): number {\n        if (!trans) return 0\n        return trans.height * this.getUsedScaleValue(trans.node.scale.y)\n    }\n    protected onPositionChanged() {\n        if (this.vertical) {\n            if (this.scrollView.prevLocation.y < this.scrollView.location.y) {\n                this.scrollDirection = ScrollDirection.FOOTER\n            } else if (this.scrollView.prevLocation.y > this.scrollView.location.y) {\n                this.scrollDirection = ScrollDirection.HEADER\n            } else {\n                this.scrollDirection = ScrollDirection.NONE\n            }\n        } else {\n            if (this.scrollView.prevLocation.x > this.scrollView.location.x) {\n                this.scrollDirection = ScrollDirection.FOOTER\n            } else if (this.scrollView.prevLocation.x < this.scrollView.location.x) {\n                this.scrollDirection = ScrollDirection.HEADER\n            } else {\n                this.scrollDirection = ScrollDirection.NONE\n            }\n        }\n\n        if (this.vertical) {\n            for (let i = 0; i < this.node.children.length; i++) {\n                let isOfBoundary = Math.abs(this.prevPos.y - this.node.position.y) > EPSILON\n                if (!isOfBoundary) continue\n                if (this.prevPos.y < this.node.position.y) {\n                    this.pushToFooter()\n                } else if (this.prevPos.y > this.node.position.y) {\n                    this.pushToHeader()\n                }\n            }\n        } else {\n            for (let i = 0; i < this.node.children.length; i++) {\n                let isOfBoundary = Math.abs(this.prevPos.x - this.node.position.x) > EPSILON\n                if (!isOfBoundary) continue\n                if (this.prevPos.x > this.node.position.x) {\n                    this.pushToFooter()\n                } else if (this.prevPos.x < this.node.position.x) {\n                    this.pushToHeader()\n                }\n            }\n        }\n        this.prevPos = this.node.position.clone()\n    }\n    /** 向尾部填充 force如果为true 则强制填充 */\n    protected pushToFooter(force: boolean = false) {\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                if (force || this.headerBoundary - this.paddingTop > this.viewHeaderBoundary + this.header?.height!) {\n                    this.pushToFooterHandler()\n                }\n            } else {\n                if (force || this.footerBoundary - this.paddingTop > this.viewHeaderBoundary + this.header?.height!) {\n                    this.pushToHeaderHandler()\n                }\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                if (force || this.headerBoundary + this.paddingLeft < this.viewHeaderBoundary - this.header?.width!) {\n                    this.pushToFooterHandler()\n                }\n            } else {\n                if (force || this.footerBoundary + this.paddingLeft < this.viewHeaderBoundary - this.header?.width!) {\n                    this.pushToHeaderHandler()\n                }\n            }\n        }\n    }\n    /** 向头部填充 force如果为true 则强制填充 */\n    protected pushToHeader(force: boolean = false) {\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                if (force || this.footerBoundary + this.paddingBottom < this.viewFooterBoundary - this.footer?.height!) {\n                    this.pushToHeaderHandler()\n                }\n            } else {\n                if (force || this.headerBoundary + this.paddingBottom < this.viewFooterBoundary - this.footer?.height!) {\n                    this.pushToFooterHandler()\n                }\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                if (force || this.footerBoundary - this.paddingRight > this.viewFooterBoundary + this.footer?.width!) {\n                    this.pushToHeaderHandler()\n                }\n            } else {\n                if (force || this.headerBoundary - this.paddingRight > this.viewFooterBoundary + this.footer?.width!) {\n                    this.pushToFooterHandler()\n                }\n            }\n        }\n    }\n    protected pushToFooterHandler() {\n        var node: any = this.header?.node\n        if (this.footerLoop) {\n            if (this.footerIndex >= this.itemTotal - 1) {\n                node[\"__index\"] = 0\n            } else {\n                node[\"__index\"] = this.footerIndex + 1\n            }\n        } else {\n            if (!this.footer || this.footerIndex >= this.itemTotal - 1) return\n            node[\"__index\"] = this.footerIndex + 1\n        }\n        this.notifyRefreshItem(node)\n        this.setItemPosition(this.header!, this.footer!)\n        this.header?.node.setSiblingIndex(this.node.children.length)\n    }\n    protected pushToHeaderHandler() {\n        var node: any = this.footer?.node\n        if (this.headerLoop) {\n            if (this.headerIndex == 0) {\n                node[\"__index\"] = this.itemTotal - 1\n            } else {\n                node[\"__index\"] = this.headerIndex - 1\n            }\n        } else {\n            if (!this.header || this.headerIndex == 0) return\n            node[\"__index\"] = this.headerIndex - 1\n        }\n        this.notifyRefreshItem(node)\n        this.setItemPosition(this.footer!, this.header!, true)\n        this.footer?.node.setSiblingIndex(0)\n        // 对其头部\n        if (!this.headerLoop && this.headerIndex == 0) {\n            // 判断是否是起始位置\n            let accommodate = this.isAccommodateByLeft(this.header!)\n            if (accommodate) {\n                this.resetChilds(true)\n            }\n        }\n    }\n    /** 通知给定的node刷新数据 */\n    protected notifyRefreshItem(target: Node) {\n        EventHandler.emitEvents(this.refreshItemEvents, target, (target as any)['__index'])\n    }\n    /** 分帧加载 */\n    protected * getGeneratorLength(length: number, callback: Function, ...params: any): Generator {\n        for (let i = 0; i < length; i++) {\n            let result = callback(i, ...params)\n            if (result) {\n                yield\n            } else {\n                return\n            }\n        }\n    }\n    /** 分帧执行 */\n    protected exeGenerator(generator: Generator, duration: number) {\n        return new Promise((resolve, reject) => {\n            let gen = generator\n            let execute = () => {\n                let startTime = new Date().getTime()\n                for (let iter = gen.next(); ; iter = gen.next()) {\n                    if (iter == null || iter.done) {\n                        resolve(null)\n                        return\n                    }\n                    if (new Date().getTime() - startTime > duration) {\n                        setTimeout(() => execute(), director.getDeltaTime())\n                        return\n                    }\n                }\n            }\n            execute()\n        })\n    }\n}"]}