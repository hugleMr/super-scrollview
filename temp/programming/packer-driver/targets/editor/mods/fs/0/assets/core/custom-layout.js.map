{"version":3,"sources":["file:///Users/stevejobs/Documents/GitHub/super-scrollview/assets/core/custom-layout.ts"],"names":["_decorator","Component","Node","ccenum","UITransform","SystemEventType","director","Vec3","EventHandler","instantiate","Prefab","Size","size","CustomScrollview","ccclass","property","executeInEditMode","requireComponent","EPSILON","Type","AxisDirection","VerticalAxisDirection","HorizontalAxisDirection","ScrollDirection","CustomLayout","type","displayName","visible","autoCenter","NONE","vertical","layoutType","VERTICAL","horizontal","HORIZONTAL","transform","node","_uiProps","uiTransformComp","accommodWidth","view","width","paddingLeft","paddingRight","accommodHeight","height","paddingTop","paddingBottom","header","children","length","footer","headerIndex","footerIndex","viewStartPoint","pos","horizontalAxisDirection","LEFT_TO_RIGHT","x","verticalAxisDirection","TOP_TO_BOTTOM","y","viewHeaderBoundary","offset","viewFooterBoundary","headerBoundary","position","getItemYMax","getItemYMin","getItemXMin","getItemXMax","footerBoundary","centerHeaderBoundary","key","centerNode","centerFooterBoundary","isOfLeftBoundary","scrollDirection","HEADER","headerLoop","fixedItemWidth","itemTotal","isOfRightBoundary","FOOTER","footerLoop","isOfTopBoundary","fixedItemHeight","isOfButtomBoundary","Math","abs","maxPrefabTotal","_maxPrefabTotal","_itemTotal","total","count","created","createItems","refreshItems","scrollView","release","centerPosition","_centerPosition","worldPos","parent","convertToWorldSpaceAR","convertToNodeSpaceAR","soonFinish","findedPos","i","child","localPos","map","newLocalPos","subtract","multiply","scrollToAny","centerTime","scrollToIndex","index","timeInSecond","boundary","reverse","isNaN","find","item","isDownOffset","start","groupItemTotal","pushToFooter","pushToHeader","console","error","notifyRefreshItem","itemPos","getPosition","multiple","add","stopAutoScroll","scrollToHeader","scrollToFooter","contentSize","getItemSize","spacing","spacingX","spacingY","getScaleHeight","anchorY","getScaleWidth","anchorX","getStartX","getEndX","getStartY","getEndY","isAccommodateByTop","relative","max","isAccommodateByBottom","min","isAccommodateByLeft","isAccommodateByRight","getRelativeByLeft","getRelativeByRight","getRelativeByTop","getRelativeByBottom","setItemPosition","isAccommodate","setPosition","startIndex","startAutoScroll","gener","return","removeItems","getGeneratorLength","prefab","setContentSize","clone","getScale","on","EventType","SIZE_CHANGED","onChildSize","TRANSFORM_CHANGED","onChildScale","addChild","selfHorW","viewHorW","exeGenerator","off","destroy","removeChild","onLoad","Object","defineProperty","configurable","get","onEnable","addEventListener","onDisable","removeEventListener","onPositionChanged","affectedByScale","TransformBit","SCALE","__scale","scale","warn","setScale","equals","resetChilds","__size","prevItem","getUsedScaleValue","value","trans","prevLocation","location","isOfBoundary","prevPos","force","pushToFooterHandler","pushToHeaderHandler","setSiblingIndex","accommodate","target","emitEvents","refreshItemEvents","callback","params","result","generator","duration","Promise","resolve","reject","gen","execute","startTime","Date","getTime","iter","next","done","setTimeout","getDeltaTime","HEADER_TO_FOOTER"],"mappings":"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;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,gBAAI,KAAK9F,QAAT,EAAmB;AACf,kBAAIuI,aAAa,GAAG,KAApB;;AACA,kBAAI,KAAK7G,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,oBAAI,CAACgE,OAAL,EAAc;AACV4C,kBAAAA,aAAa,GAAG,KAAKN,oBAAL,CAA0BL,QAA1B,CAAhB;AACH,iBAFD,MAEO;AACHW,kBAAAA,aAAa,GAAG,KAAKP,mBAAL,CAAyBJ,QAAzB,CAAhB;AACH;AACJ,eAND,MAMO;AACH,oBAAI,CAACjC,OAAL,EAAc;AACV4C,kBAAAA,aAAa,GAAG,KAAKP,mBAAL,CAAyBJ,QAAzB,CAAhB;AACH,iBAFD,MAEO;AACHW,kBAAAA,aAAa,GAAG,KAAKN,oBAAL,CAA0BL,QAA1B,CAAhB;AACH;AACJ,eAdc,CAef;;;AACA,kBAAI,KAAKlG,uBAAL,IAAgClC,uBAAuB,CAACmC,aAA5D,EAA2E;AACvE,oBAAI,CAACgE,OAAL,EAAc;AACV,sBAAI4C,aAAJ,EAAmB;AACf9G,oBAAAA,GAAG,CAA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","sourcesContent":["\nimport { _decorator, Component, Node, ccenum, UITransform, SystemEventType, director, Director, Vec3, Label, EventHandler, instantiate, Prefab, Size, ScrollView, Vec2, size } from 'cc';\nimport { isThisSecond } from 'date-fns';\nimport { CustomScrollview } from './custom-scrollview';\nimport { Notify } from './framework/singles/notify';\nconst { ccclass, property, executeInEditMode, requireComponent } = _decorator;\nconst EPSILON = 1e-4\nenum Type {\n    HORIZONTAL = 0,\n    VERTICAL = 1,\n}\nccenum(Type)\nenum AxisDirection {\n    HEADER_TO_FOOTER = 0,\n    FOOTER_TO_HEADER = 1,\n}\nccenum(AxisDirection)\nenum VerticalAxisDirection {\n    TOP_TO_BOTTOM = 0,\n    BOTTOM_TO_TOP = 1\n}\nccenum(VerticalAxisDirection)\nenum HorizontalAxisDirection {\n    LEFT_TO_RIGHT = 0,\n    RIGHT_TO_LEFT = 1\n}\nccenum(HorizontalAxisDirection)\nenum ScrollDirection {\n    NONE = 0,\n    HEADER = 1,\n    FOOTER = 2,\n}\n@ccclass('CustomLayout')\n@requireComponent(UITransform)\nexport class CustomLayout extends Component {\n    @property(CustomScrollview) scrollView!: CustomScrollview\n    @property(UITransform) view!: UITransform\n    @property groupItemTotal: number = 1\n    @property({ type: Type }) layoutType: Type = Type.VERTICAL\n    @property({\n        type: VerticalAxisDirection,\n        displayName: \"纵向轴方向\"\n    }) verticalAxisDirection = VerticalAxisDirection.TOP_TO_BOTTOM\n    @property({\n        type: HorizontalAxisDirection,\n        displayName: \"横向轴方向\"\n    }) horizontalAxisDirection = HorizontalAxisDirection.LEFT_TO_RIGHT\n    @property multiple: number = 2\n    @property({\n        type: AxisDirection,\n    }) axisDirection: AxisDirection = AxisDirection.HEADER_TO_FOOTER\n\n    @property paddingTop: number = 0\n    @property paddingBottom: number = 0\n    @property paddingLeft: number = 0\n    @property paddingRight: number = 0\n    @property spacingX: number = 0\n    @property spacingY: number = 0\n    @property affectedByScale: boolean = false\n    @property autoCenter: boolean = true\n    @property({\n        visible: function () { return this.autoCenter }\n    }) centerTime: number = 1\n    @property({\n        type: Node,\n        visible: function () { return this.autoCenter }\n    }) centerNode!: Node\n\n    @property(Prefab) prefab!: Prefab\n    @property(EventHandler) refreshItemEvents: EventHandler[] = []\n\n    @property headerLoop: boolean = false\n    @property footerLoop: boolean = false\n\n    private scrollDirection: ScrollDirection = ScrollDirection.NONE\n\n    get vertical(): boolean { return this.layoutType == Type.VERTICAL }\n    get horizontal(): boolean { return this.layoutType == Type.HORIZONTAL }\n\n    get transform(): UITransform | null { return this.node._uiProps.uiTransformComp }\n    /** 可容纳item的真实宽度 */\n    get accommodWidth() {\n        return this.view.width - this.paddingLeft - this.paddingRight\n    }\n    /** 可容纳item的真实高度 */\n    get accommodHeight() {\n        return this.view.height - this.paddingTop - this.paddingBottom\n    }\n    get header(): UITransform | null {\n        if (this.node.children.length == 0) return null\n        return this.node.children[0]._uiProps.uiTransformComp\n    }\n    get footer(): UITransform | null {\n        if (this.node.children.length == 0) return null\n        return this.node.children[this.node.children.length - 1]._uiProps.uiTransformComp\n    }\n    get headerIndex(): number {\n        if (!this.header) return -1\n        let node: any = this.header.node\n        return node[\"__index\"]\n    }\n    get footerIndex(): number {\n        if (!this.footer) return -1\n        let node: any = this.footer.node\n        return node[\"__index\"]\n    }\n    /** 起始位置 */\n    get viewStartPoint(): Vec3 {\n        let pos = new Vec3()\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            pos.x = this.view.width * -0.5 + this.paddingLeft\n        } else {\n            pos.x = this.view.width * 0.5 - this.paddingRight\n        }\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            pos.y = this.view.height * 0.5 - this.paddingTop\n        } else {\n            pos.y = this.view.height * -0.5 + this.paddingBottom\n        }\n        return pos\n    }\n    get viewHeaderBoundary(): number {\n        var offset = 0\n        if (this.vertical) {\n            offset = this.view.height * 0.5\n        } else {\n            offset = this.view.width * -0.5\n        }\n        return offset\n    }\n    get viewFooterBoundary(): number {\n        var offset = 0\n        if (this.vertical) {\n            offset = this.view.height * -0.5\n        } else {\n            offset = this.view.width * 0.5\n        }\n        return offset\n    }\n    get headerBoundary(): number {\n        if (!this.header) return 0\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                return this.node.position.y + this.getItemYMax(this.header) + this.paddingTop\n            } else {\n                return this.node.position.y + this.getItemYMin(this.header) - this.paddingBottom\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                return this.node.position.x + this.getItemXMin(this.header) - this.paddingLeft\n            } else {\n                return this.node.position.x + this.getItemXMax(this.header) + this.paddingRight\n            }\n        }\n    }\n    get footerBoundary(): number {\n        if (!this.footer) return 0\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                return this.node.position.y + this.getItemYMin(this.footer) - this.paddingBottom\n            } else {\n                return this.node.position.y + this.getItemYMax(this.footer) + this.paddingTop\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                return this.node.position.x + this.getItemXMax(this.footer) + this.paddingRight\n            } else {\n                return this.node.position.x + this.getItemXMin(this.footer) - this.paddingLeft\n            }\n        }\n    }\n    get centerHeaderBoundary() {\n        let key = this.vertical ? \"y\" : \"x\"\n        if (this.centerNode) {\n            return this.headerBoundary + (this.viewHeaderBoundary - (this.centerNode.position as any)[key])\n        } else {\n            return this.headerBoundary + (this.viewHeaderBoundary - (this.view.node.position as any)[key])\n        }\n    }\n    get centerFooterBoundary() {\n        let key = this.vertical ? \"y\" : \"x\"\n        if (this.centerNode) {\n            return this.footerBoundary + (this.viewFooterBoundary - (this.centerNode.position as any)[key])\n        } else {\n            return this.footerBoundary + (this.viewFooterBoundary - (this.view.node.position as any)[key])\n        }\n    }\n\n    get isOfLeftBoundary(): number {\n        if (this.vertical) return 0\n        if (this.autoCenter) {\n            if (this.scrollDirection == ScrollDirection.HEADER) {\n                return this.centerHeaderBoundary\n            }\n            return 0\n        }\n        if (this.headerLoop) {\n            if (this.header) return 0\n            return this.viewHeaderBoundary + this.node.position.x\n        }\n\n        if (!this.header || this.fixedItemWidth <= this.view.width) {\n            return this.viewHeaderBoundary + this.node.position.x\n        }\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            if (this.headerIndex == 0) {\n                return this.headerBoundary\n            }\n        } else {\n            if (this.footerIndex == this.itemTotal - 1) {\n                return this, this.footerBoundary\n            }\n        }\n        return 0\n    }\n    get isOfRightBoundary(): number {\n        if (this.vertical) return 0\n        if (this.autoCenter) {\n            if (this.scrollDirection == ScrollDirection.FOOTER) {\n                return this.centerFooterBoundary\n            }\n            return 0\n        }\n        if (this.footerLoop) {\n            if (this.footer) return 0\n            return this.viewFooterBoundary + this.node.position.x\n        }\n\n        if (!this.header || this.fixedItemWidth <= this.view.width) {\n            return this.viewFooterBoundary + this.node.position.x\n        }\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            if (this.footerIndex == this.itemTotal - 1) {\n                return this, this.footerBoundary\n            }\n        } else {\n            if (this.headerIndex == 0) {\n                return this.headerBoundary\n            }\n        }\n\n        return 0\n    }\n    get isOfTopBoundary(): number {\n        if (!this.vertical) return 0\n        if (this.autoCenter) {\n            if (this.scrollDirection == ScrollDirection.HEADER) {\n                return this.centerHeaderBoundary\n            }\n            return 0\n        }\n\n        if (this.headerLoop) {\n            if (this.header) return 0\n            return this.viewHeaderBoundary + this.node.position.y\n        }\n        if (!this.header || this.fixedItemHeight <= this.view.height) {\n            return this.viewHeaderBoundary + this.node.position.y\n        }\n\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            if (this.headerIndex == 0) {\n                return this.headerBoundary\n            }\n        } else {\n            if (this.footerIndex == this.itemTotal - 1) {\n                return this.footerBoundary\n            }\n        }\n        return 0\n    }\n    get isOfButtomBoundary(): number {\n        if (!this.vertical) return 0\n        if (this.autoCenter) {\n            if (this.scrollDirection == ScrollDirection.FOOTER) {\n                return this.centerFooterBoundary\n            }\n            return 0\n        }\n        if (this.footerLoop) {\n            if (this.footer) return 0\n            return this.viewFooterBoundary + this.node.position.y\n        }\n        if (!this.footer || this.fixedItemHeight <= this.view.height) {\n            return this.viewFooterBoundary + this.node.position.y\n        }\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            if (this.footerIndex == this.itemTotal - 1) {\n                return this.footerBoundary\n            }\n        } else {\n            if (this.headerIndex == 0) {\n                return this.headerBoundary\n            }\n        }\n        return 0\n    }\n    get fixedItemHeight(): number {\n        if (!this.header) return 0\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            return Math.abs(this.getItemYMax(this.header)) + Math.abs(this.getItemYMin(this.footer))\n        } else {\n            return Math.abs(this.getItemYMin(this.header)) + Math.abs(this.getItemYMax(this.footer))\n        }\n    }\n    get fixedItemWidth(): number {\n        if (!this.header) return 0\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            return Math.abs(this.getItemXMin(this.header)) + Math.abs(this.getItemXMax(this.footer))\n        } else {\n            return Math.abs(this.getItemXMax(this.header)) + Math.abs(this.getItemXMin(this.footer))\n        }\n    }\n    private prevPos: Vec3 = new Vec3(0, 0, 0)\n\n\n\n    private _maxPrefabTotal: number = 0\n    get maxPrefabTotal(): number { return this._maxPrefabTotal }\n    private _itemTotal: number = 0\n    get itemTotal(): number { return this._itemTotal }\n\n    private gener!: Generator\n    async total(count: number) {\n        let created = await this.createItems(count)\n        let offset = count - this.itemTotal\n        this._itemTotal = count\n        if (!created) {\n            this.refreshItems(offset)\n        }\n        this.scrollView.release()\n    }\n    private _centerPosition!: Vec3\n    get centerPosition(): Vec3 {\n        if (!this._centerPosition) {\n            this._centerPosition = new Vec3()\n            if (this.autoCenter) {\n                if (this.centerNode) {\n                    let worldPos = this.centerNode.parent?._uiProps.uiTransformComp?.convertToWorldSpaceAR(this.centerNode.position)!\n                    this._centerPosition = this.view.convertToNodeSpaceAR(worldPos)\n                }\n            } else {\n                if (this.vertical) {\n                    if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                        this._centerPosition.y = this.viewHeaderBoundary\n                    } else {\n                        this._centerPosition.y = this.viewFooterBoundary\n                    }\n                } else {\n                    if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                        this._centerPosition.x = this.viewHeaderBoundary\n                    } else {\n                        this._centerPosition.x = this.viewFooterBoundary\n                    }\n                }\n            }\n        }\n        return this._centerPosition\n    }\n    soonFinish() {\n        if (!this.autoCenter) return\n        var findedPos = new Vec3(999999, 999999)\n        for (let i = 0; i < this.node.children.length; i++) {\n            const child = this.node.children[i];\n            let worldPos = this.transform?.convertToWorldSpaceAR(child.position)!\n            let localPos = this.view.convertToNodeSpaceAR(worldPos)\n            let map = { width: false, height: false }\n            let newLocalPos = localPos.subtract(this.centerPosition)\n            map.width = Math.abs(newLocalPos.x) < Math.abs(findedPos.x)\n            map.height = Math.abs(newLocalPos.y) < Math.abs(findedPos.y)\n            if (this.vertical && map.height) {\n                findedPos = newLocalPos\n            } else if (!this.vertical && map.width) {\n                findedPos = newLocalPos\n            }\n        }\n        findedPos.multiply(new Vec3(-1, -1, 1))\n        this.scrollView.scrollToAny(findedPos, this.centerTime)\n    }\n\n    scrollToIndex(index: number, timeInSecond?: number, boundary?: Vec3, reverse: boolean = false) {\n        if (isNaN(index) || index < 0 || index > this.itemTotal - 1) return\n        var offset = 0\n        var child = this.node.children.find((item: any) => item[\"__index\"] == index)\n        if (!child) {\n            var isDownOffset = false\n            if (index > this.footerIndex && index < this.headerIndex) {\n                if (Math.abs(index - this.headerIndex) < Math.abs(index - this.footerIndex)) {\n                    isDownOffset = false\n                } else {\n                    isDownOffset = true\n                }\n            } else if (index > this.footerIndex) {\n                isDownOffset = true\n            } else if (index < this.headerIndex) {\n                isDownOffset = false\n            }\n            var start = 0\n            if (isDownOffset) {\n                offset = index % this.groupItemTotal - this.footerIndex % this.groupItemTotal\n                offset = Math.abs(offset)\n            } else {\n                offset = this.headerIndex % this.groupItemTotal\n                offset = Math.abs(offset)\n            }\n            for (let i = 0; i < offset; i++) {\n                if (this.vertical) {\n                    if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                        if (isDownOffset) {\n                            this.pushToFooter(true)\n                        } else {\n                            this.pushToHeader(true)\n                            console.error(\"向上填充完成\")\n                        }\n                    } else {\n                        if (isDownOffset) {\n                            this.pushToHeader(true)\n                        } else {\n                            this.pushToFooter(true)\n                        }\n                    }\n                } else {\n                    if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                        if (isDownOffset) {\n                            this.pushToFooter(true)\n                        } else {\n                            this.pushToHeader(true)\n                        }\n                    } else {\n                        if (isDownOffset) {\n                            this.pushToHeader(true)\n                        } else {\n                            this.pushToFooter(true)\n                        }\n                    }\n                }\n            }\n            if (isDownOffset) {\n                start = Math.abs(index - this.maxPrefabTotal) + 1\n                // console.error(\"向下 起始位置\", start)\n            } else {\n                if (index < this.groupItemTotal) {\n                    start = 0\n                } else {\n                    start = index\n                }\n                // console.error(\"向上 起始位置\", start)\n            }\n            for (let i = 0; i < this.node.children.length; i++) {\n                const child: any = this.node.children[i];\n                if (this.headerLoop || this.footerLoop) {\n                    if (start > this.itemTotal - 1) {\n                        start = 0\n                    }\n                }\n                child[\"__index\"] = start\n                // console.log(start)\n                this.notifyRefreshItem(child)\n                start++\n            }\n            child = this.node.children.find((item: any) => item[\"__index\"] == index)\n        }\n        if (!child) return\n        let itemPos = child.getPosition()\n        if (!this.autoCenter) {\n            if (this.vertical) {\n                if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                    if (!reverse) {\n                        itemPos.y = this.getItemYMax(child._uiProps.uiTransformComp!) + this.paddingTop\n                    } else {\n                        itemPos.y = this.getItemYMin(child._uiProps.uiTransformComp!) - this.paddingBottom\n                    }\n                } else {\n                    if (!reverse) {\n                        itemPos.y = this.getItemYMin(child._uiProps.uiTransformComp!) - this.paddingBottom\n                    } else {\n                        itemPos.y = this.getItemYMax(child._uiProps.uiTransformComp!) + this.paddingTop\n                    }\n                }\n            } else {\n                if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                    if (!reverse) {\n                        itemPos.x = this.getItemXMin(child._uiProps.uiTransformComp!) - this.paddingLeft\n                    } else {\n                        itemPos.x = this.getItemXMax(child._uiProps.uiTransformComp!) + this.paddingRight\n                    }\n                } else {\n                    if (!reverse) {\n                        itemPos.x = this.getItemXMax(child._uiProps.uiTransformComp!) + this.paddingRight\n                    } else {\n                        itemPos.x = this.getItemXMin(child._uiProps.uiTransformComp!) - this.paddingLeft\n                    }\n                }\n            }\n        }\n\n        let worldPos = this.transform?.convertToWorldSpaceAR(itemPos)!\n        let localPos = this.view.convertToNodeSpaceAR(worldPos)\n        let multiple\n        if (!this.autoCenter && boundary) {\n            multiple = boundary\n        } else {\n            multiple = this.centerPosition\n        }\n        localPos.multiply(new Vec3(-1, -1, 1)).add(multiple)\n        this.scrollView.stopAutoScroll()\n        this.scrollView.scrollToAny(localPos, timeInSecond)\n    }\n    scrollToHeader(timeInSecond?: number) {\n        this.scrollToIndex(0, timeInSecond, new Vec3(this.viewHeaderBoundary, this.viewHeaderBoundary))\n    }\n    scrollToFooter(timeInSecond?: number) {\n        this.scrollToIndex(this.itemTotal - 1, timeInSecond, new Vec3(this.viewFooterBoundary, this.viewFooterBoundary), true)\n    }\n    /** 返回 header到 footer 之间的整体尺寸 */\n    get contentSize(): Size {\n        if (this.node.children.length == 0) return this.view.contentSize\n        let size = new Size(this.view.contentSize.width, this.view.contentSize.height)\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                size.height = this.headerBoundary + -this.footerBoundary + this.paddingTop + this.paddingBottom\n            } else {\n                size.height = this.footerBoundary + -this.headerBoundary + this.paddingTop + this.paddingBottom\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                size.width = this.footerBoundary + -this.headerBoundary + this.paddingLeft + this.paddingRight\n            } else {\n                size.width = this.headerBoundary + -this.footerBoundary + this.paddingLeft + this.paddingRight\n            }\n        }\n        if (size.width < this.view.contentSize.width) {\n            size.width = this.view.contentSize.width\n        }\n        if (size.height < this.view.contentSize.height) {\n            size.height = this.view.contentSize.height\n        }\n        return size\n    }\n    private getItemSize(item: UITransform): Size {\n        let size = new Size()\n        if (this.vertical) {\n            let spacing = this.spacingX * (this.groupItemTotal - 1)\n            size.width = (this.accommodWidth - spacing) / this.groupItemTotal\n            size.height = item.height\n        } else {\n            let spacing = this.spacingY * (this.groupItemTotal - 1)\n            size.height = (this.accommodHeight - spacing) / this.groupItemTotal\n            size.width = item.width\n        }\n        return size\n    }\n    private getItemYMax(item: UITransform | null): number {\n        if (!item) return 0\n        let height = this.getScaleHeight(item) * (1 - item.anchorY)\n        return item.node.position.y + height\n    }\n    private getItemYMin(item: UITransform | null): number {\n        if (!item) return 0\n        let height = this.getScaleHeight(item) * item.anchorY\n        return item.node.position.y - height\n    }\n    private getItemXMax(item: UITransform | null): number {\n        if (!item) return 0\n        let width = this.getScaleWidth(item) * (1 - item.anchorX)\n        return item.node.position.x + width\n    }\n    private getItemXMin(item: UITransform | null): number {\n        if (!item) return 0\n        let width = this.getScaleWidth(item) * item.anchorX\n        return item.node.position.x - width\n    }\n\n    private getStartX(item: UITransform | null): number {\n        if (!item) return 0\n        var x = 0\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            let width = this.getScaleWidth(item) * item.anchorX\n            x = this.viewStartPoint.x + width\n        } else {\n            let width = this.getScaleWidth(item) * (1 - item.anchorX)\n            x = this.viewStartPoint.x - width\n        }\n        return x\n    }\n    private getEndX(item: UITransform | null): number {\n        if (!item) return 0\n        var x = 0\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            let width = this.getScaleWidth(item) * (1 - item.anchorX)\n            x = -this.viewStartPoint.x - width\n        } else {\n            let width = this.getScaleWidth(item) * item.anchorX\n            x = -this.viewStartPoint.x + width\n        }\n        return x\n    }\n    private getStartY(item: UITransform | null): number {\n        if (!item) return 0\n        var y = 0\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            let height = this.getScaleHeight(item) * (1 - item.anchorY)\n            y = this.viewStartPoint.y - height\n        } else {\n            let height = this.getScaleHeight(item) * item.anchorY\n            y = this.viewStartPoint.y + height\n        }\n        return y\n    }\n    private getEndY(item: UITransform | null): number {\n        if (!item) return 0\n        var y = 0\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            let height = this.getScaleHeight(item) * item.anchorY\n            y = -this.viewStartPoint.y + height\n        } else {\n            let height = this.getScaleHeight(item) * (1 - item.anchorY)\n            y = -this.viewStartPoint.y - height\n        }\n        return y\n    }\n    private isAccommodateByTop(relative: UITransform) {\n        var max = this.getItemYMax(relative)\n        return max + this.paddingTop < this.accommodHeight * 0.5\n    }\n    private isAccommodateByBottom(relative: UITransform) {\n        var min = this.getItemYMin(relative)\n        return min - this.paddingBottom > this.accommodHeight * -0.5\n    }\n    /** 左侧是否可以容纳 */\n    private isAccommodateByLeft(relative: UITransform) {\n        var min = this.getItemXMin(relative)\n        return min - this.paddingLeft > this.accommodWidth * -0.5\n    }\n    private isAccommodateByRight(relative: UITransform) {\n        var max = this.getItemXMax(relative)\n        return max + this.paddingRight < this.accommodWidth * 0.5\n    }\n    private getRelativeByLeft(item: UITransform, relative: UITransform): number {\n        var min = this.getItemXMin(relative)\n        return min - this.spacingX - this.getScaleWidth(item) * (1 - item.anchorX)\n    }\n    private getRelativeByRight(item: UITransform, relative: UITransform): number {\n        var max = this.getItemXMax(relative)\n        return max + this.spacingX + this.getScaleWidth(item) * item.anchorX\n    }\n    private getRelativeByTop(item: UITransform, relative: UITransform): number {\n        var max = this.getItemYMax(relative)\n        return max + this.spacingY + this.getScaleHeight(item) * (1 - item.anchorY)\n    }\n    private getRelativeByBottom(item: UITransform, relative: UITransform): number {\n        var min = this.getItemYMin(relative)\n        return min - this.spacingY - this.getScaleHeight(item) * item.anchorY\n    }\n    private setItemPosition(item: UITransform, relative: UITransform | null, reverse: boolean = false) {\n\n        var pos = new Vec3()\n        if (!this.header) {\n            pos.x = this.getStartX(item)\n            pos.y = this.getStartY(item)\n        } else {\n            // if (this.vertical) {\n            //     var isAccommodate = false\n            //     if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            //         if (!reverse) {\n            //             isAccommodate = this.isAccommodateByRight(this.footer!)\n            //         } else {\n            //             isAccommodate = this.isAccommodateByLeft(this.header!)\n            //         }\n            //     } else {\n            //         if (!reverse) {\n            //             isAccommodate = this.isAccommodateByLeft(this.footer!)\n            //         } else {\n            //             isAccommodate = this.isAccommodateByRight(this.header!)\n            //         }\n            //     }\n            //     // 横轴\n            //     if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.x = this.getRelativeByRight(item, this.footer!)\n            //             } else {\n            //                 pos.x = this.getStartX(item)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.x = this.getRelativeByLeft(item, this.header!)\n            //             } else {\n            //                 pos.x = this.getEndX(item)\n            //             }\n            //         }\n            //     } else {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.x = this.getRelativeByLeft(item, this.footer!)\n            //             } else {\n            //                 pos.x = this.getStartX(item)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.x = this.getRelativeByRight(item, this.header!)\n            //             } else {\n            //                 pos.x = this.getEndX(item)\n            //             }\n            //         }\n            //     }\n            //     // 纵轴\n            //     if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.y = this.footer?.node.position.y!\n            //             } else {\n            //                 pos.y = this.getRelativeByBottom(item, this.footer!)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.y = this.header?.node.position.y!\n            //             } else {\n            //                 pos.y = this.getRelativeByTop(item, this.header!)\n            //             }\n            //         }\n            //     } else {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.y = this.footer?.node.position.y!\n            //             } else {\n            //                 pos.y = this.getRelativeByTop(item, this.footer!)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.y = this.header?.node.position.y!\n            //             } else {\n            //                 pos.y = this.getRelativeByBottom(item, this.header!)\n            //             }\n            //         }\n            //     }\n            // } else {\n            //     var isAccommodate = false\n            //     if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            //         if (!reverse) {\n            //             isAccommodate = this.isAccommodateByBottom(this.footer!)\n            //         } else {\n            //             isAccommodate = this.isAccommodateByTop(this.header!)\n            //         }\n            //     } else {\n            //         if (!reverse) {\n            //             isAccommodate = this.isAccommodateByTop(this.footer!)\n            //         } else {\n            //             isAccommodate = this.isAccommodateByBottom(this.header!)\n            //         }\n            //     }\n            //     // 纵轴\n            //     if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.y = this.getRelativeByBottom(item, this.footer!)\n            //             } else {\n            //                 pos.y = this.getStartY(item)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.y = this.getRelativeByTop(item, this.header!)\n            //             } else {\n            //                 pos.y = this.getEndY(item)\n            //             }\n            //         }\n            //     } else {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.y = this.getRelativeByTop(item, this.footer!)\n            //             } else {\n            //                 pos.y = this.getStartY(item)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.y = this.getRelativeByBottom(item, this.header!)\n            //             } else {\n            //                 pos.y = this.getEndY(item)\n            //             }\n            //         }\n            //     }\n\n\n            //     // 横轴\n            //     if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.x = this.footer?.node.position.x!\n            //             } else {\n            //                 pos.x = this.getRelativeByRight(item, this.footer!)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.x = this.header.node.position.x\n            //             } else {\n            //                 pos.x = this.getRelativeByLeft(item, this.header!)\n            //             }\n            //         }\n            //     } else {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.x = this.footer?.node.position.x!\n            //             } else {\n            //                 pos.x = this.getRelativeByLeft(item, this.footer!)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.x = this.header.node.position.x\n            //             } else {\n            //                 pos.x = this.getRelativeByRight(item, this.header)\n            //             }\n            //         }\n            //     }\n            // }\n\n            if (this.vertical) {\n                var isAccommodate = false\n                if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                    if (!reverse) {\n                        isAccommodate = this.isAccommodateByRight(relative)\n                    } else {\n                        isAccommodate = this.isAccommodateByLeft(relative)\n                    }\n                } else {\n                    if (!reverse) {\n                        isAccommodate = this.isAccommodateByLeft(relative)\n                    } else {\n                        isAccommodate = this.isAccommodateByRight(relative)\n                    }\n                }\n                // 横轴\n                if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.x = this.getRelativeByRight(item, relative)\n                        } else {\n                            pos.x = this.getStartX(item)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.x = this.getRelativeByLeft(item, relative)\n                        } else {\n                            pos.x = this.getEndX(item)\n                        }\n                    }\n                } else {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.x = this.getRelativeByLeft(item, relative)\n                        } else {\n                            pos.x = this.getStartX(item)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.x = this.getRelativeByRight(item, relative)\n                        } else {\n                            pos.x = this.getEndX(item)\n                        }\n                    }\n                }\n                // 纵轴\n                if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.y = relative.node.position.y!\n                        } else {\n                            pos.y = this.getRelativeByBottom(item, relative)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.y = relative.node.position.y!\n                        } else {\n                            pos.y = this.getRelativeByTop(item, relative)\n                        }\n                    }\n                } else {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.y = relative.node.position.y!\n                        } else {\n                            pos.y = this.getRelativeByTop(item, relative)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.y = relative.node.position.y!\n                        } else {\n                            pos.y = this.getRelativeByBottom(item, relative)\n                        }\n                    }\n                }\n            } else {\n                var isAccommodate = false\n                if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                    if (!reverse) {\n                        isAccommodate = this.isAccommodateByBottom(relative)\n                    } else {\n                        isAccommodate = this.isAccommodateByTop(relative)\n                    }\n                } else {\n                    if (!reverse) {\n                        isAccommodate = this.isAccommodateByTop(relative)\n                    } else {\n                        isAccommodate = this.isAccommodateByBottom(relative)\n                    }\n                }\n                // 纵轴\n                if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.y = this.getRelativeByBottom(item, relative)\n                        } else {\n                            pos.y = this.getStartY(item)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.y = this.getRelativeByTop(item, relative)\n                        } else {\n                            pos.y = this.getEndY(item)\n                        }\n                    }\n                } else {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.y = this.getRelativeByTop(item, relative)\n                        } else {\n                            pos.y = this.getStartY(item)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.y = this.getRelativeByBottom(item, relative)\n                        } else {\n                            pos.y = this.getEndY(item)\n                        }\n                    }\n                }\n\n\n                // 横轴\n                if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.x = relative.node.position.x!\n                        } else {\n                            pos.x = this.getRelativeByRight(item, relative)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.x = relative.node.position.x\n                        } else {\n                            pos.x = this.getRelativeByLeft(item, relative)\n                        }\n                    }\n                } else {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.x = relative.node.position.x!\n                        } else {\n                            pos.x = this.getRelativeByLeft(item, relative)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.x = relative.node.position.x\n                        } else {\n                            pos.x = this.getRelativeByRight(item, relative)\n                        }\n                    }\n                }\n            }\n        }\n\n        item.node.setPosition(pos)\n\n    }\n\n    private refreshItems(offset: number) {\n        if (offset < 0) {\n            for (let i = 0; i < -offset; i++) {\n                if (this.headerLoop) {\n                    this.pushToHeader()\n                } else if (this.footerLoop) {\n                    this.pushToHeader()\n                } else {\n                    this.pushToHeader(true)\n                }\n            }\n            let startIndex = this.headerIndex > 0 ? this.headerIndex : 0\n            for (let i = 0; i < this.node.children.length; i++) {\n                const child: any = this.node.children[i];\n                if (this.headerLoop || this.footerLoop) {\n                    if (startIndex > this.itemTotal - 1) {\n                        startIndex = 0\n                    }\n                }\n                child[\"__index\"] = startIndex\n                this.notifyRefreshItem(child)\n                startIndex++\n            }\n            this.scrollView.startAutoScroll()\n        } else {\n            if (this.vertical) {\n                if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                    this.pushToFooter()\n                } else {\n                    this.pushToHeader()\n                }\n            } else {\n                if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                    this.pushToFooter()\n                } else {\n                    this.pushToHeader()\n                }\n            }\n        }\n    }\n    private async createItems(count: number) {\n        this.gener?.return(\"\")\n        // 有多余的item 需要删除 不处理\n        if (this.node.children.length > count) {\n            this.removeItems(count)\n            return false\n        }\n        // 已经固定item总数 不处理\n        if (this._maxPrefabTotal > 0 && this._maxPrefabTotal == this.node.children.length) {\n            return false\n        }\n\n        // 开始分帧创建item\n        let total = count - this.node.children.length //计算当前应该创建的总数\n        this.gener = this.getGeneratorLength(total, () => {\n            let child: any = instantiate(this.prefab)\n            child[\"__index\"] = this.node.children.length\n            const transform = child._uiProps.uiTransformComp\n            transform.setContentSize(this.getItemSize(transform))\n            this.notifyRefreshItem(child)\n            child[\"__size\"] = transform.contentSize.clone()\n            child[\"__scale\"] = child.getScale().clone()\n            this.setItemPosition(child._uiProps.uiTransformComp, this.footer)\n            child.on(Node.EventType.SIZE_CHANGED, this.onChildSize, this)\n            child.on(Node.EventType.TRANSFORM_CHANGED, this.onChildScale, this)\n            this.node.addChild(child)\n            let selfHorW, viewHorW\n            if (this.vertical) {\n                selfHorW = this.contentSize.height\n                viewHorW = this.view.height\n            } else {\n                selfHorW = this.contentSize.width\n                viewHorW = this.view.width\n            }\n            /**\n             * 根据排列方向 来判断对比宽度还是高度\n             * 这里使用参数this.multiple来判断是否需要继续创建 默认为2倍 比如view可视尺寸为800 2倍就是1600\n             * 根据之前所创建的所有item的尺寸计算是否满足这个尺寸 如果满足则不再继续创建 \n             * 由于是分帧加载 所以下一次创建会等这一次的返回结果 返回false 则终止分帧任务\n             */\n            if (selfHorW >= viewHorW * this.multiple) {\n                this._maxPrefabTotal = this.node.children.length\n                console.error(\"确定数\", this._maxPrefabTotal)\n                return false\n            }\n            return true\n        })\n        await this.exeGenerator(this.gener, 10) //执行分帧任务 1帧创建10个\n        return true\n    }\n    /** 删除多余的item */\n    private removeItems(count: number) {\n        // 有多余的item 需要删除\n        let length = this.node.children.length - count\n        // 删除掉多余的item\n        for (let i = 0; i < length; i++) {\n            var child = this.node.children[this.node.children.length - 1]\n            child.off(Node.EventType.SIZE_CHANGED, this.onChildSize, this);\n            child.off(Node.EventType.TRANSFORM_CHANGED, this.onChildScale, this);\n            child.destroy()\n            this.node.removeChild(child)\n        }\n    }\n    onLoad() {\n        Object.defineProperty(this.transform, \"contentSize\", {\n            configurable: true,\n            get: () => this.contentSize,\n        })\n    }\n    onEnable() {\n        this.addEventListener()\n    }\n    onDisable() {\n        this.removeEventListener()\n    }\n    private addEventListener() {\n        this.node.on(SystemEventType.TRANSFORM_CHANGED, this.onPositionChanged, this)\n    }\n\n    private removeEventListener() {\n        this.node.off(SystemEventType.TRANSFORM_CHANGED, this.onPositionChanged, this)\n    }\n    private onChildScale(type: any) {\n        if (!this.affectedByScale) return\n        if (type == Node.TransformBit.SCALE) {\n            for (let i = 0; i < this.node.children.length; i++) {\n                const child: any = this.node.children[i];\n                const __scale = child[\"__scale\"]\n                if (this.groupItemTotal == 1) {\n                    if (this.vertical) {\n                        if (child.scale.x != __scale.x) {\n                            console.warn(\"不允许修改Item缩放X\")\n                            child.setScale(new Vec3(__scale.x, child.scale.y))\n                            return\n                        }\n                    } else {\n                        if (child.scale.y != __scale.y) {\n                            console.warn(\"不允许修改Item缩放Y\")\n                            child.setScale(new Vec3(child.scale.y, __scale.y))\n                            return\n                        }\n                    }\n                } else if (this.groupItemTotal > 1) {\n                    if (!child.scale.equals(__scale)) {\n                        console.warn(\"Grid模式不允许修改Item缩放\")\n                        child.setScale(__scale)\n                        return\n                    }\n                }\n            }\n            if (this.groupItemTotal > 1) return\n            this.resetChilds()\n        }\n    }\n    private onChildSize() {\n        for (let i = 0; i < this.node.children.length; i++) {\n            const child: any = this.node.children[i];\n            const __size = child[\"__size\"]\n            const transform = child._uiProps.uiTransformComp!\n            if (this.groupItemTotal == 1) {\n                if (this.vertical) {\n                    if (transform?.width != __size.width) {\n                        console.warn(\"不允许修改Item宽度\")\n                        transform.setContentSize(size(__size.width, transform.height))\n                        return\n                    }\n                } else {\n                    if (transform?.height != __size.height) {\n                        console.warn(\"不允许修改Item高度\")\n                        transform.setContentSize(size(transform.width, __size.height))\n                        return\n                    }\n                }\n            } else if (this.groupItemTotal > 1) {\n                if (!transform.contentSize.equals(__size)) {\n                    console.warn(\"Grid模式不允许修改Item尺寸\")\n                    transform.setContentSize(__size)\n                    return\n                }\n            }\n        }\n        if (this.groupItemTotal > 1) return\n        this.resetChilds()\n    }\n    private resetChilds(start: boolean = false) {\n        var prevItem: any = this.header\n        if (this.vertical && this.fixedItemHeight <= this.view.height || !this.vertical && this.fixedItemWidth <= this.view.width) {\n            let x = this.getStartX(this.header)\n            let y = this.getStartY(this.header)\n            this.header?.node.setPosition(new Vec3(x, y))\n        }\n        if (start) {\n            let x = this.getStartX(this.header)\n            this.header?.node.setPosition(new Vec3(x, this.header.node.position.y))\n        }\n        for (let i = 1; i < this.node.children.length; i++) {\n            const child = this.node.children[i];\n            const transform = child._uiProps.uiTransformComp!\n            let relative = !prevItem ? this.header : prevItem\n            this.setItemPosition(transform, relative)\n            prevItem = transform\n        }\n        this.scrollView.startAutoScroll()\n    }\n\n\n    protected getUsedScaleValue(value: number) {\n        return this.affectedByScale ? Math.abs(value) : 1;\n    }\n    protected getScaleWidth(trans: UITransform | null): number {\n        if (!trans) return 0\n        return trans.width * this.getUsedScaleValue(trans.node.scale.x)\n    }\n    protected getScaleHeight(trans: UITransform | null): number {\n        if (!trans) return 0\n        return trans.height * this.getUsedScaleValue(trans.node.scale.y)\n    }\n    public onPositionChanged() {\n        if (this.vertical) {\n            if (this.scrollView.prevLocation.y < this.scrollView.location.y) {\n                this.scrollDirection = ScrollDirection.FOOTER\n            } else if (this.scrollView.prevLocation.y > this.scrollView.location.y) {\n                this.scrollDirection = ScrollDirection.HEADER\n            } else {\n                this.scrollDirection = ScrollDirection.NONE\n            }\n        } else {\n            if (this.scrollView.prevLocation.x > this.scrollView.location.x) {\n                this.scrollDirection = ScrollDirection.FOOTER\n            } else if (this.scrollView.prevLocation.x < this.scrollView.location.x) {\n                this.scrollDirection = ScrollDirection.HEADER\n            } else {\n                this.scrollDirection = ScrollDirection.NONE\n            }\n        }\n\n        if (this.vertical) {\n            for (let i = 0; i < this.node.children.length; i++) {\n                let isOfBoundary = Math.abs(this.prevPos.y - this.node.position.y) > EPSILON\n                if (!isOfBoundary) continue\n                if (this.prevPos.y < this.node.position.y) {\n                    this.pushToFooter()\n                } else if (this.prevPos.y > this.node.position.y) {\n                    this.pushToHeader()\n                }\n            }\n        } else {\n            for (let i = 0; i < this.node.children.length; i++) {\n                let isOfBoundary = Math.abs(this.prevPos.x - this.node.position.x) > EPSILON\n                if (!isOfBoundary) continue\n                if (this.prevPos.x > this.node.position.x) {\n                    this.pushToFooter()\n                } else if (this.prevPos.x < this.node.position.x) {\n                    this.pushToHeader()\n                }\n            }\n        }\n        this.prevPos = this.node.position.clone()\n    }\n\n    private pushToFooter(force: boolean = false) {\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                if (force || this.headerBoundary - this.paddingTop > this.viewHeaderBoundary + this.header?.height!) {\n                    this.pushToFooterHandler()\n                }\n            } else {\n                if (force || this.footerBoundary - this.paddingTop > this.viewHeaderBoundary + this.header?.height!) {\n                    this.pushToHeaderHandler()\n                }\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                if (force || this.headerBoundary + this.paddingLeft < this.viewHeaderBoundary - this.header?.width!) {\n                    this.pushToFooterHandler()\n                }\n            } else {\n                if (force || this.footerBoundary + this.paddingLeft < this.viewHeaderBoundary - this.header?.width!) {\n                    this.pushToHeaderHandler()\n                }\n            }\n        }\n\n    }\n    private pushToHeader(force: boolean = false) {\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                if (force || this.footerBoundary + this.paddingBottom < this.viewFooterBoundary - this.footer?.height!) {\n                    this.pushToHeaderHandler()\n                }\n            } else {\n                if (force || this.headerBoundary + this.paddingBottom < this.viewFooterBoundary - this.footer?.height!) {\n                    this.pushToFooterHandler()\n                }\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                if (force || this.footerBoundary - this.paddingRight > this.viewFooterBoundary + this.footer?.width!) {\n                    this.pushToHeaderHandler()\n                }\n            } else {\n                if (force || this.headerBoundary - this.paddingRight > this.viewFooterBoundary + this.footer?.width!) {\n                    this.pushToFooterHandler()\n                }\n            }\n        }\n\n    }\n    private pushToFooterHandler() {\n        var node: any = this.header?.node\n        if (this.footerLoop) {\n            if (this.footerIndex >= this.itemTotal - 1) {\n                node[\"__index\"] = 0\n            } else {\n                node[\"__index\"] = this.footerIndex + 1\n            }\n        } else {\n            if (!this.footer || this.footerIndex >= this.itemTotal - 1) return\n            node[\"__index\"] = this.footerIndex + 1\n        }\n        this.notifyRefreshItem(node)\n        this.setItemPosition(this.header!, this.footer!)\n        this.header?.node.setSiblingIndex(this.node.children.length)\n    }\n\n    private pushToHeaderHandler() {\n        var node: any = this.footer?.node\n        if (this.headerLoop) {\n            if (this.headerIndex == 0) {\n                node[\"__index\"] = this.itemTotal - 1\n            } else {\n                node[\"__index\"] = this.headerIndex - 1\n            }\n        } else {\n            if (!this.header || this.headerIndex == 0) return\n            node[\"__index\"] = this.headerIndex - 1\n        }\n        this.notifyRefreshItem(node)\n\n\n        this.setItemPosition(this.footer!, this.header!, true)\n        this.footer?.node.setSiblingIndex(0)\n\n        // 对其头部\n        if (!this.headerLoop && this.headerIndex == 0) {\n            // 判断是否是起始位置\n            let accommodate = this.isAccommodateByLeft(this.header!)\n            if (accommodate) {\n                this.resetChilds(true)\n            }\n        }\n    }\n    /** 通知给定的node刷新数据 */\n    notifyRefreshItem(target: Node) {\n        EventHandler.emitEvents(this.refreshItemEvents, target, (target as any)['__index'])\n    }\n    /** 分帧加载 */\n    private * getGeneratorLength(length: number, callback: Function, ...params: any): Generator {\n        for (let i = 0; i < length; i++) {\n            let result = callback(i, ...params)\n            if (result) {\n                yield\n            } else {\n                return\n            }\n        }\n    }\n    /** 分帧执行 */\n    private exeGenerator(generator: Generator, duration: number) {\n        return new Promise((resolve, reject) => {\n            let gen = generator\n            let execute = () => {\n                let startTime = new Date().getTime()\n                for (let iter = gen.next(); ; iter = gen.next()) {\n                    if (iter == null || iter.done) {\n                        resolve(null)\n                        return\n                    }\n                    if (new Date().getTime() - startTime > duration) {\n                        setTimeout(() => execute(), director.getDeltaTime() * 1000)\n                        return\n                    }\n                }\n            }\n            execute()\n        })\n    }\n}\n"]}