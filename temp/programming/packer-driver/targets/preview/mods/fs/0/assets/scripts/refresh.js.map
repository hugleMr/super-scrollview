{"version":3,"sources":["file:///Users/stevejobs/Documents/GitHub/super-scrollview/assets/scripts/refresh.ts"],"names":["_decorator","Node","Tween","Vec3","Label","BaseMain","Item","ccclass","property","Refresh","onLoad","header","setScale","footer","layout","total","datas","length","onRefreshEvent","item","index","getComponent","show","onClickItem","bind","onHeader","scrollView","event","progress","headerTween","to","scale","easing","start","stop","label","getComponentInChildren","stage","string","action","scheduleOnce","onFooter","footerTween","i","push","message"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, Tween, Vec3, Label } from 'cc';\nimport { SuperLayout } from '../core/super-layout';\nimport { BaseMain } from './baseMain';\nimport { Item } from './item';\nconst { ccclass, property } = _decorator;\n\n@ccclass('Refresh')\nexport class Refresh extends BaseMain {\n    @property(Node) header!: Node\n    @property(Node) footer!: Node\n    private datas: any[] = []\n    onLoad() {\n        this.header.setScale(new Vec3(1, 0, 1))\n        this.footer.setScale(new Vec3(1, 0, 1))\n        // for (let i = 0; i < 10; i++) {\n        //     this.datas.push({\n        //         message: i\n        //     })\n        // }\n        this.layout.total(this.datas.length)\n    }\n\n    onRefreshEvent(item: Node, index: number) {\n        item.getComponent(Item)?.show(this.datas[index], index, this.onClickItem.bind(this))\n    }\n    onClickItem(index: number) {\n    }\n    private headerTween!: Tween<Node>\n    private footerTween!: Tween<Node>\n    onHeader(scrollView: any, event: any) {\n        if (event.progress > 2) {\n            if (!(this.header as any)['playing']) {\n                this.headerTween = new Tween(this.header!);\n                this.headerTween.to(0.518, {\n                    scale: new Vec3(1, 1, 1),\n                }, {\n                    easing: \"elasticOut\"\n                });\n                this.headerTween.start();\n                (this.header as any)['playing'] = true\n            }\n        } else {\n            this.headerTween?.stop();\n            (this.header as any)['playing'] = false\n            this.header.setScale(new Vec3(1, event.progress, 1))\n        }\n\n        let label = this.header.getComponentInChildren(Label)!\n        if (event.stage == \"touch\") {\n            label.string = \"↓ 下拉刷新\"\n        }\n        if (event.stage == \"wait\") {\n            label.string = \"↑ 松开刷新\"\n        }\n        if (event.stage == \"lock\") {\n            label.string = this.datas.length == 0 ? \"没有数据\" : \"刷新中...\"\n        }\n        if (event.stage == 'release') {\n            label.string = \"\"\n        }\n        if (event.action) {\n            this.scheduleOnce(() => this.layout.total(this.datas.length), 2)\n        }\n    }\n    onFooter(scrollView: any, event: any) {\n        if (event.progress > 2) {\n            if (!(this.footer as any)['playing']) {\n                this.footerTween = new Tween(this.footer!);\n                this.footerTween.to(0.518, {\n                    scale: new Vec3(1, 1, 1),\n                }, {\n                    easing: \"elasticOut\"\n                });\n                this.footerTween.start();\n                (this.footer as any)['playing'] = true\n            }\n        } else {\n            this.footerTween?.stop();\n            (this.footer as any)['playing'] = false\n            this.footer.setScale(new Vec3(1, event.progress, 1))\n        }\n\n        let label = this.footer.getComponentInChildren(Label)!\n        if (event.stage == \"touch\") {\n            label.string = \"↑ 上拉加载\"\n        }\n        if (event.stage == \"wait\") {\n            label.string = \"↓ 松开加载\"\n        }\n        if (event.stage == \"lock\") {\n            label.string = \"加载中...\"\n        }\n        if (event.stage == 'release') {\n            label.string = \"\"\n        }\n        if (event.action) {\n            for (let i = 0; i < 10; i++) {\n                this.datas.push({\n                    message: `${this.datas.length}`\n                })\n            }\n            this.scheduleOnce(() => this.layout.total(this.datas.length), 2)\n        }\n    }\n}"]}