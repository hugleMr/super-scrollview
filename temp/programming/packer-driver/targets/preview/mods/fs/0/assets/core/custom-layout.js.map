{"version":3,"sources":["file:///Users/stevejobs/Documents/GitHub/super-scrollview/assets/core/custom-layout.ts"],"names":["_decorator","Component","Node","ccenum","UITransform","SystemEventType","director","Vec3","EventHandler","instantiate","Prefab","Size","size","CustomScrollview","ccclass","property","executeInEditMode","requireComponent","EPSILON","Type","AxisDirection","VerticalAxisDirection","HorizontalAxisDirection","ScrollDirection","CustomLayout","type","displayName","visible","autoCenter","NONE","total","count","createItems","created","offset","itemTotal","_itemTotal","refreshItems","scrollView","release","soonFinish","findedPos","i","node","children","length","child","worldPos","transform","convertToWorldSpaceAR","position","localPos","view","convertToNodeSpaceAR","map","width","height","newLocalPos","subtract","centerPosition","Math","abs","x","y","vertical","multiply","scrollToAny","centerTime","scrollToIndex","index","timeInSecond","boundary","reverse","isNaN","find","item","isDownOffset","footerIndex","headerIndex","start","groupItemTotal","verticalAxisDirection","TOP_TO_BOTTOM","pushToFooter","pushToHeader","console","error","horizontalAxisDirection","LEFT_TO_RIGHT","maxPrefabTotal","headerLoop","footerLoop","notifyRefreshItem","itemPos","getPosition","getItemYMax","_uiProps","uiTransformComp","paddingTop","getItemYMin","paddingBottom","getItemXMin","paddingLeft","getItemXMax","paddingRight","multiple","add","stopAutoScroll","scrollToHeader","viewHeaderBoundary","scrollToFooter","viewFooterBoundary","getItemSize","spacing","spacingX","accommodWidth","spacingY","accommodHeight","getScaleHeight","anchorY","getScaleWidth","anchorX","getStartX","viewStartPoint","getEndX","getStartY","getEndY","isAccommodateByTop","relative","max","isAccommodateByBottom","min","isAccommodateByLeft","isAccommodateByRight","getRelativeByLeft","getRelativeByRight","getRelativeByTop","getRelativeByBottom","setItemPosition","pos","header","isAccommodate","setPosition","startIndex","startAutoScroll","gener","removeItems","_maxPrefabTotal","getGeneratorLength","prefab","setContentSize","contentSize","clone","getScale","footer","on","EventType","SIZE_CHANGED","onChildSize","TRANSFORM_CHANGED","onChildScale","addChild","selfHorW","viewHorW","exeGenerator","off","destroy","removeChild","onLoad","Object","defineProperty","configurable","get","onEnable","addEventListener","onDisable","removeEventListener","onPositionChanged","affectedByScale","TransformBit","SCALE","__scale","scale","warn","setScale","equals","resetChilds","__size","prevItem","fixedItemHeight","fixedItemWidth","getUsedScaleValue","value","trans","prevLocation","location","scrollDirection","FOOTER","HEADER","isOfBoundary","prevPos","force","headerBoundary","pushToFooterHandler","footerBoundary","pushToHeaderHandler","setSiblingIndex","accommodate","target","emitEvents","refreshItemEvents","callback","params","result","generator","duration","Promise","resolve","reject","gen","execute","startTime","Date","getTime","iter","next","done","setTimeout","getDeltaTime","layoutType","VERTICAL","HORIZONTAL","key","centerNode","centerHeaderBoundary","centerFooterBoundary","_centerPosition","parent","HEADER_TO_FOOTER"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,e,OAAAA,e;AAAiBC,MAAAA,Q,OAAAA,Q;AAAoBC,MAAAA,I,OAAAA,I;AAAaC,MAAAA,Y,OAAAA,Y;AAAcC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,I,OAAAA,I;AAAwBC,MAAAA,I,OAAAA,I;;AAE/JC,MAAAA,gB,qBAAAA,gB;;;;;;;AAEDC,MAAAA,O,GAA2Dd,U,CAA3Dc,O;AAASC,MAAAA,Q,GAAkDf,U,CAAlDe,Q;AAAUC,MAAAA,iB,GAAwChB,U,CAAxCgB,iB;AAAmBC,MAAAA,gB,GAAqBjB,U,CAArBiB,gB;AACxCC,MAAAA,O,GAAU,I;;iBACXC,I;AAAAA,QAAAA,I,CAAAA,I;AAAAA,QAAAA,I,CAAAA,I;SAAAA,I,KAAAA,I;;AAILhB,MAAAA,MAAM,CAACgB,IAAD,CAAN;;iBACKC,a;AAAAA,QAAAA,a,CAAAA,a;AAAAA,QAAAA,a,CAAAA,a;SAAAA,a,KAAAA,a;;AAILjB,MAAAA,MAAM,CAACiB,aAAD,CAAN;;iBACKC,qB;AAAAA,QAAAA,qB,CAAAA,qB;AAAAA,QAAAA,qB,CAAAA,qB;SAAAA,qB,KAAAA,qB;;AAILlB,MAAAA,MAAM,CAACkB,qBAAD,CAAN;;iBACKC,uB;AAAAA,QAAAA,uB,CAAAA,uB;AAAAA,QAAAA,uB,CAAAA,uB;SAAAA,uB,KAAAA,uB;;AAILnB,MAAAA,MAAM,CAACmB,uBAAD,CAAN;;iBACKC,e;AAAAA,QAAAA,e,CAAAA,e;AAAAA,QAAAA,e,CAAAA,e;AAAAA,QAAAA,e,CAAAA,e;SAAAA,e,KAAAA,e;;8BAOQC,Y,WAFZV,OAAO,CAAC,cAAD,C,UACPG,gBAAgB,CAACb,WAAD,C,UAEZW,QAAQ;AAAA;AAAA,+C,UACRA,QAAQ,CAACX,WAAD,C,UAERW,QAAQ,CAAC;AAAEU,QAAAA,IAAI,EAAEN;AAAR,OAAD,C,UACRJ,QAAQ,CAAC;AACNU,QAAAA,IAAI,EAAEJ,qBADA;AAENK,QAAAA,WAAW,EAAE;AAFP,OAAD,C,UAIRX,QAAQ,CAAC;AACNU,QAAAA,IAAI,EAAEH,uBADA;AAENI,QAAAA,WAAW,EAAE;AAFP,OAAD,C,UAKRX,QAAQ,CAAC;AACNU,QAAAA,IAAI,EAAEL;AADA,OAAD,C,UAYRL,QAAQ,CAAC;AACNY,QAAAA,OAAO,EAAE,mBAAY;AAAE,iBAAO,KAAKC,UAAZ;AAAwB;AADzC,OAAD,C,WAGRb,QAAQ,CAAC;AACNU,QAAAA,IAAI,EAAEvB,IADA;AAENyB,QAAAA,OAAO,EAAE,mBAAY;AAAE,iBAAO,KAAKC,UAAZ;AAAwB;AAFzC,OAAD,C,WAKRb,QAAQ,CAACL,MAAD,C,WACRK,QAAQ,CAACP,YAAD,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;4EAKkCe,eAAe,CAACM,I;;oEA+OnC,IAAItB,IAAJ,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,C;;4EAIU,C;;uEAEL,C;;;;;;;eAIvBuB,K;+EAAN,iBAAYC,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BACwB,KAAKC,WAAL,CAAiBD,KAAjB,CADxB;;AAAA;AACQE,oBAAAA,OADR;AAEQC,oBAAAA,MAFR,GAEiBH,KAAK,GAAG,KAAKI,SAF9B;AAGI,yBAAKC,UAAL,GAAkBL,KAAlB;;AACA,wBAAI,CAACE,OAAL,EAAc;AACV,2BAAKI,YAAL,CAAkBH,MAAlB;AACH;;AACD,yBAAKI,UAAL,CAAgBC,OAAhB;;AAPJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,W;;;;;;;;;eAoCAC,U,GAAA,sBAAa;AACT,cAAI,CAAC,KAAKZ,UAAV,EAAsB;AACtB,cAAIa,SAAS,GAAG,IAAIlC,IAAJ,CAAS,MAAT,EAAiB,MAAjB,CAAhB;;AACA,eAAK,IAAImC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKC,IAAL,CAAUC,QAAV,CAAmBC,MAAvC,EAA+CH,CAAC,EAAhD,EAAoD;AAAA;;AAChD,gBAAMI,KAAK,GAAG,KAAKH,IAAL,CAAUC,QAAV,CAAmBF,CAAnB,CAAd;AACA,gBAAIK,QAAQ,sBAAG,KAAKC,SAAR,oDAAG,gBAAgBC,qBAAhB,CAAsCH,KAAK,CAACI,QAA5C,CAAf;AACA,gBAAIC,QAAQ,GAAG,KAAKC,IAAL,CAAUC,oBAAV,CAA+BN,QAA/B,CAAf;AACA,gBAAIO,GAAG,GAAG;AAAEC,cAAAA,KAAK,EAAE,KAAT;AAAgBC,cAAAA,MAAM,EAAE;AAAxB,aAAV;AACA,gBAAIC,WAAW,GAAGN,QAAQ,CAACO,QAAT,CAAkB,KAAKC,cAAvB,CAAlB;AACAL,YAAAA,GAAG,CAACC,KAAJ,GAAYK,IAAI,CAACC,GAAL,CAASJ,WAAW,CAACK,CAArB,IAA0BF,IAAI,CAACC,GAAL,CAASpB,SAAS,CAACqB,CAAnB,CAAtC;AACAR,YAAAA,GAAG,CAACE,MAAJ,GAAaI,IAAI,CAACC,GAAL,CAASJ,WAAW,CAACM,CAArB,IAA0BH,IAAI,CAACC,GAAL,CAASpB,SAAS,CAACsB,CAAnB,CAAvC;;AACA,gBAAI,KAAKC,QAAL,IAAiBV,GAAG,CAACE,MAAzB,EAAiC;AAC7Bf,cAAAA,SAAS,GAAGgB,WAAZ;AACH,aAFD,MAEO,IAAI,CAAC,KAAKO,QAAN,IAAkBV,GAAG,CAACC,KAA1B,EAAiC;AACpCd,cAAAA,SAAS,GAAGgB,WAAZ;AACH;AACJ;;AACDhB,UAAAA,SAAS,CAACwB,QAAV,CAAmB,IAAI1D,IAAJ,CAAS,CAAC,CAAV,EAAa,CAAC,CAAd,EAAiB,CAAjB,CAAnB;AACA,eAAK+B,UAAL,CAAgB4B,WAAhB,CAA4BzB,SAA5B,EAAuC,KAAK0B,UAA5C;AACH,S;;eAEDC,a,GAAA,uBAAcC,KAAd,EAA6BC,YAA7B,EAAoDC,QAApD,EAAqEC,OAArE,EAA+F;AAAA;;AAAA,cAA1BA,OAA0B;AAA1BA,YAAAA,OAA0B,GAAP,KAAO;AAAA;;AAC3F,cAAIC,KAAK,CAACJ,KAAD,CAAL,IAAgBA,KAAK,GAAG,CAAxB,IAA6BA,KAAK,GAAG,KAAKlC,SAAL,GAAiB,CAA1D,EAA6D;AAC7D,cAAID,MAAM,GAAG,CAAb;AACA,cAAIY,KAAK,GAAG,KAAKH,IAAL,CAAUC,QAAV,CAAmB8B,IAAnB,CAAwB,UAACC,IAAD;AAAA,mBAAeA,IAAI,CAAC,SAAD,CAAJ,IAAmBN,KAAlC;AAAA,WAAxB,CAAZ;;AACA,cAAI,CAACvB,KAAL,EAAY;AACR,gBAAI8B,YAAY,GAAG,KAAnB;;AACA,gBAAIP,KAAK,GAAG,KAAKQ,WAAb,IAA4BR,KAAK,GAAG,KAAKS,WAA7C,EAA0D;AACtD,kBAAIlB,IAAI,CAACC,GAAL,CAASQ,KAAK,GAAG,KAAKS,WAAtB,IAAqClB,IAAI,CAACC,GAAL,CAASQ,KAAK,GAAG,KAAKQ,WAAtB,CAAzC,EAA6E;AACzED,gBAAAA,YAAY,GAAG,KAAf;AACH,eAFD,MAEO;AACHA,gBAAAA,YAAY,GAAG,IAAf;AACH;AACJ,aAND,MAMO,IAAIP,KAAK,GAAG,KAAKQ,WAAjB,EAA8B;AACjCD,cAAAA,YAAY,GAAG,IAAf;AACH,aAFM,MAEA,IAAIP,KAAK,GAAG,KAAKS,WAAjB,EAA8B;AACjCF,cAAAA,YAAY,GAAG,KAAf;AACH;;AACD,gBAAIG,KAAK,GAAG,CAAZ;;AACA,gBAAIH,YAAJ,EAAkB;AACd1C,cAAAA,MAAM,GAAGmC,KAAK,GAAG,KAAKW,cAAb,GAA8B,KAAKH,WAAL,GAAmB,KAAKG,cAA/D;AACA9C,cAAAA,MAAM,GAAG0B,IAAI,CAACC,GAAL,CAAS3B,MAAT,CAAT;AACH,aAHD,MAGO;AACHA,cAAAA,MAAM,GAAG,KAAK4C,WAAL,GAAmB,KAAKE,cAAjC;AACA9C,cAAAA,MAAM,GAAG0B,IAAI,CAACC,GAAL,CAAS3B,MAAT,CAAT;AACH;;AACD,iBAAK,IAAIQ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,MAApB,EAA4BQ,CAAC,EAA7B,EAAiC;AAC7B,kBAAI,KAAKsB,QAAT,EAAmB;AACf,oBAAI,KAAKiB,qBAAL,IAA8B5D,qBAAqB,CAAC6D,aAAxD,EAAuE;AACnE,sBAAIN,YAAJ,EAAkB;AACd,yBAAKO,YAAL,CAAkB,IAAlB;AACH,mBAFD,MAEO;AACH,yBAAKC,YAAL,CAAkB,IAAlB;AACAC,oBAAAA,OAAO,CAACC,KAAR,CAAc,QAAd;AACH;AACJ,iBAPD,MAOO;AACH,sBAAIV,YAAJ,EAAkB;AACd,yBAAKQ,YAAL,CAAkB,IAAlB;AACH,mBAFD,MAEO;AACH,yBAAKD,YAAL,CAAkB,IAAlB;AACH;AACJ;AACJ,eAfD,MAeO;AACH,oBAAI,KAAKI,uBAAL,IAAgCjE,uBAAuB,CAACkE,aAA5D,EAA2E;AACvE,sBAAIZ,YAAJ,EAAkB;AACd,yBAAKO,YAAL,CAAkB,IAAlB;AACH,mBAFD,MAEO;AACH,yBAAKC,YAAL,CAAkB,IAAlB;AACH;AACJ,iBAND,MAMO;AACH,sBAAIR,YAAJ,EAAkB;AACd,yBAAKQ,YAAL,CAAkB,IAAlB;AACH,mBAFD,MAEO;AACH,yBAAKD,YAAL,CAAkB,IAAlB;AACH;AACJ;AACJ;AACJ;;AACD,gBAAIP,YAAJ,EAAkB;AACdG,cAAAA,KAAK,GAAGnB,IAAI,CAACC,GAAL,CAASQ,KAAK,GAAG,KAAKoB,cAAtB,IAAwC,CAAhD,CADc,CAEd;AACH,aAHD,MAGO;AACH,kBAAIpB,KAAK,GAAG,KAAKW,cAAjB,EAAiC;AAC7BD,gBAAAA,KAAK,GAAG,CAAR;AACH,eAFD,MAEO;AACHA,gBAAAA,KAAK,GAAGV,KAAR;AACH,eALE,CAMH;;AACH;;AACD,iBAAK,IAAI3B,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAG,KAAKC,IAAL,CAAUC,QAAV,CAAmBC,MAAvC,EAA+CH,EAAC,EAAhD,EAAoD;AAChD,kBAAMI,MAAU,GAAG,KAAKH,IAAL,CAAUC,QAAV,CAAmBF,EAAnB,CAAnB;;AACA,kBAAI,KAAKgD,UAAL,IAAmB,KAAKC,UAA5B,EAAwC;AACpC,oBAAIZ,KAAK,GAAG,KAAK5C,SAAL,GAAiB,CAA7B,EAAgC;AAC5B4C,kBAAAA,KAAK,GAAG,CAAR;AACH;AACJ;;AACDjC,cAAAA,MAAK,CAAC,SAAD,CAAL,GAAmBiC,KAAnB,CAPgD,CAQhD;;AACA,mBAAKa,iBAAL,CAAuB9C,MAAvB;AACAiC,cAAAA,KAAK;AACR;;AACDjC,YAAAA,KAAK,GAAG,KAAKH,IAAL,CAAUC,QAAV,CAAmB8B,IAAnB,CAAwB,UAACC,IAAD;AAAA,qBAAeA,IAAI,CAAC,SAAD,CAAJ,IAAmBN,KAAlC;AAAA,aAAxB,CAAR;AACH;;AACD,cAAI,CAACvB,KAAL,EAAY;AACZ,cAAI+C,OAAO,GAAG/C,KAAK,CAACgD,WAAN,EAAd;;AACA,cAAI,CAAC,KAAKlE,UAAV,EAAsB;AAClB,gBAAI,KAAKoC,QAAT,EAAmB;AACf,kBAAI,KAAKiB,qBAAL,IAA8B5D,qBAAqB,CAAC6D,aAAxD,EAAuE;AACnE,oBAAI,CAACV,OAAL,EAAc;AACVqB,kBAAAA,OAAO,CAAC9B,CAAR,GAAY,KAAKgC,WAAL,CAAiBjD,KAAK,CAACkD,QAAN,CAAeC,eAAhC,IAAoD,KAAKC,UAArE;AACH,iBAFD,MAEO;AACHL,kBAAAA,OAAO,CAAC9B,CAAR,GAAY,KAAKoC,WAAL,CAAiBrD,KAAK,CAACkD,QAAN,CAAeC,eAAhC,IAAoD,KAAKG,aAArE;AACH;AACJ,eAND,MAMO;AACH,oBAAI,CAAC5B,OAAL,EAAc;AACVqB,kBAAAA,OAAO,CAAC9B,CAAR,GAAY,KAAKoC,WAAL,CAAiBrD,KAAK,CAACkD,QAAN,CAAeC,eAAhC,IAAoD,KAAKG,aAArE;AACH,iBAFD,MAEO;AACHP,kBAAAA,OAAO,CAAC9B,CAAR,GAAY,KAAKgC,WAAL,CAAiBjD,KAAK,CAACkD,QAAN,CAAeC,eAAhC,IAAoD,KAAKC,UAArE;AACH;AACJ;AACJ,aAdD,MAcO;AACH,kBAAI,KAAKX,uBAAL,IAAgCjE,uBAAuB,CAACkE,aAA5D,EAA2E;AACvE,oBAAI,CAAChB,OAAL,EAAc;AACVqB,kBAAAA,OAAO,CAAC/B,CAAR,GAAY,KAAKuC,WAAL,CAAiBvD,KAAK,CAACkD,QAAN,CAAeC,eAAhC,IAAoD,KAAKK,WAArE;AACH,iBAFD,MAEO;AACHT,kBAAAA,OAAO,CAAC/B,CAAR,GAAY,KAAKyC,WAAL,CAAiBzD,KAAK,CAACkD,QAAN,CAAeC,eAAhC,IAAoD,KAAKO,YAArE;AACH;AACJ,eAND,MAMO;AACH,oBAAI,CAAChC,OAAL,EAAc;AACVqB,kBAAAA,OAAO,CAAC/B,CAAR,GAAY,KAAKyC,WAAL,CAAiBzD,KAAK,CAACkD,QAAN,CAAeC,eAAhC,IAAoD,KAAKO,YAArE;AACH,iBAFD,MAEO;AACHX,kBAAAA,OAAO,CAAC/B,CAAR,GAAY,KAAKuC,WAAL,CAAiBvD,KAAK,CAACkD,QAAN,CAAeC,eAAhC,IAAoD,KAAKK,WAArE;AACH;AACJ;AACJ;AACJ;;AAED,cAAIvD,QAAQ,uBAAG,KAAKC,SAAR,qDAAG,iBAAgBC,qBAAhB,CAAsC4C,OAAtC,CAAf;AACA,cAAI1C,QAAQ,GAAG,KAAKC,IAAL,CAAUC,oBAAV,CAA+BN,QAA/B,CAAf;AACA,cAAI0D,QAAJ;;AACA,cAAI,CAAC,KAAK7E,UAAN,IAAoB2C,QAAxB,EAAkC;AAC9BkC,YAAAA,QAAQ,GAAGlC,QAAX;AACH,WAFD,MAEO;AACHkC,YAAAA,QAAQ,GAAG,KAAK9C,cAAhB;AACH;;AACDR,UAAAA,QAAQ,CAACc,QAAT,CAAkB,IAAI1D,IAAJ,CAAS,CAAC,CAAV,EAAa,CAAC,CAAd,EAAiB,CAAjB,CAAlB,EAAuCmG,GAAvC,CAA2CD,QAA3C;AACA,eAAKnE,UAAL,CAAgBqE,cAAhB;AACA,eAAKrE,UAAL,CAAgB4B,WAAhB,CAA4Bf,QAA5B,EAAsCmB,YAAtC;AACH,S;;eACDsC,c,GAAA,wBAAetC,YAAf,EAAsC;AAClC,eAAKF,aAAL,CAAmB,CAAnB,EAAsBE,YAAtB,EAAoC,IAAI/D,IAAJ,CAAS,KAAKsG,kBAAd,EAAkC,KAAKA,kBAAvC,CAApC;AACH,S;;eACDC,c,GAAA,wBAAexC,YAAf,EAAsC;AAClC,eAAKF,aAAL,CAAmB,KAAKjC,SAAL,GAAiB,CAApC,EAAuCmC,YAAvC,EAAqD,IAAI/D,IAAJ,CAAS,KAAKwG,kBAAd,EAAkC,KAAKA,kBAAvC,CAArD,EAAiH,IAAjH;AACH;AACD;;;eAyBQC,W,GAAR,qBAAoBrC,IAApB,EAA6C;AACzC,cAAI/D,IAAI,GAAG,IAAID,IAAJ,EAAX;;AACA,cAAI,KAAKqD,QAAT,EAAmB;AACf,gBAAIiD,OAAO,GAAG,KAAKC,QAAL,IAAiB,KAAKlC,cAAL,GAAsB,CAAvC,CAAd;AACApE,YAAAA,IAAI,CAAC2C,KAAL,GAAa,CAAC,KAAK4D,aAAL,GAAqBF,OAAtB,IAAiC,KAAKjC,cAAnD;AACApE,YAAAA,IAAI,CAAC4C,MAAL,GAAcmB,IAAI,CAACnB,MAAnB;AACH,WAJD,MAIO;AACH,gBAAIyD,QAAO,GAAG,KAAKG,QAAL,IAAiB,KAAKpC,cAAL,GAAsB,CAAvC,CAAd;;AACApE,YAAAA,IAAI,CAAC4C,MAAL,GAAc,CAAC,KAAK6D,cAAL,GAAsBJ,QAAvB,IAAkC,KAAKjC,cAArD;AACApE,YAAAA,IAAI,CAAC2C,KAAL,GAAaoB,IAAI,CAACpB,KAAlB;AACH;;AACD,iBAAO3C,IAAP;AACH,S;;eACOmF,W,GAAR,qBAAoBpB,IAApB,EAAsD;AAClD,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAInB,MAAM,GAAG,KAAK8D,cAAL,CAAoB3C,IAApB,KAA6B,IAAIA,IAAI,CAAC4C,OAAtC,CAAb;AACA,iBAAO5C,IAAI,CAAChC,IAAL,CAAUO,QAAV,CAAmBa,CAAnB,GAAuBP,MAA9B;AACH,S;;eACO2C,W,GAAR,qBAAoBxB,IAApB,EAAsD;AAClD,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAInB,MAAM,GAAG,KAAK8D,cAAL,CAAoB3C,IAApB,IAA4BA,IAAI,CAAC4C,OAA9C;AACA,iBAAO5C,IAAI,CAAChC,IAAL,CAAUO,QAAV,CAAmBa,CAAnB,GAAuBP,MAA9B;AACH,S;;eACO+C,W,GAAR,qBAAoB5B,IAApB,EAAsD;AAClD,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAIpB,KAAK,GAAG,KAAKiE,aAAL,CAAmB7C,IAAnB,KAA4B,IAAIA,IAAI,CAAC8C,OAArC,CAAZ;AACA,iBAAO9C,IAAI,CAAChC,IAAL,CAAUO,QAAV,CAAmBY,CAAnB,GAAuBP,KAA9B;AACH,S;;eACO8C,W,GAAR,qBAAoB1B,IAApB,EAAsD;AAClD,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAIpB,KAAK,GAAG,KAAKiE,aAAL,CAAmB7C,IAAnB,IAA2BA,IAAI,CAAC8C,OAA5C;AACA,iBAAO9C,IAAI,CAAChC,IAAL,CAAUO,QAAV,CAAmBY,CAAnB,GAAuBP,KAA9B;AACH,S;;eAEOmE,S,GAAR,mBAAkB/C,IAAlB,EAAoD;AAChD,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAIb,CAAC,GAAG,CAAR;;AACA,cAAI,KAAKyB,uBAAL,IAAgCjE,uBAAuB,CAACkE,aAA5D,EAA2E;AACvE,gBAAIjC,KAAK,GAAG,KAAKiE,aAAL,CAAmB7C,IAAnB,IAA2BA,IAAI,CAAC8C,OAA5C;AACA3D,YAAAA,CAAC,GAAG,KAAK6D,cAAL,CAAoB7D,CAApB,GAAwBP,KAA5B;AACH,WAHD,MAGO;AACH,gBAAIA,MAAK,GAAG,KAAKiE,aAAL,CAAmB7C,IAAnB,KAA4B,IAAIA,IAAI,CAAC8C,OAArC,CAAZ;;AACA3D,YAAAA,CAAC,GAAG,KAAK6D,cAAL,CAAoB7D,CAApB,GAAwBP,MAA5B;AACH;;AACD,iBAAOO,CAAP;AACH,S;;eACO8D,O,GAAR,iBAAgBjD,IAAhB,EAAkD;AAC9C,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAIb,CAAC,GAAG,CAAR;;AACA,cAAI,KAAKyB,uBAAL,IAAgCjE,uBAAuB,CAACkE,aAA5D,EAA2E;AACvE,gBAAIjC,KAAK,GAAG,KAAKiE,aAAL,CAAmB7C,IAAnB,KAA4B,IAAIA,IAAI,CAAC8C,OAArC,CAAZ;AACA3D,YAAAA,CAAC,GAAG,CAAC,KAAK6D,cAAL,CAAoB7D,CAArB,GAAyBP,KAA7B;AACH,WAHD,MAGO;AACH,gBAAIA,OAAK,GAAG,KAAKiE,aAAL,CAAmB7C,IAAnB,IAA2BA,IAAI,CAAC8C,OAA5C;;AACA3D,YAAAA,CAAC,GAAG,CAAC,KAAK6D,cAAL,CAAoB7D,CAArB,GAAyBP,OAA7B;AACH;;AACD,iBAAOO,CAAP;AACH,S;;eACO+D,S,GAAR,mBAAkBlD,IAAlB,EAAoD;AAChD,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAIZ,CAAC,GAAG,CAAR;;AACA,cAAI,KAAKkB,qBAAL,IAA8B5D,qBAAqB,CAAC6D,aAAxD,EAAuE;AACnE,gBAAI1B,MAAM,GAAG,KAAK8D,cAAL,CAAoB3C,IAApB,KAA6B,IAAIA,IAAI,CAAC4C,OAAtC,CAAb;AACAxD,YAAAA,CAAC,GAAG,KAAK4D,cAAL,CAAoB5D,CAApB,GAAwBP,MAA5B;AACH,WAHD,MAGO;AACH,gBAAIA,OAAM,GAAG,KAAK8D,cAAL,CAAoB3C,IAApB,IAA4BA,IAAI,CAAC4C,OAA9C;;AACAxD,YAAAA,CAAC,GAAG,KAAK4D,cAAL,CAAoB5D,CAApB,GAAwBP,OAA5B;AACH;;AACD,iBAAOO,CAAP;AACH,S;;eACO+D,O,GAAR,iBAAgBnD,IAAhB,EAAkD;AAC9C,cAAI,CAACA,IAAL,EAAW,OAAO,CAAP;AACX,cAAIZ,CAAC,GAAG,CAAR;;AACA,cAAI,KAAKkB,qBAAL,IAA8B5D,qBAAqB,CAAC6D,aAAxD,EAAuE;AACnE,gBAAI1B,MAAM,GAAG,KAAK8D,cAAL,CAAoB3C,IAApB,IAA4BA,IAAI,CAAC4C,OAA9C;AACAxD,YAAAA,CAAC,GAAG,CAAC,KAAK4D,cAAL,CAAoB5D,CAArB,GAAyBP,MAA7B;AACH,WAHD,MAGO;AACH,gBAAIA,QAAM,GAAG,KAAK8D,cAAL,CAAoB3C,IAApB,KAA6B,IAAIA,IAAI,CAAC4C,OAAtC,CAAb;;AACAxD,YAAAA,CAAC,GAAG,CAAC,KAAK4D,cAAL,CAAoB5D,CAArB,GAAyBP,QAA7B;AACH;;AACD,iBAAOO,CAAP;AACH,S;;eACOgE,kB,GAAR,4BAA2BC,QAA3B,EAAkD;AAC9C,cAAIC,GAAG,GAAG,KAAKlC,WAAL,CAAiBiC,QAAjB,CAAV;AACA,iBAAOC,GAAG,GAAG,KAAK/B,UAAX,GAAwB,KAAKmB,cAAL,GAAsB,GAArD;AACH,S;;eACOa,qB,GAAR,+BAA8BF,QAA9B,EAAqD;AACjD,cAAIG,GAAG,GAAG,KAAKhC,WAAL,CAAiB6B,QAAjB,CAAV;AACA,iBAAOG,GAAG,GAAG,KAAK/B,aAAX,GAA2B,KAAKiB,cAAL,GAAsB,CAAC,GAAzD;AACH;AACD;;;eACQe,mB,GAAR,6BAA4BJ,QAA5B,EAAmD;AAC/C,cAAIG,GAAG,GAAG,KAAK9B,WAAL,CAAiB2B,QAAjB,CAAV;AACA,iBAAOG,GAAG,GAAG,KAAK7B,WAAX,GAAyB,KAAKa,aAAL,GAAqB,CAAC,GAAtD;AACH,S;;eACOkB,oB,GAAR,8BAA6BL,QAA7B,EAAoD;AAChD,cAAIC,GAAG,GAAG,KAAK1B,WAAL,CAAiByB,QAAjB,CAAV;AACA,iBAAOC,GAAG,GAAG,KAAKzB,YAAX,GAA0B,KAAKW,aAAL,GAAqB,GAAtD;AACH,S;;eACOmB,iB,GAAR,2BAA0B3D,IAA1B,EAA6CqD,QAA7C,EAA4E;AACxE,cAAIG,GAAG,GAAG,KAAK9B,WAAL,CAAiB2B,QAAjB,CAAV;AACA,iBAAOG,GAAG,GAAG,KAAKjB,QAAX,GAAsB,KAAKM,aAAL,CAAmB7C,IAAnB,KAA4B,IAAIA,IAAI,CAAC8C,OAArC,CAA7B;AACH,S;;eACOc,kB,GAAR,4BAA2B5D,IAA3B,EAA8CqD,QAA9C,EAA6E;AACzE,cAAIC,GAAG,GAAG,KAAK1B,WAAL,CAAiByB,QAAjB,CAAV;AACA,iBAAOC,GAAG,GAAG,KAAKf,QAAX,GAAsB,KAAKM,aAAL,CAAmB7C,IAAnB,IAA2BA,IAAI,CAAC8C,OAA7D;AACH,S;;eACOe,gB,GAAR,0BAAyB7D,IAAzB,EAA4CqD,QAA5C,EAA2E;AACvE,cAAIC,GAAG,GAAG,KAAKlC,WAAL,CAAiBiC,QAAjB,CAAV;AACA,iBAAOC,GAAG,GAAG,KAAKb,QAAX,GAAsB,KAAKE,cAAL,CAAoB3C,IAApB,KAA6B,IAAIA,IAAI,CAAC4C,OAAtC,CAA7B;AACH,S;;eACOkB,mB,GAAR,6BAA4B9D,IAA5B,EAA+CqD,QAA/C,EAA8E;AAC1E,cAAIG,GAAG,GAAG,KAAKhC,WAAL,CAAiB6B,QAAjB,CAAV;AACA,iBAAOG,GAAG,GAAG,KAAKf,QAAX,GAAsB,KAAKE,cAAL,CAAoB3C,IAApB,IAA4BA,IAAI,CAAC4C,OAA9D;AACH,S;;eACOmB,e,GAAR,yBAAwB/D,IAAxB,EAA2CqD,QAA3C,EAAyExD,OAAzE,EAAmG;AAAA,cAA1BA,OAA0B;AAA1BA,YAAAA,OAA0B,GAAP,KAAO;AAAA;;AAE/F,cAAImE,GAAG,GAAG,IAAIpI,IAAJ,EAAV;;AACA,cAAI,CAAC,KAAKqI,MAAV,EAAkB;AACdD,YAAAA,GAAG,CAAC7E,CAAJ,GAAQ,KAAK4D,SAAL,CAAe/C,IAAf,CAAR;AACAgE,YAAAA,GAAG,CAAC5E,CAAJ,GAAQ,KAAK8D,SAAL,CAAelD,IAAf,CAAR;AACH,WAHD,MAGO;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,gBAAI,KAAKX,QAAT,EAAmB;AACf,kBAAI6E,aAAa,GAAG,KAApB;;AACA,kBAAI,KAAKtD,uBAAL,IAAgCjE,uBAAuB,CAACkE,aAA5D,EAA2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","sourcesContent":["\nimport { _decorator, Component, Node, ccenum, UITransform, SystemEventType, director, Director, Vec3, Label, EventHandler, instantiate, Prefab, Size, ScrollView, Vec2, size } from 'cc';\nimport { isThisSecond } from 'date-fns';\nimport { CustomScrollview } from './custom-scrollview';\nimport { Notify } from './framework/singles/notify';\nconst { ccclass, property, executeInEditMode, requireComponent } = _decorator;\nconst EPSILON = 1e-4\nenum Type {\n    HORIZONTAL = 0,\n    VERTICAL = 1,\n}\nccenum(Type)\nenum AxisDirection {\n    HEADER_TO_FOOTER = 0,\n    FOOTER_TO_HEADER = 1,\n}\nccenum(AxisDirection)\nenum VerticalAxisDirection {\n    TOP_TO_BOTTOM = 0,\n    BOTTOM_TO_TOP = 1\n}\nccenum(VerticalAxisDirection)\nenum HorizontalAxisDirection {\n    LEFT_TO_RIGHT = 0,\n    RIGHT_TO_LEFT = 1\n}\nccenum(HorizontalAxisDirection)\nenum ScrollDirection {\n    NONE = 0,\n    HEADER = 1,\n    FOOTER = 2,\n}\n@ccclass('CustomLayout')\n@requireComponent(UITransform)\nexport class CustomLayout extends Component {\n    @property(CustomScrollview) scrollView!: CustomScrollview\n    @property(UITransform) view!: UITransform\n    @property groupItemTotal: number = 1\n    @property({ type: Type }) layoutType: Type = Type.VERTICAL\n    @property({\n        type: VerticalAxisDirection,\n        displayName: \"纵向轴方向\"\n    }) verticalAxisDirection = VerticalAxisDirection.TOP_TO_BOTTOM\n    @property({\n        type: HorizontalAxisDirection,\n        displayName: \"横向轴方向\"\n    }) horizontalAxisDirection = HorizontalAxisDirection.LEFT_TO_RIGHT\n    @property multiple: number = 2\n    @property({\n        type: AxisDirection,\n    }) axisDirection: AxisDirection = AxisDirection.HEADER_TO_FOOTER\n\n    @property paddingTop: number = 0\n    @property paddingBottom: number = 0\n    @property paddingLeft: number = 0\n    @property paddingRight: number = 0\n    @property spacingX: number = 0\n    @property spacingY: number = 0\n    @property affectedByScale: boolean = false\n    @property autoCenter: boolean = true\n    @property({\n        visible: function () { return this.autoCenter }\n    }) centerTime: number = 1\n    @property({\n        type: Node,\n        visible: function () { return this.autoCenter }\n    }) centerNode!: Node\n\n    @property(Prefab) prefab!: Prefab\n    @property(EventHandler) refreshItemEvents: EventHandler[] = []\n\n    @property headerLoop: boolean = false\n    @property footerLoop: boolean = false\n\n    private scrollDirection: ScrollDirection = ScrollDirection.NONE\n\n    get vertical(): boolean { return this.layoutType == Type.VERTICAL }\n    get horizontal(): boolean { return this.layoutType == Type.HORIZONTAL }\n\n    get transform(): UITransform | null { return this.node._uiProps.uiTransformComp }\n    /** 可容纳item的真实宽度 */\n    get accommodWidth() {\n        return this.view.width - this.paddingLeft - this.paddingRight\n    }\n    /** 可容纳item的真实高度 */\n    get accommodHeight() {\n        return this.view.height - this.paddingTop - this.paddingBottom\n    }\n    get header(): UITransform | null {\n        if (this.node.children.length == 0) return null\n        return this.node.children[0]._uiProps.uiTransformComp\n    }\n    get footer(): UITransform | null {\n        if (this.node.children.length == 0) return null\n        return this.node.children[this.node.children.length - 1]._uiProps.uiTransformComp\n    }\n    get headerIndex(): number {\n        if (!this.header) return -1\n        let node: any = this.header.node\n        return node[\"__index\"]\n    }\n    get footerIndex(): number {\n        if (!this.footer) return -1\n        let node: any = this.footer.node\n        return node[\"__index\"]\n    }\n    /** 起始位置 */\n    get viewStartPoint(): Vec3 {\n        let pos = new Vec3()\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            pos.x = this.view.width * -0.5 + this.paddingLeft\n        } else {\n            pos.x = this.view.width * 0.5 - this.paddingRight\n        }\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            pos.y = this.view.height * 0.5 - this.paddingTop\n        } else {\n            pos.y = this.view.height * -0.5 + this.paddingBottom\n        }\n        return pos\n    }\n    get viewHeaderBoundary(): number {\n        var offset = 0\n        if (this.vertical) {\n            offset = this.view.height * 0.5\n        } else {\n            offset = this.view.width * -0.5\n        }\n        return offset\n    }\n    get viewFooterBoundary(): number {\n        var offset = 0\n        if (this.vertical) {\n            offset = this.view.height * -0.5\n        } else {\n            offset = this.view.width * 0.5\n        }\n        return offset\n    }\n    get headerBoundary(): number {\n        if (!this.header) return 0\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                return this.node.position.y + this.getItemYMax(this.header) + this.paddingTop\n            } else {\n                return this.node.position.y + this.getItemYMin(this.header) - this.paddingBottom\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                return this.node.position.x + this.getItemXMin(this.header) - this.paddingLeft\n            } else {\n                return this.node.position.x + this.getItemXMax(this.header) + this.paddingRight\n            }\n        }\n    }\n    get footerBoundary(): number {\n        if (!this.footer) return 0\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                return this.node.position.y + this.getItemYMin(this.footer) - this.paddingBottom\n            } else {\n                return this.node.position.y + this.getItemYMax(this.footer) + this.paddingTop\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                return this.node.position.x + this.getItemXMax(this.footer) + this.paddingRight\n            } else {\n                return this.node.position.x + this.getItemXMin(this.footer) - this.paddingLeft\n            }\n        }\n    }\n    get centerHeaderBoundary() {\n        let key = this.vertical ? \"y\" : \"x\"\n        if (this.centerNode) {\n            return this.headerBoundary + (this.viewHeaderBoundary - (this.centerNode.position as any)[key])\n        } else {\n            return this.headerBoundary + (this.viewHeaderBoundary - (this.view.node.position as any)[key])\n        }\n    }\n    get centerFooterBoundary() {\n        let key = this.vertical ? \"y\" : \"x\"\n        if (this.centerNode) {\n            return this.footerBoundary + (this.viewFooterBoundary - (this.centerNode.position as any)[key])\n        } else {\n            return this.footerBoundary + (this.viewFooterBoundary - (this.view.node.position as any)[key])\n        }\n    }\n\n    get isOfLeftBoundary(): number {\n        if (this.vertical) return 0\n        if (this.autoCenter) {\n            if (this.scrollDirection == ScrollDirection.HEADER) {\n                return this.centerHeaderBoundary\n            }\n            return 0\n        }\n        if (this.headerLoop) {\n            if (this.header) return 0\n            return this.viewHeaderBoundary + this.node.position.x\n        }\n\n        if (!this.header || this.fixedItemWidth <= this.view.width) {\n            return this.viewHeaderBoundary + this.node.position.x\n        }\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            if (this.headerIndex == 0) {\n                return this.headerBoundary\n            }\n        } else {\n            if (this.footerIndex == this.itemTotal - 1) {\n                return this, this.footerBoundary\n            }\n        }\n        return 0\n    }\n    get isOfRightBoundary(): number {\n        if (this.vertical) return 0\n        if (this.autoCenter) {\n            if (this.scrollDirection == ScrollDirection.FOOTER) {\n                return this.centerFooterBoundary\n            }\n            return 0\n        }\n        if (this.footerLoop) {\n            if (this.footer) return 0\n            return this.viewFooterBoundary + this.node.position.x\n        }\n\n        if (!this.header || this.fixedItemWidth <= this.view.width) {\n            return this.viewFooterBoundary + this.node.position.x\n        }\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            if (this.footerIndex == this.itemTotal - 1) {\n                return this, this.footerBoundary\n            }\n        } else {\n            if (this.headerIndex == 0) {\n                return this.headerBoundary\n            }\n        }\n\n        return 0\n    }\n    get isOfTopBoundary(): number {\n        if (!this.vertical) return 0\n        if (this.autoCenter) {\n            if (this.scrollDirection == ScrollDirection.HEADER) {\n                return this.centerHeaderBoundary\n            }\n            return 0\n        }\n\n        if (this.headerLoop) {\n            if (this.header) return 0\n            return this.viewHeaderBoundary + this.node.position.y\n        }\n        if (!this.header || this.fixedItemHeight <= this.view.height) {\n            return this.viewHeaderBoundary + this.node.position.y\n        }\n\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            if (this.headerIndex == 0) {\n                return this.headerBoundary\n            }\n        } else {\n            if (this.footerIndex == this.itemTotal - 1) {\n                return this.footerBoundary\n            }\n        }\n        return 0\n    }\n    get isOfButtomBoundary(): number {\n        if (!this.vertical) return 0\n        if (this.autoCenter) {\n            if (this.scrollDirection == ScrollDirection.FOOTER) {\n                return this.centerFooterBoundary\n            }\n            return 0\n        }\n        if (this.footerLoop) {\n            if (this.footer) return 0\n            return this.viewFooterBoundary + this.node.position.y\n        }\n        if (!this.footer || this.fixedItemHeight <= this.view.height) {\n            return this.viewFooterBoundary + this.node.position.y\n        }\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            if (this.footerIndex == this.itemTotal - 1) {\n                return this.footerBoundary\n            }\n        } else {\n            if (this.headerIndex == 0) {\n                return this.headerBoundary\n            }\n        }\n        return 0\n    }\n    get fixedItemHeight(): number {\n        if (!this.header) return 0\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            return Math.abs(this.getItemYMax(this.header)) + Math.abs(this.getItemYMin(this.footer))\n        } else {\n            return Math.abs(this.getItemYMin(this.header)) + Math.abs(this.getItemYMax(this.footer))\n        }\n    }\n    get fixedItemWidth(): number {\n        if (!this.header) return 0\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            return Math.abs(this.getItemXMin(this.header)) + Math.abs(this.getItemXMax(this.footer))\n        } else {\n            return Math.abs(this.getItemXMax(this.header)) + Math.abs(this.getItemXMin(this.footer))\n        }\n    }\n    private prevPos: Vec3 = new Vec3(0, 0, 0)\n\n\n\n    private _maxPrefabTotal: number = 0\n    get maxPrefabTotal(): number { return this._maxPrefabTotal }\n    private _itemTotal: number = 0\n    get itemTotal(): number { return this._itemTotal }\n\n    private gener!: Generator\n    async total(count: number) {\n        let created = await this.createItems(count)\n        let offset = count - this.itemTotal\n        this._itemTotal = count\n        if (!created) {\n            this.refreshItems(offset)\n        }\n        this.scrollView.release()\n    }\n    private _centerPosition!: Vec3\n    get centerPosition(): Vec3 {\n        if (!this._centerPosition) {\n            this._centerPosition = new Vec3()\n            if (this.autoCenter) {\n                if (this.centerNode) {\n                    let worldPos = this.centerNode.parent?._uiProps.uiTransformComp?.convertToWorldSpaceAR(this.centerNode.position)!\n                    this._centerPosition = this.view.convertToNodeSpaceAR(worldPos)\n                }\n            } else {\n                if (this.vertical) {\n                    if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                        this._centerPosition.y = this.viewHeaderBoundary\n                    } else {\n                        this._centerPosition.y = this.viewFooterBoundary\n                    }\n                } else {\n                    if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                        this._centerPosition.x = this.viewHeaderBoundary\n                    } else {\n                        this._centerPosition.x = this.viewFooterBoundary\n                    }\n                }\n            }\n        }\n        return this._centerPosition\n    }\n    soonFinish() {\n        if (!this.autoCenter) return\n        var findedPos = new Vec3(999999, 999999)\n        for (let i = 0; i < this.node.children.length; i++) {\n            const child = this.node.children[i];\n            let worldPos = this.transform?.convertToWorldSpaceAR(child.position)!\n            let localPos = this.view.convertToNodeSpaceAR(worldPos)\n            let map = { width: false, height: false }\n            let newLocalPos = localPos.subtract(this.centerPosition)\n            map.width = Math.abs(newLocalPos.x) < Math.abs(findedPos.x)\n            map.height = Math.abs(newLocalPos.y) < Math.abs(findedPos.y)\n            if (this.vertical && map.height) {\n                findedPos = newLocalPos\n            } else if (!this.vertical && map.width) {\n                findedPos = newLocalPos\n            }\n        }\n        findedPos.multiply(new Vec3(-1, -1, 1))\n        this.scrollView.scrollToAny(findedPos, this.centerTime)\n    }\n\n    scrollToIndex(index: number, timeInSecond?: number, boundary?: Vec3, reverse: boolean = false) {\n        if (isNaN(index) || index < 0 || index > this.itemTotal - 1) return\n        var offset = 0\n        var child = this.node.children.find((item: any) => item[\"__index\"] == index)\n        if (!child) {\n            var isDownOffset = false\n            if (index > this.footerIndex && index < this.headerIndex) {\n                if (Math.abs(index - this.headerIndex) < Math.abs(index - this.footerIndex)) {\n                    isDownOffset = false\n                } else {\n                    isDownOffset = true\n                }\n            } else if (index > this.footerIndex) {\n                isDownOffset = true\n            } else if (index < this.headerIndex) {\n                isDownOffset = false\n            }\n            var start = 0\n            if (isDownOffset) {\n                offset = index % this.groupItemTotal - this.footerIndex % this.groupItemTotal\n                offset = Math.abs(offset)\n            } else {\n                offset = this.headerIndex % this.groupItemTotal\n                offset = Math.abs(offset)\n            }\n            for (let i = 0; i < offset; i++) {\n                if (this.vertical) {\n                    if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                        if (isDownOffset) {\n                            this.pushToFooter(true)\n                        } else {\n                            this.pushToHeader(true)\n                            console.error(\"向上填充完成\")\n                        }\n                    } else {\n                        if (isDownOffset) {\n                            this.pushToHeader(true)\n                        } else {\n                            this.pushToFooter(true)\n                        }\n                    }\n                } else {\n                    if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                        if (isDownOffset) {\n                            this.pushToFooter(true)\n                        } else {\n                            this.pushToHeader(true)\n                        }\n                    } else {\n                        if (isDownOffset) {\n                            this.pushToHeader(true)\n                        } else {\n                            this.pushToFooter(true)\n                        }\n                    }\n                }\n            }\n            if (isDownOffset) {\n                start = Math.abs(index - this.maxPrefabTotal) + 1\n                // console.error(\"向下 起始位置\", start)\n            } else {\n                if (index < this.groupItemTotal) {\n                    start = 0\n                } else {\n                    start = index\n                }\n                // console.error(\"向上 起始位置\", start)\n            }\n            for (let i = 0; i < this.node.children.length; i++) {\n                const child: any = this.node.children[i];\n                if (this.headerLoop || this.footerLoop) {\n                    if (start > this.itemTotal - 1) {\n                        start = 0\n                    }\n                }\n                child[\"__index\"] = start\n                // console.log(start)\n                this.notifyRefreshItem(child)\n                start++\n            }\n            child = this.node.children.find((item: any) => item[\"__index\"] == index)\n        }\n        if (!child) return\n        let itemPos = child.getPosition()\n        if (!this.autoCenter) {\n            if (this.vertical) {\n                if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                    if (!reverse) {\n                        itemPos.y = this.getItemYMax(child._uiProps.uiTransformComp!) + this.paddingTop\n                    } else {\n                        itemPos.y = this.getItemYMin(child._uiProps.uiTransformComp!) - this.paddingBottom\n                    }\n                } else {\n                    if (!reverse) {\n                        itemPos.y = this.getItemYMin(child._uiProps.uiTransformComp!) - this.paddingBottom\n                    } else {\n                        itemPos.y = this.getItemYMax(child._uiProps.uiTransformComp!) + this.paddingTop\n                    }\n                }\n            } else {\n                if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                    if (!reverse) {\n                        itemPos.x = this.getItemXMin(child._uiProps.uiTransformComp!) - this.paddingLeft\n                    } else {\n                        itemPos.x = this.getItemXMax(child._uiProps.uiTransformComp!) + this.paddingRight\n                    }\n                } else {\n                    if (!reverse) {\n                        itemPos.x = this.getItemXMax(child._uiProps.uiTransformComp!) + this.paddingRight\n                    } else {\n                        itemPos.x = this.getItemXMin(child._uiProps.uiTransformComp!) - this.paddingLeft\n                    }\n                }\n            }\n        }\n\n        let worldPos = this.transform?.convertToWorldSpaceAR(itemPos)!\n        let localPos = this.view.convertToNodeSpaceAR(worldPos)\n        let multiple\n        if (!this.autoCenter && boundary) {\n            multiple = boundary\n        } else {\n            multiple = this.centerPosition\n        }\n        localPos.multiply(new Vec3(-1, -1, 1)).add(multiple)\n        this.scrollView.stopAutoScroll()\n        this.scrollView.scrollToAny(localPos, timeInSecond)\n    }\n    scrollToHeader(timeInSecond?: number) {\n        this.scrollToIndex(0, timeInSecond, new Vec3(this.viewHeaderBoundary, this.viewHeaderBoundary))\n    }\n    scrollToFooter(timeInSecond?: number) {\n        this.scrollToIndex(this.itemTotal - 1, timeInSecond, new Vec3(this.viewFooterBoundary, this.viewFooterBoundary), true)\n    }\n    /** 返回 header到 footer 之间的整体尺寸 */\n    get contentSize(): Size {\n        if (this.node.children.length == 0) return this.view.contentSize\n        let size = new Size(this.view.contentSize.width, this.view.contentSize.height)\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                size.height = this.headerBoundary + -this.footerBoundary + this.paddingTop + this.paddingBottom\n            } else {\n                size.height = this.footerBoundary + -this.headerBoundary + this.paddingTop + this.paddingBottom\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                size.width = this.footerBoundary + -this.headerBoundary + this.paddingLeft + this.paddingRight\n            } else {\n                size.width = this.headerBoundary + -this.footerBoundary + this.paddingLeft + this.paddingRight\n            }\n        }\n        if (size.width < this.view.contentSize.width) {\n            size.width = this.view.contentSize.width\n        }\n        if (size.height < this.view.contentSize.height) {\n            size.height = this.view.contentSize.height\n        }\n        return size\n    }\n    private getItemSize(item: UITransform): Size {\n        let size = new Size()\n        if (this.vertical) {\n            let spacing = this.spacingX * (this.groupItemTotal - 1)\n            size.width = (this.accommodWidth - spacing) / this.groupItemTotal\n            size.height = item.height\n        } else {\n            let spacing = this.spacingY * (this.groupItemTotal - 1)\n            size.height = (this.accommodHeight - spacing) / this.groupItemTotal\n            size.width = item.width\n        }\n        return size\n    }\n    private getItemYMax(item: UITransform | null): number {\n        if (!item) return 0\n        let height = this.getScaleHeight(item) * (1 - item.anchorY)\n        return item.node.position.y + height\n    }\n    private getItemYMin(item: UITransform | null): number {\n        if (!item) return 0\n        let height = this.getScaleHeight(item) * item.anchorY\n        return item.node.position.y - height\n    }\n    private getItemXMax(item: UITransform | null): number {\n        if (!item) return 0\n        let width = this.getScaleWidth(item) * (1 - item.anchorX)\n        return item.node.position.x + width\n    }\n    private getItemXMin(item: UITransform | null): number {\n        if (!item) return 0\n        let width = this.getScaleWidth(item) * item.anchorX\n        return item.node.position.x - width\n    }\n\n    private getStartX(item: UITransform | null): number {\n        if (!item) return 0\n        var x = 0\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            let width = this.getScaleWidth(item) * item.anchorX\n            x = this.viewStartPoint.x + width\n        } else {\n            let width = this.getScaleWidth(item) * (1 - item.anchorX)\n            x = this.viewStartPoint.x - width\n        }\n        return x\n    }\n    private getEndX(item: UITransform | null): number {\n        if (!item) return 0\n        var x = 0\n        if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            let width = this.getScaleWidth(item) * (1 - item.anchorX)\n            x = -this.viewStartPoint.x - width\n        } else {\n            let width = this.getScaleWidth(item) * item.anchorX\n            x = -this.viewStartPoint.x + width\n        }\n        return x\n    }\n    private getStartY(item: UITransform | null): number {\n        if (!item) return 0\n        var y = 0\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            let height = this.getScaleHeight(item) * (1 - item.anchorY)\n            y = this.viewStartPoint.y - height\n        } else {\n            let height = this.getScaleHeight(item) * item.anchorY\n            y = this.viewStartPoint.y + height\n        }\n        return y\n    }\n    private getEndY(item: UITransform | null): number {\n        if (!item) return 0\n        var y = 0\n        if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            let height = this.getScaleHeight(item) * item.anchorY\n            y = -this.viewStartPoint.y + height\n        } else {\n            let height = this.getScaleHeight(item) * (1 - item.anchorY)\n            y = -this.viewStartPoint.y - height\n        }\n        return y\n    }\n    private isAccommodateByTop(relative: UITransform) {\n        var max = this.getItemYMax(relative)\n        return max + this.paddingTop < this.accommodHeight * 0.5\n    }\n    private isAccommodateByBottom(relative: UITransform) {\n        var min = this.getItemYMin(relative)\n        return min - this.paddingBottom > this.accommodHeight * -0.5\n    }\n    /** 左侧是否可以容纳 */\n    private isAccommodateByLeft(relative: UITransform) {\n        var min = this.getItemXMin(relative)\n        return min - this.paddingLeft > this.accommodWidth * -0.5\n    }\n    private isAccommodateByRight(relative: UITransform) {\n        var max = this.getItemXMax(relative)\n        return max + this.paddingRight < this.accommodWidth * 0.5\n    }\n    private getRelativeByLeft(item: UITransform, relative: UITransform): number {\n        var min = this.getItemXMin(relative)\n        return min - this.spacingX - this.getScaleWidth(item) * (1 - item.anchorX)\n    }\n    private getRelativeByRight(item: UITransform, relative: UITransform): number {\n        var max = this.getItemXMax(relative)\n        return max + this.spacingX + this.getScaleWidth(item) * item.anchorX\n    }\n    private getRelativeByTop(item: UITransform, relative: UITransform): number {\n        var max = this.getItemYMax(relative)\n        return max + this.spacingY + this.getScaleHeight(item) * (1 - item.anchorY)\n    }\n    private getRelativeByBottom(item: UITransform, relative: UITransform): number {\n        var min = this.getItemYMin(relative)\n        return min - this.spacingY - this.getScaleHeight(item) * item.anchorY\n    }\n    private setItemPosition(item: UITransform, relative: UITransform | null, reverse: boolean = false) {\n\n        var pos = new Vec3()\n        if (!this.header) {\n            pos.x = this.getStartX(item)\n            pos.y = this.getStartY(item)\n        } else {\n            // if (this.vertical) {\n            //     var isAccommodate = false\n            //     if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            //         if (!reverse) {\n            //             isAccommodate = this.isAccommodateByRight(this.footer!)\n            //         } else {\n            //             isAccommodate = this.isAccommodateByLeft(this.header!)\n            //         }\n            //     } else {\n            //         if (!reverse) {\n            //             isAccommodate = this.isAccommodateByLeft(this.footer!)\n            //         } else {\n            //             isAccommodate = this.isAccommodateByRight(this.header!)\n            //         }\n            //     }\n            //     // 横轴\n            //     if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.x = this.getRelativeByRight(item, this.footer!)\n            //             } else {\n            //                 pos.x = this.getStartX(item)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.x = this.getRelativeByLeft(item, this.header!)\n            //             } else {\n            //                 pos.x = this.getEndX(item)\n            //             }\n            //         }\n            //     } else {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.x = this.getRelativeByLeft(item, this.footer!)\n            //             } else {\n            //                 pos.x = this.getStartX(item)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.x = this.getRelativeByRight(item, this.header!)\n            //             } else {\n            //                 pos.x = this.getEndX(item)\n            //             }\n            //         }\n            //     }\n            //     // 纵轴\n            //     if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.y = this.footer?.node.position.y!\n            //             } else {\n            //                 pos.y = this.getRelativeByBottom(item, this.footer!)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.y = this.header?.node.position.y!\n            //             } else {\n            //                 pos.y = this.getRelativeByTop(item, this.header!)\n            //             }\n            //         }\n            //     } else {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.y = this.footer?.node.position.y!\n            //             } else {\n            //                 pos.y = this.getRelativeByTop(item, this.footer!)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.y = this.header?.node.position.y!\n            //             } else {\n            //                 pos.y = this.getRelativeByBottom(item, this.header!)\n            //             }\n            //         }\n            //     }\n            // } else {\n            //     var isAccommodate = false\n            //     if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            //         if (!reverse) {\n            //             isAccommodate = this.isAccommodateByBottom(this.footer!)\n            //         } else {\n            //             isAccommodate = this.isAccommodateByTop(this.header!)\n            //         }\n            //     } else {\n            //         if (!reverse) {\n            //             isAccommodate = this.isAccommodateByTop(this.footer!)\n            //         } else {\n            //             isAccommodate = this.isAccommodateByBottom(this.header!)\n            //         }\n            //     }\n            //     // 纵轴\n            //     if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.y = this.getRelativeByBottom(item, this.footer!)\n            //             } else {\n            //                 pos.y = this.getStartY(item)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.y = this.getRelativeByTop(item, this.header!)\n            //             } else {\n            //                 pos.y = this.getEndY(item)\n            //             }\n            //         }\n            //     } else {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.y = this.getRelativeByTop(item, this.footer!)\n            //             } else {\n            //                 pos.y = this.getStartY(item)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.y = this.getRelativeByBottom(item, this.header!)\n            //             } else {\n            //                 pos.y = this.getEndY(item)\n            //             }\n            //         }\n            //     }\n\n\n            //     // 横轴\n            //     if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.x = this.footer?.node.position.x!\n            //             } else {\n            //                 pos.x = this.getRelativeByRight(item, this.footer!)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.x = this.header.node.position.x\n            //             } else {\n            //                 pos.x = this.getRelativeByLeft(item, this.header!)\n            //             }\n            //         }\n            //     } else {\n            //         if (!reverse) {\n            //             if (isAccommodate) {\n            //                 pos.x = this.footer?.node.position.x!\n            //             } else {\n            //                 pos.x = this.getRelativeByLeft(item, this.footer!)\n            //             }\n            //         } else {\n            //             if (isAccommodate) {\n            //                 pos.x = this.header.node.position.x\n            //             } else {\n            //                 pos.x = this.getRelativeByRight(item, this.header)\n            //             }\n            //         }\n            //     }\n            // }\n\n            if (this.vertical) {\n                var isAccommodate = false\n                if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                    if (!reverse) {\n                        isAccommodate = this.isAccommodateByRight(relative)\n                    } else {\n                        isAccommodate = this.isAccommodateByLeft(relative)\n                    }\n                } else {\n                    if (!reverse) {\n                        isAccommodate = this.isAccommodateByLeft(relative)\n                    } else {\n                        isAccommodate = this.isAccommodateByRight(relative)\n                    }\n                }\n                // 横轴\n                if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.x = this.getRelativeByRight(item, relative)\n                        } else {\n                            pos.x = this.getStartX(item)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.x = this.getRelativeByLeft(item, relative)\n                        } else {\n                            pos.x = this.getEndX(item)\n                        }\n                    }\n                } else {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.x = this.getRelativeByLeft(item, relative)\n                        } else {\n                            pos.x = this.getStartX(item)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.x = this.getRelativeByRight(item, relative)\n                        } else {\n                            pos.x = this.getEndX(item)\n                        }\n                    }\n                }\n                // 纵轴\n                if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.y = relative.node.position.y!\n                        } else {\n                            pos.y = this.getRelativeByBottom(item, relative)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.y = relative.node.position.y!\n                        } else {\n                            pos.y = this.getRelativeByTop(item, relative)\n                        }\n                    }\n                } else {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.y = relative.node.position.y!\n                        } else {\n                            pos.y = this.getRelativeByTop(item, relative)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.y = relative.node.position.y!\n                        } else {\n                            pos.y = this.getRelativeByBottom(item, relative)\n                        }\n                    }\n                }\n            } else {\n                var isAccommodate = false\n                if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                    if (!reverse) {\n                        isAccommodate = this.isAccommodateByBottom(relative)\n                    } else {\n                        isAccommodate = this.isAccommodateByTop(relative)\n                    }\n                } else {\n                    if (!reverse) {\n                        isAccommodate = this.isAccommodateByTop(relative)\n                    } else {\n                        isAccommodate = this.isAccommodateByBottom(relative)\n                    }\n                }\n                // 纵轴\n                if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.y = this.getRelativeByBottom(item, relative)\n                        } else {\n                            pos.y = this.getStartY(item)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.y = this.getRelativeByTop(item, relative)\n                        } else {\n                            pos.y = this.getEndY(item)\n                        }\n                    }\n                } else {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.y = this.getRelativeByTop(item, relative)\n                        } else {\n                            pos.y = this.getStartY(item)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.y = this.getRelativeByBottom(item, relative)\n                        } else {\n                            pos.y = this.getEndY(item)\n                        }\n                    }\n                }\n\n\n                // 横轴\n                if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.x = relative.node.position.x!\n                        } else {\n                            pos.x = this.getRelativeByRight(item, relative)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.x = relative.node.position.x\n                        } else {\n                            pos.x = this.getRelativeByLeft(item, relative)\n                        }\n                    }\n                } else {\n                    if (!reverse) {\n                        if (isAccommodate) {\n                            pos.x = relative.node.position.x!\n                        } else {\n                            pos.x = this.getRelativeByLeft(item, relative)\n                        }\n                    } else {\n                        if (isAccommodate) {\n                            pos.x = relative.node.position.x\n                        } else {\n                            pos.x = this.getRelativeByRight(item, relative)\n                        }\n                    }\n                }\n            }\n        }\n\n        item.node.setPosition(pos)\n\n    }\n\n    private refreshItems(offset: number) {\n        if (offset < 0) {\n            for (let i = 0; i < -offset; i++) {\n                if (this.headerLoop) {\n                    this.pushToHeader()\n                } else if (this.footerLoop) {\n                    this.pushToHeader()\n                } else {\n                    this.pushToHeader(true)\n                }\n            }\n            let startIndex = this.headerIndex > 0 ? this.headerIndex : 0\n            for (let i = 0; i < this.node.children.length; i++) {\n                const child: any = this.node.children[i];\n                if (this.headerLoop || this.footerLoop) {\n                    if (startIndex > this.itemTotal - 1) {\n                        startIndex = 0\n                    }\n                }\n                child[\"__index\"] = startIndex\n                this.notifyRefreshItem(child)\n                startIndex++\n            }\n            this.scrollView.startAutoScroll()\n        } else {\n            if (this.vertical) {\n                if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                    this.pushToFooter()\n                } else {\n                    this.pushToHeader()\n                }\n            } else {\n                if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                    this.pushToFooter()\n                } else {\n                    this.pushToHeader()\n                }\n            }\n        }\n    }\n    private async createItems(count: number) {\n        this.gener?.return(\"\")\n        // 有多余的item 需要删除 不处理\n        if (this.node.children.length > count) {\n            this.removeItems(count)\n            return false\n        }\n        // 已经固定item总数 不处理\n        if (this._maxPrefabTotal > 0 && this._maxPrefabTotal == this.node.children.length) {\n            return false\n        }\n\n        // 开始分帧创建item\n        let total = count - this.node.children.length //计算当前应该创建的总数\n        this.gener = this.getGeneratorLength(total, () => {\n            let child: any = instantiate(this.prefab)\n            child[\"__index\"] = this.node.children.length\n            const transform = child._uiProps.uiTransformComp\n            transform.setContentSize(this.getItemSize(transform))\n            this.notifyRefreshItem(child)\n            child[\"__size\"] = transform.contentSize.clone()\n            child[\"__scale\"] = child.getScale().clone()\n            this.setItemPosition(child._uiProps.uiTransformComp, this.footer)\n            child.on(Node.EventType.SIZE_CHANGED, this.onChildSize, this)\n            child.on(Node.EventType.TRANSFORM_CHANGED, this.onChildScale, this)\n            this.node.addChild(child)\n            let selfHorW, viewHorW\n            if (this.vertical) {\n                selfHorW = this.contentSize.height\n                viewHorW = this.view.height\n            } else {\n                selfHorW = this.contentSize.width\n                viewHorW = this.view.width\n            }\n            /**\n             * 根据排列方向 来判断对比宽度还是高度\n             * 这里使用参数this.multiple来判断是否需要继续创建 默认为2倍 比如view可视尺寸为800 2倍就是1600\n             * 根据之前所创建的所有item的尺寸计算是否满足这个尺寸 如果满足则不再继续创建 \n             * 由于是分帧加载 所以下一次创建会等这一次的返回结果 返回false 则终止分帧任务\n             */\n            if (selfHorW >= viewHorW * this.multiple) {\n                this._maxPrefabTotal = this.node.children.length\n                console.error(\"确定数\", this._maxPrefabTotal)\n                return false\n            }\n            return true\n        })\n        await this.exeGenerator(this.gener, 10) //执行分帧任务 1帧创建10个\n        return true\n    }\n    /** 删除多余的item */\n    private removeItems(count: number) {\n        // 有多余的item 需要删除\n        let length = this.node.children.length - count\n        // 删除掉多余的item\n        for (let i = 0; i < length; i++) {\n            var child = this.node.children[this.node.children.length - 1]\n            child.off(Node.EventType.SIZE_CHANGED, this.onChildSize, this);\n            child.off(Node.EventType.TRANSFORM_CHANGED, this.onChildScale, this);\n            child.destroy()\n            this.node.removeChild(child)\n        }\n    }\n    onLoad() {\n        Object.defineProperty(this.transform, \"contentSize\", {\n            configurable: true,\n            get: () => this.contentSize,\n        })\n    }\n    onEnable() {\n        this.addEventListener()\n    }\n    onDisable() {\n        this.removeEventListener()\n    }\n    private addEventListener() {\n        this.node.on(SystemEventType.TRANSFORM_CHANGED, this.onPositionChanged, this)\n    }\n\n    private removeEventListener() {\n        this.node.off(SystemEventType.TRANSFORM_CHANGED, this.onPositionChanged, this)\n    }\n    private onChildScale(type: any) {\n        if (!this.affectedByScale) return\n        if (type == Node.TransformBit.SCALE) {\n            for (let i = 0; i < this.node.children.length; i++) {\n                const child: any = this.node.children[i];\n                const __scale = child[\"__scale\"]\n                if (this.groupItemTotal == 1) {\n                    if (this.vertical) {\n                        if (child.scale.x != __scale.x) {\n                            console.warn(\"不允许修改Item缩放X\")\n                            child.setScale(new Vec3(__scale.x, child.scale.y))\n                            return\n                        }\n                    } else {\n                        if (child.scale.y != __scale.y) {\n                            console.warn(\"不允许修改Item缩放Y\")\n                            child.setScale(new Vec3(child.scale.y, __scale.y))\n                            return\n                        }\n                    }\n                } else if (this.groupItemTotal > 1) {\n                    if (!child.scale.equals(__scale)) {\n                        console.warn(\"Grid模式不允许修改Item缩放\")\n                        child.setScale(__scale)\n                        return\n                    }\n                }\n            }\n            if (this.groupItemTotal > 1) return\n            this.resetChilds()\n        }\n    }\n    private onChildSize() {\n        for (let i = 0; i < this.node.children.length; i++) {\n            const child: any = this.node.children[i];\n            const __size = child[\"__size\"]\n            const transform = child._uiProps.uiTransformComp!\n            if (this.groupItemTotal == 1) {\n                if (this.vertical) {\n                    if (transform?.width != __size.width) {\n                        console.warn(\"不允许修改Item宽度\")\n                        transform.setContentSize(size(__size.width, transform.height))\n                        return\n                    }\n                } else {\n                    if (transform?.height != __size.height) {\n                        console.warn(\"不允许修改Item高度\")\n                        transform.setContentSize(size(transform.width, __size.height))\n                        return\n                    }\n                }\n            } else if (this.groupItemTotal > 1) {\n                if (!transform.contentSize.equals(__size)) {\n                    console.warn(\"Grid模式不允许修改Item尺寸\")\n                    transform.setContentSize(__size)\n                    return\n                }\n            }\n        }\n        if (this.groupItemTotal > 1) return\n        this.resetChilds()\n    }\n    private resetChilds(start: boolean = false) {\n        var prevItem: any = this.header\n        if (this.vertical && this.fixedItemHeight <= this.view.height || !this.vertical && this.fixedItemWidth <= this.view.width) {\n            let x = this.getStartX(this.header)\n            let y = this.getStartY(this.header)\n            this.header?.node.setPosition(new Vec3(x, y))\n        }\n        if (start) {\n            let x = this.getStartX(this.header)\n            this.header?.node.setPosition(new Vec3(x, this.header.node.position.y))\n        }\n        for (let i = 1; i < this.node.children.length; i++) {\n            const child = this.node.children[i];\n            const transform = child._uiProps.uiTransformComp!\n            let relative = !prevItem ? this.header : prevItem\n            this.setItemPosition(transform, relative)\n            prevItem = transform\n        }\n        this.scrollView.startAutoScroll()\n    }\n\n\n    protected getUsedScaleValue(value: number) {\n        return this.affectedByScale ? Math.abs(value) : 1;\n    }\n    protected getScaleWidth(trans: UITransform | null): number {\n        if (!trans) return 0\n        return trans.width * this.getUsedScaleValue(trans.node.scale.x)\n    }\n    protected getScaleHeight(trans: UITransform | null): number {\n        if (!trans) return 0\n        return trans.height * this.getUsedScaleValue(trans.node.scale.y)\n    }\n    public onPositionChanged() {\n        if (this.vertical) {\n            if (this.scrollView.prevLocation.y < this.scrollView.location.y) {\n                this.scrollDirection = ScrollDirection.FOOTER\n            } else if (this.scrollView.prevLocation.y > this.scrollView.location.y) {\n                this.scrollDirection = ScrollDirection.HEADER\n            } else {\n                this.scrollDirection = ScrollDirection.NONE\n            }\n        } else {\n            if (this.scrollView.prevLocation.x > this.scrollView.location.x) {\n                this.scrollDirection = ScrollDirection.FOOTER\n            } else if (this.scrollView.prevLocation.x < this.scrollView.location.x) {\n                this.scrollDirection = ScrollDirection.HEADER\n            } else {\n                this.scrollDirection = ScrollDirection.NONE\n            }\n        }\n\n        if (this.vertical) {\n            for (let i = 0; i < this.node.children.length; i++) {\n                let isOfBoundary = Math.abs(this.prevPos.y - this.node.position.y) > EPSILON\n                if (!isOfBoundary) continue\n                if (this.prevPos.y < this.node.position.y) {\n                    this.pushToFooter()\n                } else if (this.prevPos.y > this.node.position.y) {\n                    this.pushToHeader()\n                }\n            }\n        } else {\n            for (let i = 0; i < this.node.children.length; i++) {\n                let isOfBoundary = Math.abs(this.prevPos.x - this.node.position.x) > EPSILON\n                if (!isOfBoundary) continue\n                if (this.prevPos.x > this.node.position.x) {\n                    this.pushToFooter()\n                } else if (this.prevPos.x < this.node.position.x) {\n                    this.pushToHeader()\n                }\n            }\n        }\n        this.prevPos = this.node.position.clone()\n    }\n\n    private pushToFooter(force: boolean = false) {\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                if (force || this.headerBoundary - this.paddingTop > this.viewHeaderBoundary + this.header?.height!) {\n                    this.pushToFooterHandler()\n                }\n            } else {\n                if (force || this.footerBoundary - this.paddingTop > this.viewHeaderBoundary + this.header?.height!) {\n                    this.pushToHeaderHandler()\n                }\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                if (force || this.headerBoundary + this.paddingLeft < this.viewHeaderBoundary - this.header?.width!) {\n                    this.pushToFooterHandler()\n                }\n            } else {\n                if (force || this.footerBoundary + this.paddingLeft < this.viewHeaderBoundary - this.header?.width!) {\n                    this.pushToHeaderHandler()\n                }\n            }\n        }\n\n    }\n    private pushToHeader(force: boolean = false) {\n        if (this.vertical) {\n            if (this.verticalAxisDirection == VerticalAxisDirection.TOP_TO_BOTTOM) {\n                if (force || this.footerBoundary + this.paddingBottom < this.viewFooterBoundary - this.footer?.height!) {\n                    this.pushToHeaderHandler()\n                }\n            } else {\n                if (force || this.headerBoundary + this.paddingBottom < this.viewFooterBoundary - this.footer?.height!) {\n                    this.pushToFooterHandler()\n                }\n            }\n        } else {\n            if (this.horizontalAxisDirection == HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                if (force || this.footerBoundary - this.paddingRight > this.viewFooterBoundary + this.footer?.width!) {\n                    this.pushToHeaderHandler()\n                }\n            } else {\n                if (force || this.headerBoundary - this.paddingRight > this.viewFooterBoundary + this.footer?.width!) {\n                    this.pushToFooterHandler()\n                }\n            }\n        }\n\n    }\n    private pushToFooterHandler() {\n        var node: any = this.header?.node\n        if (this.footerLoop) {\n            if (this.footerIndex >= this.itemTotal - 1) {\n                node[\"__index\"] = 0\n            } else {\n                node[\"__index\"] = this.footerIndex + 1\n            }\n        } else {\n            if (!this.footer || this.footerIndex >= this.itemTotal - 1) return\n            node[\"__index\"] = this.footerIndex + 1\n        }\n        this.notifyRefreshItem(node)\n        this.setItemPosition(this.header!, this.footer!)\n        this.header?.node.setSiblingIndex(this.node.children.length)\n    }\n\n    private pushToHeaderHandler() {\n        var node: any = this.footer?.node\n        if (this.headerLoop) {\n            if (this.headerIndex == 0) {\n                node[\"__index\"] = this.itemTotal - 1\n            } else {\n                node[\"__index\"] = this.headerIndex - 1\n            }\n        } else {\n            if (!this.header || this.headerIndex == 0) return\n            node[\"__index\"] = this.headerIndex - 1\n        }\n        this.notifyRefreshItem(node)\n\n\n        this.setItemPosition(this.footer!, this.header!, true)\n        this.footer?.node.setSiblingIndex(0)\n\n        // 对其头部\n        if (!this.headerLoop && this.headerIndex == 0) {\n            // 判断是否是起始位置\n            let accommodate = this.isAccommodateByLeft(this.header!)\n            if (accommodate) {\n                this.resetChilds(true)\n            }\n        }\n    }\n    /** 通知给定的node刷新数据 */\n    notifyRefreshItem(target: Node) {\n        EventHandler.emitEvents(this.refreshItemEvents, target, (target as any)['__index'])\n    }\n    /** 分帧加载 */\n    private * getGeneratorLength(length: number, callback: Function, ...params: any): Generator {\n        for (let i = 0; i < length; i++) {\n            let result = callback(i, ...params)\n            if (result) {\n                yield\n            } else {\n                return\n            }\n        }\n    }\n    /** 分帧执行 */\n    private exeGenerator(generator: Generator, duration: number) {\n        return new Promise((resolve, reject) => {\n            let gen = generator\n            let execute = () => {\n                let startTime = new Date().getTime()\n                for (let iter = gen.next(); ; iter = gen.next()) {\n                    if (iter == null || iter.done) {\n                        resolve(null)\n                        return\n                    }\n                    if (new Date().getTime() - startTime > duration) {\n                        setTimeout(() => execute(), director.getDeltaTime() * 1000)\n                        return\n                    }\n                }\n            }\n            execute()\n        })\n    }\n}\n"]}