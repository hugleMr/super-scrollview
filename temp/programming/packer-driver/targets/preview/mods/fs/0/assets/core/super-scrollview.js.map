{"version":3,"sources":["file:///Users/stevejobs/Documents/GitHub/super-scrollview/assets/core/super-scrollview.ts"],"names":["_decorator","Vec3","Vec2","ScrollView","EventHandler","SuperLayout","ccclass","property","quintEaseOut","time","EPSILON","OUT_OF_BOUNDARY_BREAKING_FACTOR","SuperScrollview","displayName","tooltip","visible","pullRefresh","type","onLoad","layout","autoCenter","brake","_getContentTopBoundary","_content","offset","isOfTopBoundary","_topBoundary","_getContentBottomBoundary","isOfButtomBoundary","_bottomBoundary","_getContentLeftBoundary","isOfLeftBoundary","_leftBoundary","_getContentRightBoundary","isOfRightBoundary","_rightBoundary","_onTouchBegan","event","captureListeners","isCallSoonFinish","_processAutoScrolling","dt","isAutoScrollBrake","_isNecessaryAutoScrollBrake","brakingFactor","_autoScrollAccumulatedTime","percentage","Math","min","_autoScrollTotalTime","_autoScrollAttenuate","clonedAutoScrollTargetDelta","_autoScrollTargetDelta","clone","multiplyScalar","clonedAutoScrollStartPosition","_autoScrollStartPosition","add","reachedEnd","abs","fireEvent","getScrollEndedEventTiming","_isScrollEndedWithThresholdEventFired","_dispatchEvent","EventType","SCROLL_ENG_WITH_THRESHOLD","elastic","brakeOffsetPosition","subtract","_autoScrollBrakingStartPosition","set","moveDelta","getContentPosition","outOfBoundary","_getHowMuchOutOfBoundary","equals","ZERO","_autoScrolling","deltaMove","_clampDelta","vertical","y","x","_moveContent","SCROLLING","_isBouncing","_scrolling","SCROLL_ENDED","scrollToAny","timeInSecond","attenuated","_startAutoScroll","release","isMoveHeader","isMoveFooter","isLockHeader","isLockFooter","headerOutOffset","footerOutOffset","horizontal","clearProgress","startAutoScroll","_outOfBoundaryAmountDirty","_onTouchMoved","prevLocation","touch","getPreviousLocation","location","getLocation","headerProgress","headerMultiple","emitEvents","headerEvents","action","progress","stage","footerEvents","footerProgress","footerMultiple","_updateScrollBar","_autoScrollBraking","max","_layout","content","getComponent","value"],"mappings":"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","sourcesContent":["/*\n * @Author: steveJobs\n * @Email: icipiqkm@gmail.com\n * @Date: 2021-8-1 01:15:04\n * @Last Modified by: steveJobs\n * @Last Modified time: 2021-8-1 14:35:43\n * @Description: 微信 icipiqkm\n */\nimport { _decorator, Node, EventTouch, Vec3, Vec2, ScrollView, EventHandler } from 'cc';\nimport { SuperLayout } from './super-layout';\nconst { ccclass, property } = _decorator;\nconst quintEaseOut = (time: number) => {\n    time -= 1;\n    return (time * time * time * time * time + 1);\n};\nconst EPSILON = 1e-4\nconst OUT_OF_BOUNDARY_BREAKING_FACTOR = 0.015\n@ccclass('SuperScrollview')\nexport class SuperScrollview extends ScrollView {\n    private _layout!: SuperLayout\n    @property pullRefresh: boolean = false\n    @property({\n        displayName: \"顶部偏移量\",\n        tooltip: \"下拉时超过此偏移会发送下拉事件\",\n        visible: function () { return (this as any).pullRefresh }\n    }) headerOutOffset: number = 200\n    @property({\n        displayName: \"满足触发Header的倍数\",\n        visible: function () { return (this as any).pullRefresh }\n    }) headerMultiple: number = 2\n    @property({\n        displayName: \"底部偏移量\",\n        tooltip: \"上拉时超过此偏移会发送上拉事件\",\n        visible: function () { return (this as any).pullRefresh }\n    }) footerOutOffset: number = 200\n    @property({\n        displayName: \"满足触发Footer的倍数\",\n        visible: function () { return (this as any).pullRefresh }\n    }) footerMultiple: number = 2\n    @property({\n        type: EventHandler,\n        visible: function () { return (this as any).pullRefresh }\n    }) headerEvents: EventHandler[] = []\n    @property({\n        type: EventHandler,\n        visible: function () { return (this as any).pullRefresh }\n    }) footerEvents: EventHandler[] = []\n    prevLocation: Vec2 = new Vec2()\n    location: Vec2 = new Vec2()\n    onLoad() {\n        if (this.layout.autoCenter) {\n            this.brake = 0.7\n        }\n    }\n    get layout() {\n        if (!this._layout) {\n            this._layout = this.content?.getComponent(SuperLayout)!\n        }\n        return this._layout\n    }\n    private isCallSoonFinish: boolean = false\n    protected _getContentTopBoundary() {\n        if (!this._content) {\n            return -1\n        }\n        let offset = this.layout.isOfTopBoundary == 0 ? this._topBoundary : this.layout.isOfTopBoundary\n        return offset\n    }\n    protected _getContentBottomBoundary() {\n        if (!this._content) {\n            return -1\n        }\n        let offset = this.layout.isOfButtomBoundary == 0 ? this._bottomBoundary : this.layout.isOfButtomBoundary\n        return offset\n    }\n    protected _getContentLeftBoundary() {\n        if (!this._content) {\n            return -1\n        }\n        let offset = this.layout.isOfLeftBoundary == 0 ? this._leftBoundary : this.layout.isOfLeftBoundary\n        return offset\n    }\n    protected _getContentRightBoundary() {\n        if (!this._content) {\n            return -1\n        }\n        let offset = this.layout.isOfRightBoundary == 0 ? this._rightBoundary : this.layout.isOfRightBoundary\n        return offset\n    }\n    protected _onTouchBegan(event: EventTouch, captureListeners?: Node[]) {\n        this.isCallSoonFinish = false\n        super._onTouchBegan(event, captureListeners)\n    }\n    set autoScrolling(value: boolean) {\n        this._autoScrolling = value\n    }\n    protected _processAutoScrolling(dt: number) {\n        const isAutoScrollBrake = this._isNecessaryAutoScrollBrake();\n        const brakingFactor = isAutoScrollBrake ? OUT_OF_BOUNDARY_BREAKING_FACTOR : 1;\n        this._autoScrollAccumulatedTime += dt * (1 / brakingFactor);\n        let percentage = Math.min(1, this._autoScrollAccumulatedTime / this._autoScrollTotalTime);\n        if (this._autoScrollAttenuate) {\n            percentage = quintEaseOut(percentage);\n        }\n        const clonedAutoScrollTargetDelta = this._autoScrollTargetDelta.clone();\n        clonedAutoScrollTargetDelta.multiplyScalar(percentage);\n        const clonedAutoScrollStartPosition = this._autoScrollStartPosition.clone();\n        clonedAutoScrollStartPosition.add(clonedAutoScrollTargetDelta);\n        let reachedEnd = Math.abs(percentage - 1) <= EPSILON;\n\n        const fireEvent = Math.abs(percentage - 1) <= this.getScrollEndedEventTiming();\n        if (fireEvent && !this._isScrollEndedWithThresholdEventFired) {\n            this._dispatchEvent(ScrollView.EventType.SCROLL_ENG_WITH_THRESHOLD);\n            this._isScrollEndedWithThresholdEventFired = true;\n        }\n        if (this.elastic) {\n            const brakeOffsetPosition = clonedAutoScrollStartPosition.clone();\n            brakeOffsetPosition.subtract(this._autoScrollBrakingStartPosition);\n            if (isAutoScrollBrake) {\n                brakeOffsetPosition.multiplyScalar(brakingFactor);\n            }\n            clonedAutoScrollStartPosition.set(this._autoScrollBrakingStartPosition);\n            clonedAutoScrollStartPosition.add(brakeOffsetPosition);\n        } else {\n            const moveDelta = clonedAutoScrollStartPosition.clone();\n            moveDelta.subtract(this.getContentPosition());\n            const outOfBoundary = this._getHowMuchOutOfBoundary(moveDelta);\n            if (!outOfBoundary.equals(Vec3.ZERO, EPSILON)) {\n                clonedAutoScrollStartPosition.add(outOfBoundary);\n                reachedEnd = true;\n            }\n        }\n        if (reachedEnd) {\n            this._autoScrolling = false;\n        }\n        const deltaMove = clonedAutoScrollStartPosition.clone();\n        deltaMove.subtract(this.getContentPosition());\n        this._clampDelta(deltaMove);\n        /** 重写这个方法的主要原因是增加以下逻辑  功能用于自动居中 */\n        if (this.layout.vertical && Math.abs(deltaMove.y) <= 2 && !this.isCallSoonFinish) {\n            this.layout[\"soonFinish\"]()\n            this.isCallSoonFinish = true\n        } else if (!this.layout.vertical && Math.abs(deltaMove.x) <= 2 && !this.isCallSoonFinish) {\n            this.layout[\"soonFinish\"]()\n            this.isCallSoonFinish = true\n        }\n        this._moveContent(deltaMove, reachedEnd);\n        this._dispatchEvent(ScrollView.EventType.SCROLLING);\n        if (!this._autoScrolling) {\n            this._isBouncing = false;\n            this._scrolling = false;\n            this._dispatchEvent(ScrollView.EventType.SCROLL_ENDED);\n        }\n    }\n    scrollToAny(moveDelta: Vec3, timeInSecond?: number, attenuated = true) {\n        if (timeInSecond) {\n            this._startAutoScroll(moveDelta, timeInSecond, attenuated !== false);\n        } else {\n            this._moveContent(moveDelta);\n        }\n    }\n    release() {\n        this.isMoveHeader = false\n        this.isMoveFooter = false\n        if (this.isLockHeader || this.isLockFooter) {\n            this.vertical && this.isLockHeader && (this._topBoundary += this.headerOutOffset)\n            this.vertical && this.isLockFooter && (this._bottomBoundary -= this.footerOutOffset)\n            this.horizontal && this.isLockHeader && (this._leftBoundary -= this.headerOutOffset)\n            this.horizontal && this.isLockFooter && (this._rightBoundary += this.footerOutOffset)\n            this.clearProgress()\n            this.layout[\"onPositionChanged\"]()\n            this.isLockHeader = false\n            this.isLockFooter = false\n            this.startAutoScroll()\n        }\n    }\n    startAutoScroll() {\n        this._autoScrolling = true\n        this._outOfBoundaryAmountDirty = true\n    }\n    private isMoveHeader: boolean = false\n    private isMoveFooter: boolean = false\n    private isLockHeader: boolean = false\n    private isLockFooter: boolean = false\n    private headerProgress: number = 0\n    private footerProgress: number = 0\n    protected _onTouchMoved(event: EventTouch, captureListeners: any) {\n        this.prevLocation = event.touch?.getPreviousLocation()!\n        this.location = event.touch?.getLocation()!\n        super._onTouchMoved(event, captureListeners)\n        if (this.pullRefresh) {\n            let outOfBoundary = this._getHowMuchOutOfBoundary()\n            let offset = this.vertical ? outOfBoundary.y : -outOfBoundary.x\n            if (offset > 0 && !this.isLockHeader && !this.isLockFooter) {\n                this.headerProgress = offset < EPSILON ? 0 : offset / this.headerOutOffset\n                this.isMoveHeader = this.headerProgress >= this.headerMultiple\n                EventHandler.emitEvents(this.headerEvents, this, { action: false, progress: this.headerProgress, stage: this.isMoveHeader ? \"wait\" : \"touch\" })\n                EventHandler.emitEvents(this.footerEvents, this, { action: false, progress: 0, stage: \"release\" })\n            } else if (offset < 0 && !this.isLockHeader && !this.isLockFooter) {\n                this.footerProgress = -offset < EPSILON ? 0 : -offset / this.footerOutOffset\n                this.isMoveFooter = this.footerProgress >= this.footerMultiple\n                EventHandler.emitEvents(this.footerEvents, this, { action: false, progress: this.footerProgress, stage: this.isMoveFooter ? \"wait\" : \"touch\" })\n                EventHandler.emitEvents(this.headerEvents, this, { action: false, progress: 0, stage: \"release\" })\n            } else if (offset == 0 && !this.isLockHeader && !this.isLockFooter) {\n                this.clearProgress()\n            }\n        }\n    }\n    protected _startAutoScroll(deltaMove: any, timeInSecond: any, attenuated: any) {\n        if (this.pullRefresh) {  // 如果没有刷新/加载的监听者 则不计算 \n            if (this.isMoveHeader && !this.isLockHeader) {\n                if (this.vertical) {\n                    this._topBoundary -= this.headerOutOffset\n                    deltaMove.y -= this.headerOutOffset\n                }\n                if (this.horizontal) {\n                    this._leftBoundary += this.headerOutOffset\n                    deltaMove.x += this.headerOutOffset\n                }\n                this.isLockHeader = true\n                EventHandler.emitEvents(this.headerEvents, this, { action: true, progress: this.headerProgress, stage: 'lock' })\n            } else if (this.isMoveFooter && !this.isLockFooter) {\n                if (this.vertical) {\n                    this._bottomBoundary += this.footerOutOffset\n                    deltaMove.y += this.footerOutOffset\n                }\n                if (this.horizontal) {\n                    this._rightBoundary -= this.footerOutOffset\n                    deltaMove.x -= this.footerOutOffset\n                }\n                this.isLockFooter = true\n                EventHandler.emitEvents(this.footerEvents, this, { action: true, progress: this.footerProgress, stage: 'lock' })\n            }\n        }\n        super._startAutoScroll(deltaMove, timeInSecond, attenuated)\n    }\n    protected _updateScrollBar(outOfBoundary: any) {\n        super._updateScrollBar(outOfBoundary)\n        if (this._autoScrollBraking) return // 自动回弹时不计算 （非手动）\n        if (!this._autoScrolling) return // 非自动滚动时不计算 \n        if (!this.pullRefresh) return\n        let offset = this.vertical ? outOfBoundary.y : -outOfBoundary.x\n        if (offset > 0) { // 下滑\n            let progress = offset < EPSILON ? 0 : offset / this.headerOutOffset //根据参数 headerOutOffset 计算当前下滑的办百分比\n            if (this.isLockHeader) {\n                this.headerProgress = this.headerProgress == 1 ? this.headerProgress : Math.max(progress, 1)\n                EventHandler.emitEvents(this.headerEvents, this, { action: false, progress: this.headerProgress, stage: \"lock\" })\n            } else {\n                this.headerProgress = progress < this.headerProgress ? progress : this.headerProgress\n                EventHandler.emitEvents(this.headerEvents, this, { action: false, progress: this.headerProgress, stage: \"release\" })\n            }\n        } else if (offset < 0) {\n            let progress = -offset < EPSILON ? 0 : -offset / this.footerOutOffset  //根据参数 footerOutOffset 计算当前下滑的办百分比\n            if (this.isLockFooter) {\n                this.footerProgress = this.footerProgress == 1 ? this.footerProgress : Math.max(progress, 1)\n                EventHandler.emitEvents(this.footerEvents, this, { action: false, progress: this.footerProgress, stage: \"lock\" })\n            } else {\n                this.footerProgress = progress < this.footerProgress ? progress : this.footerProgress\n                EventHandler.emitEvents(this.footerEvents, this, { action: false, progress: this.footerProgress, stage: \"release\" })\n            }\n        } else if (offset == 0) {\n            // 正常滑动时 如果没有锁定头和尾时 释放所有进度\n            if (!this.isLockHeader && !this.isLockFooter) {\n                this.clearProgress()\n            }\n        }\n    }\n    private clearProgress() {\n        EventHandler.emitEvents(this.headerEvents, this, { action: false, progress: 0, stage: \"release\" })\n        EventHandler.emitEvents(this.footerEvents, this, { action: false, progress: 0, stage: \"release\" })\n    }\n}\n"]}